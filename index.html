<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>رحلتي في الإسلامية</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #006633;
            --primary-dark: #004422;
            --secondary-color: #fdd835;
            --light-bg: #e6f3ee;
            --correct-color: #28a745;
            --incorrect-color: #dc3545;
            --info-color: #17a2b8;
            --font-family: 'Cairo', sans-serif;
            --text-dark: #333;
            --text-light: #555;
            --white-color: #fff;
            --border-radius-main: 15px;
        }

        body {
            font-family: var(--font-family);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            color: var(--text-dark);
            padding: 10px;
            padding-top: 80px; /* <<< هذا السطر مهم لإعطاء مساحة للشريط العلوي */
            box-sizing: border-box;
            background-image: url('Ferst.webp');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
        }

        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(240, 244, 248, 0.85);
            z-index: -1;
        }

        .game-container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        #landing-screen {
            background-color: transparent;
            padding: 30px 40px;
            border-radius: 0;
            box-shadow: none;
            text-align: center;
            animation: fadeInUp 0.6s ease-out;
            width: 100%;
        }

        .logo {
            max-width: 150px;
            margin-bottom: 20px;
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 32px;
            line-height: 1.4;
            font-weight: 700;
        }

        .subtitle {
            font-size: 18px;
            color: var(--text-light);
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .features-grid {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 40px;
        }

        .feature-card {
            background-color: var(--white-color);
            padding: 25px;
            border-radius: var(--border-radius-main);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: calc(33.33% - 20px);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .feature-card .icon {
            font-size: 48px;
            color: var(--primary-color);
            display: block;
            margin-bottom: 15px;
        }

        .feature-card h3 {
            color: var(--primary-color);
            font-size: 20px;
            margin-bottom: 10px;
        }

        .feature-card p {
            font-size: 14px;
            color: #777;
            line-height: 1.5;
            margin: 0;
        }
        
        .reset-link-container {
            margin-top: 20px;
            font-size: 14px;
        }
        .reset-link-container a {
            color: var(--text-light);
            text-decoration: none;
        }
        .reset-link-container a:hover {
            text-decoration: underline;
            color: var(--primary-color);
        }

        #start-screen {
            background-color: var(--white-color);
            padding: 30px 40px;
            border-radius: var(--border-radius-main);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            animation: fadeInUp 0.6s ease-out;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: right;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--primary-dark);
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 16px;
            font-family: var(--font-family);
        }

        .action-button {
            width: 100%;
            max-width: 350px;
            padding: 15px;
            border: none;
            border-radius: 30px;
            background-color: var(--primary-color);
            color: var(--white-color);
            font-size: 18px;
            font-weight: bold;
            font-family: var(--font-family);
            cursor: pointer;
            transition: background-color 0.3s, transform 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 0 auto;
        }

        .action-button:hover {
            background-color: var(--primary-dark);
            transform: scale(1.02);
        }

        .action-button:disabled {
            background-color: var(--text-light);
            cursor: not-allowed;
            transform: none; /* إلغاء تأثير الـ hover عند التعطيل */
        }
        
        .btn-icon {
            transform: scaleX(-1);
        }

        .hidden {
            display: none !important;
        }

        .game-stage {
            background-color: var(--white-color);
            padding: 0;
            border-radius: var(--border-radius-main);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            width: 100%;
            box-sizing: border-box;
            overflow: hidden;
            animation: fadeInUp 0.6s ease-out;
        }

        .scene-image {
            width: 100%;
            height: auto;
            display: block;
        }

        .scene-content {
            padding: 25px;
        }

        .scene-title {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-dark);
            margin-bottom: 20px;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 25px;
        }

        .option-btn {
            position: relative;
            padding: 15px 10px;
            border: 2px solid var(--primary-color);
            background-color: var(--white-color);
            color: var(--primary-color);
            font-size: 16px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 100%;
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }

        .option-btn:hover {
            background-color: var(--light-bg);
            transform: translateY(-2px);
        }

        .option-btn.correct {
            background-color: var(--correct-color);
            color: var(--white-color);
            border-color: var(--correct-color);
        }
        .option-btn.correct:hover {
            background-color: var(--correct-color);
        }
        .option-btn.incorrect {
            background-color: var(--incorrect-color);
            color: var(--white-color);
            border-color: var(--incorrect-color);
        }
        .option-btn.incorrect:hover {
            background-color: var(--incorrect-color);
        }
        
        .option-btn.correct::before, .option-btn.incorrect::before {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
        }

        .option-btn.correct::before { content: '✓'; }
        .option-btn.incorrect::before { content: '✗'; }
        
        .feedback-message {
            opacity: 0;
            transform: translateY(10px);
            visibility: hidden;
            transition: opacity 0.4s ease-out, transform 0.4s ease-out, visibility 0.4s;
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            color: var(--white-color);
        }

        .feedback-message.show {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .feedback-message.correct { background-color: var(--correct-color); }
        .feedback-message.incorrect { background-color: var(--incorrect-color); }
        .feedback-message.info { background-color: var(--info-color); }

        .modal {
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6);
            display: flex;
            justify-content: center;
            align-items: center;
            direction: rtl;
        }

        .modal-content {
            background-color: var(--white-color);
            padding: 30px;
            border-radius: var(--border-radius-main);
            text-align: center;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            animation: slide-down 0.4s ease-out;
        }

        @keyframes slide-down {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translate3d(0, 30px, 0); }
            to { opacity: 1; transform: translate3d(0, 0, 0); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content h2 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }
        .modal-content p {
            color: var(--text-light);
            font-size: 16px;
        }
        
        #map-scene .options-container .option-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 18px;
            padding: 25px 15px;
        }

        .map-icon {
            font-size: 36px;
            margin-bottom: 5px;
        }

        .progress-bar-container {
            width: 90%;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            height: 10px;
            margin: 10px auto 20px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
        }

        .progress-bar {
            height: 100%;
            width: 0;
            background-color: var(--primary-color);
            transition: width 0.5s ease;
        }

        #faculties-scene .options-container,
        #exchange-scene .options-container,
        #admission-scene .options-container {
            grid-template-columns: 1fr;
            max-width: 400px;
            margin: 25px auto 0;
        }

        #faculties-scene .option-btn,
        #exchange-scene .option-btn,
        #admission-scene .option-btn {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            padding: 20px;
            gap: 20px;
            font-size: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        #faculties-scene .option-btn:hover,
        #exchange-scene .option-btn:hover,
        #admission-scene .option-btn:hover {
            transform: scale(1.03);
            background-color: var(--primary-color);
            color: var(--white-color);
        }

        #faculties-scene .option-btn span,
        #exchange-scene .option-btn span,
        #admission-scene .option-btn span {
            font-size: 30px;
        }

        #grants-info-scene .scene-content,
        #faculties-info-scene .scene-content {
            padding: 0;
        }

        .info-header {
            padding: 25px 25px 20px 25px;
            border-bottom: 1px solid #eee;
        }
        
        .info-scene-container {
            max-height: 60vh;
            overflow-y: auto;
            padding: 20px 25px;
            text-align: right;
        }
        
        .grant-category,
        .exchange-category {
            font-size: 22px;
            font-weight: bold;
            color: var(--primary-dark);
            margin-top: 20px;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--primary-color);
        }
        .grant-category:first-child,
        .exchange-category:first-child {
            margin-top: 0;
        }
        
        .grant-card,
        .exchange-card {
            background-color: #f9f9f9;
            border-right: 5px solid var(--primary-color);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease, border-right-color 0.3s ease;
        }
        .grant-card:hover,
        .exchange-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
            border-right-color: var(--secondary-color);
        }
        
        .grant-card h3,
        .exchange-card h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
            color: var(--primary-dark);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .grant-percentage,
        .exchange-project {
            background-color: var(--secondary-color);
            color: var(--text-dark);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 16px;
            font-weight: bold;
        }

        .grant-details ul,
        .exchange-details ul {
            list-style: none;
            padding-right: 0;
            margin: 0;
            font-size: 14px;
            color: var(--text-light);
        }

        .grant-details li,
        .exchange-details li {
            padding-right: 25px;
            position: relative;
            margin-bottom: 8px;
        }
        .grant-details li::before,
        .exchange-details li::before {
            content: '🔹';
            position: absolute;
            right: 0;
            top: 0;
            color: var(--primary-color);
        }

        .info-footer {
            padding: 20px 25px;
            border-top: 1px solid #eee;
        }
        
        #faculties-info-scene .info-scene-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            text-align: center;
        }

        .college-card {
            background-color: #f9f9f9;
            border-top: 5px solid var(--primary-color);
            border-radius: var(--border-radius-main);
            padding: 25px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .college-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .college-icon {
            font-size: 48px;
            margin-bottom: 15px;
            color: var(--primary-dark);
        }
        
        .college-card h3 {
            margin: 0 0 10px 0;
            font-size: 20px;
            color: var(--primary-color);
        }

        .college-card p {
            font-size: 15px;
            color: var(--text-light);
            line-height: 1.6;
            margin: 0;
        }
        
        #faculties-list-scene .info-scene-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            text-align: right;
        }

        .college-info-card {
            background-color: #f9f9f9;
            border-right: 5px solid var(--primary-color);
            border-radius: var(--border-radius-main);
            padding: 25px 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            cursor: pointer;
        }

        .college-info-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
            border-right-color: var(--secondary-color);
        }

        .college-info-card h3 {
            margin: 0 0 10px 0;
            font-size: 20px;
            color: var(--primary-dark);
        }

        .college-info-card p {
            font-size: 15px;
            color: var(--text-light);
            line-height: 1.6;
            margin: 0;
        }

        #college-website-scene .scene-content {
            padding: 20px;
            height: 85vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        .website-view-header {
            margin-bottom: 15px;
            display: flex;
            justify-content: flex-end;
        }

        .loader-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            color: var(--text-light);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #college-website-iframe {
            width: 100%;
            height: 100%;
            border: 1px solid #ddd;
            border-radius: 10px;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        #college-website-iframe.loaded {
            opacity: 1;
        }

        .admission-card {
            background-color: #f9f9f9;
            border-right: 5px solid var(--primary-color);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: right;
        }
        
        .admission-card h3 {
            font-size: 20px;
            color: var(--primary-dark);
            margin: 0 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
        }
        
        .admission-card ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .admission-card li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .admission-card li:last-child {
            border-bottom: none;
        }

        .admission-card .specialization {
            font-size: 16px;
            color: var(--text-dark);
        }

        .admission-card .score {
            font-size: 16px;
            font-weight: bold;
            color: var(--primary-color);
            background-color: var(--light-bg);
            padding: 4px 10px;
            border-radius: 20px;
        }
        
        .admission-card .score.new-major {
            background-color: var(--secondary-color);
            color: var(--text-dark);
        }

        #status-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: var(--primary-dark);
            color: var(--white-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 25px;
            box-shadow: 0 3px 12px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            box-sizing: border-box;
            border-bottom: 3px solid var(--secondary-color);
            transition: top 0.3s ease-in-out;
        }

        #status-bar.hidden {
            top: -100px;
        }

        .status-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        #player-name-display {
            font-weight: bold;
            font-size: 17px;
        }

        #player-score-display {
            background-color: var(--secondary-color);
            color: var(--text-dark);
            padding: 6px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 16px;
        }

        .status-bar-btn {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--white-color);
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s ease;
        }

        .status-bar-btn:hover {
            background-color: var(--incorrect-color);
            border-color: var(--incorrect-color);
            transform: translateY(-2px);
        }
        
        .status-bar-btn#back-to-map-btn:hover {
            background-color: var(--info-color);
            border-color: var(--info-color);
        }

        .status-section .icon {
            font-size: 22px;
        }

        .ad-modal-content {
            position: relative;
            background-color: transparent;
            padding: 0;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.4);
            border-radius: var(--border-radius-main);
            animation: fadeInUp 0.5s;
        }

        .ad-modal-content img {
            width: 100%;
            display: block;
            border-radius: var(--border-radius-main);
        }

        .close-ad-btn {
            position: absolute;
            top: -15px;
            right: -15px;
            color: #000;
            background-color: var(--white-color);
            font-size: 35px;
            font-weight: bold;
            width: 40px;
            height: 40px;
            line-height: 35px;
            text-align: center;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .close-ad-btn:hover {
            transform: scale(1.1) rotate(90deg);
            color: var(--incorrect-color);
        }
        
        #video-overlay {
            flex-direction: column;
            gap: 20px;
            z-index: 3000;
        }

        #skip-video-btn {
            width: auto;
            padding: 12px 30px;
            background-color: var(--incorrect-color);
            position: absolute;
            bottom: 30px;
            z-index: 3001;
        }

        #skip-video-btn:hover {
            background-color: #a71d2a;
        }
        
        /* --- بداية ستايل شاشة اختيار المرشد (محدّث) --- */
        .guides-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .guide-card {
            background-color: var(--white-color);
            border: 3px solid transparent;
            border-radius: var(--border-radius-main);
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .guide-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.12);
        }

        .guide-card.selected {
            border-color: var(--primary-color);
            background-color: var(--light-bg);
            transform: translateY(-8px);
        }

        .guide-icon {
            font-size: 64px; /* حجم الإيموجي */
            line-height: 1;
            margin-bottom: 15px;
            background-color: var(--light-bg);
            width: 100px;
            height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            border: 4px solid var(--primary-color);
        }

        .guide-card h3 {
            margin: 0 0 5px 0;
            font-size: 20px;
            color: var(--primary-dark);
        }

        .guide-card span {
            font-size: 14px;
            font-weight: bold;
            color: var(--primary-color);
            display: block;
            margin-bottom: 10px;
            min-height: 20px;
        }

        .guide-card p {
            font-size: 13px;
            color: var(--text-light);
            line-height: 1.5;
            margin: 0;
            flex-grow: 1;
        }
        /* --- نهاية ستايل شاشة اختيار المرشد --- */
        
        @media (max-width: 600px) {
            .options-container {
                grid-template-columns: 1fr;
            }

            .features-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }
            .feature-card {
                width: auto; 
                margin-bottom: 0;
            }

            #status-bar {
                padding: 8px 10px;
                flex-direction: column;
                gap: 5px;
                align-items: stretch;
            }

            .status-section {
                width: 100%;
                justify-content: space-between;
                gap: 8px;
            }

            #player-name-display {
                font-size: 15px;
            }

            #player-score-display {
                font-size: 14px;
                padding: 5px 12px;
            }

            .status-bar-btn {
                font-size: 13px;
                padding: 6px 10px;
                gap: 5px;
            }

            .status-section .icon {
                font-size: 20px;
            }

            body {
                padding-top: 125px;
            }
            .guides-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <audio id="correct-sound" src="correct.mp3" preload="auto"></audio>
    <audio id="incorrect-sound" src="funny.mp3" preload="auto"></audio>
    <audio id="transition-sound" src="turning.mp3" preload="auto"></audio>

    <div id="status-bar" class="hidden">
        <div class="status-section">
            <span class="icon">👤</span>
            <span id="player-name-display"></span>
            <span id="player-score-display"></span>
        </div>
        <div class="status-section">
            <a href="#" id="back-to-map-btn" class="status-bar-btn" aria-label="العودة إلى الخريطة">
                <span class="icon">🗺️</span>
                الخريطة
            </a>
            <a href="#" id="logout-btn" class="status-bar-btn" aria-label="الخروج وبدء رحلة جديدة">
                <span class="icon">🚪</span>
                خروج
            </a>
        </div>
    </div>
    <div class="game-container">
        <div id="landing-screen">
            <img src="logo.webp" alt="شعار الجامعة الإسلامية" class="logo" loading="lazy">
            <h1>رحلتك نحو المعرفة والتميز تبدأ الآن</h1>
            <p class="subtitle">تطلق الجامعة الإسلامية بغزة مسابقة تفاعلية فريدة لطلبة الثانوية العامة، استعد لتحدي معلوماتك والفوز بجوائز قيمة.</p>
            <div class="features-grid">
                <div class="feature-card">
                    <span class="icon">🎓</span>
                    <h3>حوّلها إلى منحة</h3>
                    <p>حوّل أرباحك لمنحة دراسية حقيقية عند التحاقك بالجامعة.</p>
                </div>
                <div class="feature-card">
                    <span class="icon">💰</span>
                    <h3>اربح جوائز فورية</h3>
                    <p>اجمع "جنيهات" إلكترونية مع كل إجابة صحيحة تضاف إلى رصيدك.</p>
                </div>
                <div class="feature-card">
                    <span class="icon">🏆</span>
                    <h3>تحديات ممتعة</h3>
                    <p>أجب عن أسئلة شيقة في مجالات متنوعة واختر تخصصك.</p>
                </div>
            </div>
            <button id="show-register-btn" class="action-button">
                <span class="btn-icon">📅</span> لا تفوّت الفرصة - سجّل الآن!
            </button>
            <p class="reset-link-container">
                <a href="#" id="reset-progress-btn">هل تريد بدء رحلة جديدة؟ (سيتم حذف التقدم الحالي)</a>
            </p>
        </div>

        <div id="start-screen" class="hidden">
            <img src="logo.webp" alt="شعار الجامعة الإسلامية" class="logo" loading="lazy">
            <h1>أهلاً بك في رحلتك الافتراضية</h1>
            <p>استكشف الجامعة الإسلامية، أجب عن التحديات، واربح منحة دراسية حقيقية!</p>
            <form id="player-form">
                <div class="form-group">
                    <label for="name">الاسم الكامل:</label>
                    <input type="text" id="name" placeholder="مثال: أحمد علي" required minlength="5">
                </div>
                <div class="form-group">
                    <label for="phone">رقم الجوال:</label>
                    <input type="tel" id="phone" pattern="^05[9|6|4][0-9]{7}$" placeholder="مثال: 059xxxxxxx" required>
                </div>
                <div class="form-group">
                    <label for="tawjihi-year">سنة التوجيهي:</label>
                    <input type="number" id="tawjihi-year" placeholder="مثال: 2024" required min="2000">
                </div>
                <button type="submit" class="action-button" disabled>ابدأ الرحلة!</button>
            </form>
        </div>

        <div id="guide-selection-screen" class="game-stage hidden">
            <div class="scene-content">
                <h2 class="scene-title">اختر مرشدك في الرحلة</h2>
                <p>كل مرشد سيقدم لك نصائح من منظور تخصصه الفريد!</p>
                <div class="guides-container">
                    </div>
                <button id="confirm-guide-btn" class="action-button" disabled style="margin-top: 30px;">
                    تأكيد المرشد والبدء
                </button>
            </div>
        </div>

        <div id="game-scene" class="hidden">
            
            <div id="gate-scene" class="game-stage hidden"></div>
            <div id="map-scene" class="game-stage hidden">
                <div class="scene-content">
                    <h2 class="scene-title">خريطة الجامعة</h2>
                    <p>لقد دخلت الحرم الجامعي! اختر وجهتك التالية لاستكمال رحلتك.</p>
                    <div class="options-container">
                        <button class="option-btn" data-destination="library"><span class="map-icon">📚</span> المكتبة المركزية</button>
                        <button class="option-btn" data-destination="cafeteria"><span class="map-icon">☕</span> الكافتيريا</button>
                        <button class="option-btn" data-destination="faculties-list"><span class="map-icon">🏢</span> الكليات</button>
                        <button class="option-btn" data-destination="grants-info"><span class="map-icon">💰</span> المنح والمساعدات</button>
                        <button class="option-btn" data-destination="hospital"><span class="map-icon">🏥</span> المستشفى الجامعي</button>
                        <button class="option-btn" data-destination="admission-info"><span class="map-icon">📝</span> القبول والتسجيل</button>
                        <button class="option-btn" data-destination="studentaffairs"><span class="map-icon">🧑‍🎓</span> شؤون الطلبة</button>
                        <button class="option-btn" data-destination="conference"><span class="map-icon">🏛️</span> قاعة المؤتمرات</button>
                        <button class="option-btn" data-destination="stadium"><span class="map-icon">🏟️</span> ملعب الجامعة</button>
                        <button class="option-btn" data-destination="exchange-info"><span class="map-icon">🌍</span> التبادل الأكاديمي</button>
                        <button class="option-btn" data-destination="certificate" style="grid-column: 1 / -1;"><span class="map-icon">📜</span> الحصول على الشهادة</button>
                    </div>
                </div>
            </div>
            
            <div id="faculties-list-scene" class="game-stage hidden">
                <div class="scene-content">
                    <div class="info-header">
                        <h2 class="scene-title">🏢 استكشف كليات الجامعة</h2>
                        <p>تعرّف على عالم كل كلية! اضغط على أي بطاقة لتصفح موقعها الرسمي، أو ابدأ تحدي المعلومات مباشرة.</p>
                    </div>
                    
                    <div class="info-scene-container" id="faculties-grid-container">
                    </div>

                    <div class="info-footer">
                        <button id="proceed-to-faculties-quiz-btn" class="action-button">
                            أنا جاهز... ابدأ تحدي الكليات!
                            <span class="btn-icon">🧠</span>
                        </button>
                    </div>
                </div>
            </div>

            <div id="college-website-scene" class="game-stage hidden">
            </div>

            <div id="faculties-scene" class="game-stage hidden"></div>
            <div id="tf_questions-scene" class="game-stage hidden"></div>
            <div id="mc_questions-scene" class="game-stage hidden"></div>
            <div id="exchange-scene" class="game-stage hidden"></div>
            <div id="exchange_tf_questions-scene" class="game-stage hidden"></div>
            <div id="exchange_mc_questions-scene" class="game-stage hidden"></div>
            <div id="library-scene" class="game-stage hidden"></div>
            
            <div id="admission-info-scene" class="game-stage hidden">
                <div class="scene-content">
                    <div class="info-header">
                        <h2 class="scene-title">📝 مفتاح التنسيق 2024-2025</h2>
                        <p>اطلع على معدلات القبول المطلوبة لكليات الجامعة المختلفة قبل بدء التحدي.</p>
                    </div>
                    
                    <div class="info-scene-container" id="admission-info-container">
                    </div>
                    
                    <div class="info-footer">
                        <button id="start-admission-quiz-btn" class="action-button">
                            فهمت... ابدأ التحدي الآن!
                            <span class="btn-icon">💡</span>
                        </button>
                    </div>
                </div>
            </div>

            <div id="admission-scene" class="game-stage hidden"></div>
            <div id="admission_tf_questions-scene" class="game-stage hidden"></div>
            <div id="admission_mc_questions-scene" class="game-stage hidden"></div>
            
            <div id="grants-info-scene" class="game-stage hidden">
                <div class="scene-content">
                    <div class="info-header">
                        <h2 class="scene-title">💰 دليل المنح والمساعدات الطلابية</h2>
                        <p>المعرفة قوة! قبل أن تبدأ التحدي، اطلع على دليل المنح الشامل الذي تقدمه الجامعة. كل معلومة هنا قد تكون مفتاحك للحصول على دعم كبير.</p>
                    </div>
                    
                    <div class="info-scene-container">
                        <h3 class="grant-category">🏆 منح التفوق الأكاديمي</h3>
                        <div class="grant-card">
                            <h3>🥇 منحة الامتياز (حسب المعدل الفصلي) <span class="grant-percentage">70%</span></h3>
                            <div class="grant-details"><ul><li>المعدل المطلوب: 95% - 100% فصلياً</li><li>يجب اجتياز 15 ساعة معتمدة على الأقل.</li></ul></div>
                        </div>
                        <div class="grant-card">
                            <h3>🥈 منحة الامتياز (حسب المعدل الفصلي) <span class="grant-percentage">35%</span></h3>
                            <div class="grant-details"><ul><li>المعدل المطلوب: 90% - 94.9% فصلياً</li><li>يجب اجتياز 15 ساعة معتمدة على الأقل.</li></ul></div>
                        </div>
                        <div class="grant-card">
                            <h3>🎖️ منحة وزارة التربية والتعليم <span class="grant-percentage">70%+</span></h3>
                            <div class="grant-details"><ul><li>المعدل المطلوب: أعلى معدلين في كل كلية</li><li>للاستمرارية: معدل فصلي 80%</li><li>يتم اختيارهم عبر الوزارة.</li></ul></div>
                        </div>

                        <h3 class="grant-category">🎓 منح التخصصات الأكاديمية</h3>
                        <div class="grant-card">
                            <h3>🕌 المنحة الشرعية <span class="grant-percentage">70%</span></h3>
                            <div class="grant-details"><ul><li>للتخصصات: الشريعة الإسلامية، أصول الدين (عام)</li><li>معدل الثانوية: 80% فأكثر</li><li>للاستمرارية: معدل فصلي 80%</li></ul></div>
                        </div>
                            <div class="grant-card">
                            <h3>📚 المنحة الشرعية <span class="grant-percentage">35%</span></h3>
                            <div class="grant-details"><ul><li>للتخصصات: الشريعة الإسلامية، أصول الدين (عام)</li><li>معدل الثانوية: 70% - 79.9%</li><li>للاستمرارية: معدل فصلي 80%</li></ul></div>
                        </div>
                        <div class="grant-card">
                            <h3>🧪 منح كلية العلوم (فيزياء وكيمياء) <span class="grant-percentage">70%</span></h3>
                            <div class="grant-details"><ul><li>منحتان كاملتان سنوياً لكل تخصص (فيزياء/كيمياء)</li><li>للمتفوقين في الثانوية العامة والمادة العلمية.</li></ul></div>
                        </div>

                        <h3 class="grant-category">✨ منح المواهب والفئات الخاصة</h3>
                        <div class="grant-card">
                            <h3>📖 منحة حفظة القرآن الكريم <span class="grant-percentage">50%</span></h3>
                            <div class="grant-details"><ul><li>للاستمرارية: معدل فصلي 80%</li><li>يجب النجاح في امتحان التسميع لكامل القرآن.</li></ul></div>
                        </div>
                        <div class="grant-card">
                            <h3>🏃 المنحة الرياضية <span class="grant-percentage">25-35%</span></h3>
                            <div class="grant-details"><ul><li>للاستمرارية: معدل فصلي 65%</li><li>للطلبة الملتحقين بفرق الجامعة الرياضية.</li></ul></div>
                        </div>
                        <div class="grant-card">
                            <h3>♿ منحة ذوي الاحتياجات الخاصة <span class="grant-percentage">35-70%</span></h3>
                            <div class="grant-details"><ul><li>للاستمرارية: معدل فصلي 65%</li><li>35% للإعاقة (50-69%)، و 70% للإعاقة (70% فأكثر).</li></ul></div>
                        </div>

                        <h3 class="grant-category">👨‍👩‍👧‍👦 منح الدعم الأسري والمجتمعي</h3>
                        <div class="grant-card">
                            <h3>🧑‍🤝‍🧑 منحة الأسرة (شقيقان) <span class="grant-percentage">15%</span></h3>
                            <div class="grant-details"><ul><li>للاستمرارية: معدل 70% (75% للطب)</li><li>لكل طالب على حدة.</li></ul></div>
                        </div>
                            <div class="grant-card">
                            <h3>👪 منحة الأسرة (3 أشقاء) <span class="grant-percentage">25%</span></h3>
                            <div class="grant-details"><ul><li>للاستمرارية: معدل 70% (75% للطب)</li><li>لكل طالب على حدة.</li></ul></div>
                        </div>
                            <div class="grant-card">
                            <h3>👨‍👧‍👦 منحة الأسرة (4 أشقاء فأكثر) <span class="grant-percentage">30%</span></h3>
                            <div class="grant-details"><ul><li>للاستمرارية: معدل 70% (75% للطب)</li><li>لكل طالب على حدة.</li></ul></div>
                        </div>
                        <div class="grant-card">
                            <h3>💼 منحة أبناء العاملين <span class="grant-percentage">50%</span></h3>
                            <div class="grant-details"><ul><li>للاستمرارية: معدل فصلي 65%</li><li>تشمل أبناء العاملين ومجلس الأمناء.</li></ul></div>
                        </div>
                            <div class="grant-card">
                            <h3>❤️ منح الأسرى والشهداء والأيتام <span class="grant-percentage">70%+</span></h3>
                            <div class="grant-details"><ul><li>للاستمرارية: معدل فصلي 80%</li><li>تتوفر منح مختلفة لهذه الفئات وتتطلب إثباتات رسمية.</li></ul></div>
                        </div>
                    </div>

                    <div class="info-footer">
                        <button id="start-grants-quiz-btn" class="action-button">
                            فهمت... ابدأ التحدي الآن!
                            <span class="btn-icon">💡</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div id="grants-scene" class="game-stage hidden"></div>
            
            <div id="exchange-info-scene" class="game-stage hidden">
                <div class="scene-content">
                    <div class="info-header">
                        <h2 class="scene-title">🌍 دليل التبادل الأكاديمي</h2>
                        <p>تهتم العلاقات الخارجية بتوفير فرص تبادل أكاديمي مميزة. تعرّف على هذه الفرص قبل أن تبدأ التحدي.</p>
                    </div>
                    <div class="info-scene-container">
                        <div class="exchange-card">
                            <h3>برامج التبادل الرئيسية</h3>
                            <div class="exchange-details">
                                <ul>
                                    <li>تهدف إلى التبادل الثقافي ونقل الخبرات لتحسين القدرات المؤسسية.</li>
                                    <li>تشمل برامج البكالوريوس، الماجستير، الدكتوراه، وما بعد الدكتوراه.</li>
                                    <li>تُنفذ بالشراكة مع جامعات في أوروبا، تركيا، وماليزيا.</li>
                                </ul>
                            </div>
                        </div>
                        <h3 class="exchange-category">أشهر برامج التبادل</h3>
                        <div class="exchange-card">
                            <h3>Erasmus Mundus <span class="exchange-project">مشاريع تبادل</span></h3>
                            <div class="exchange-details">
                                <ul>
                                    <li>حصلت الجامعة على تمويل لـ 6 مشاريع.</li>
                                    <li>بالشراكة مع 70 جامعة محلية وإقليمية ودولية.</li>
                                    <li>تم تنفيذها خلال الفترة من 2012 وحتى 2017.</li>
                                </ul>
                            </div>
                        </div>
                        <div class="exchange-card">
                            <h3>Erasmus+ <span class="exchange-project">حراك علمي</span></h3>
                            <div class="exchange-details">
                                <ul>
                                    <li>شاركت الجامعة بأكثر من 12 مشروعاً.</li>
                                    <li>مشاريع التبادل الأكاديمي خلال الفترة من 2016-2019.</li>
                                </ul>
                            </div>
                        </div>
                        <div class="exchange-card">
                            <h3>Mevlana <span class="exchange-project">برنامج تركي</span></h3>
                            <div class="exchange-details">
                                <ul>
                                    <li>برنامج التبادل الثقافي التركي.</li>
                                    <li>تمت المشاركة مع 6 جامعات تركية.</li>
                                    <li>تم تنفيذه خلال الفترة من 2013-2021.</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="info-footer">
                        <button id="start-exchange-quiz-btn" class="action-button">
                            فهمت... ابدأ التحدي الآن!
                            <span class="btn-icon">💡</span>
                        </button>
                    </div>
                </div>
            </div>

            <div id="end-scene" class="game-stage hidden">
                <div class="scene-content">
                    <h2 class="scene-title">🎉 تهانينا! 🎉</h2>
                    <img src="https://placehold.co/400x250/28a745/FFFFFF?text=شهادة+شكر" alt="شهادة مشاركة" class="scene-image" style="max-width: 100%; border-radius: 10px; margin-bottom: 20px;" loading="lazy">
                    <p id="final-message" style="font-size: 18px; line-height: 1.6;"></p>
                    <button id="share-btn" class="action-button">مشاركة على وسائل التواصل</button>
                    <button id="new-player-btn" class="action-button" style="margin-top: 10px; background-color: var(--text-light);">بدء رحلة جديدة (لاعب جديد)</button>
                </div>
            </div>
        </div>
    </div>

    <div id="feedback-modal" class="modal hidden">
        <div class="modal-content">
            <h2 id="modal-title"></h2>
            <p id="modal-text"></p>
            <button id="modal-close-btn" class="action-button">متابعة</button>
        </div>
    </div>

    <div id="ad-modal" class="modal hidden">
        <div class="ad-modal-content">
            <span class="close-ad-btn">&times;</span>
            <img src="eng.webp" alt="إعلان كلية الهندسة" loading="lazy">
        </div>
    </div>

    <div id="video-overlay" class="modal hidden">
        <video id="welcome-video" width="90%" style="max-width: 800px; border-radius: 15px;">
            <source src="hares 1.mp4" type="video/mp4">
            متصفحك لا يدعم عرض الفيديو.
        </video>
        <button id="skip-video-btn" class="action-button">تخطي الفيديو</button>
    </div>
    <script>
        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby2RjbdyISPTbhfR8h-lE41eY0lEWEOxZevGyTMxNbpY2zTmRzWa3DEAd5Dc6O72GgtMA/exec';
        
        const form = document.getElementById('player-form');
        if(form){
            const startBtn = form.querySelector('button');
            const inputs = form.querySelectorAll('input[required]');
            form.addEventListener('input', () => {
                startBtn.disabled = !form.checkValidity();
            });
        }

        function registerPlayer(name, phone, year) {
            const formData = new FormData();
            formData.append('action', 'register');
            formData.append('name', name);
            formData.append('phone', phone);
            formData.append('year', year);
            return fetch(SCRIPT_URL, { method: 'POST', body: formData }).then(response => response.json());
        }
        
        function updatePlayerScore(uniqueId, score) {
            if (!uniqueId) {
                console.error("Attempted to update score without a uniqueId.");
                return;
            }
            const formData = new FormData();
            formData.append('action', 'updateScore');
            formData.append('uniqueId', uniqueId);
            formData.append('score', score);
            fetch(SCRIPT_URL, { method: 'POST', body: formData })
                .then(response => response.json())
                .then(data => {
                    if (data.result === 'success') {
                        console.log(`Score updated to: ${score}`);
                    } else {
                        console.error('Error updating score:', data.message);
                    }
                })
                .catch(error => console.error('Error in update fetch:', error));
        }

        function shuffleArray(array) {
            let currentIndex = array.length, randomIndex;
            const newArray = [...array]; 
            
            while (currentIndex !== 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;
                [newArray[currentIndex], newArray[randomIndex]] = [
                    newArray[randomIndex], newArray[currentIndex]
                ];
            }
            return newArray;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const collegesData = [
                { name: 'كلية الطب', description: 'الطب وعلومه وطبيبٌ للمستقبل', url: 'https://medicine.iugaza.edu.ps/', emoji: '⚕️' },
                { name: 'كلية الهندسة', description: 'هندسة المستقبل بكافة مجالات الحياة', url: 'https://eng.iugaza.edu.ps/', emoji: '🏗️' },
                { name: 'كلية تكنولوجيا المعلومات', description: 'عصر التكنولوجيا والمعلوماتية وأمن المعلومات والبيانات', url: 'https://fit.iugaza.edu.ps/', emoji: '💻' },
                { name: 'كلية التمريض', description: 'بذلٌ وعطاءٌ وتفانٍ لكل مريض وفي كل مكان', url: 'https://nursing.iugaza.edu.ps/', emoji: '🩺' },
                { name: 'كلية العلوم الصحية', description: 'العلاج السليم يبدأ من هنا', url: 'https://healthscience.iugaza.edu.ps/', emoji: '🧬' },
                { name: 'كلية العلوم', description: 'علوم الطبيعة وأسرار الكون', url: 'https://science.iugaza.edu.ps/', emoji: '🔬' },
                { name: 'كلية الآداب', description: 'علمٌ ولغاتٌ وأدبٌ وثقافة الأمم المختلفة قديماً وحديثاً', url: 'https://arts.iugaza.edu.ps/', emoji: '📚' },
                { name: 'كلية الشريعة والقانون', description: 'دراسة للشريعة الاسلامية والمحاماة على مبادئ الشريعة السمحة', url: 'https://sharea.iugaza.edu.ps/', emoji: '⚖️' },
                { name: 'كلية أصول الدين', description: 'الدين الإسلامي ، أصوله وأحكامه', url: 'https://osool.iugaza.edu.ps/', emoji: '🕌' },
                { name: 'كلية التربية', description: 'معلمٌ .. يربي أجيال المستقبل المستنيرة', url: 'https://education.iugaza.edu.ps/', emoji: '👩‍🏫' },
                { name: 'كلية الاقتصاد والعلوم الإدارية', description: 'بناء الاقتصاد والإدارة السليمة والمال', url: 'https://commerce.iugaza.edu.ps/', emoji: '💼' }
            ];

            // --- START: بيانات المرشدين المحدّثة ---
            const allGuides = [
                { id: 'medicine', name: 'د. خالد', college: 'كلية الطب', emoji: '⚕️', description: 'الدقة والتشخيص السليم هما مفتاح النجاح. سأرشدك في رحلة معرفية صحية.' },
                { id: 'engineering', name: 'م. سارة', college: 'كلية الهندسة', emoji: '🏗️', description: 'كل مشروع عظيم يبدأ بتصميم دقيق. لنبني مستقبلك خطوة بخطوة.' },
                { id: 'it', name: 'مبرمج بدر', college: 'كلية تكنولوجيا المعلومات', emoji: '💻', description: 'في عالم الأكواد، كل مشكلة لها حل. سأساعدك على التفكير بمنطقية وإيجاد الحلول.' },
                { id: 'nursing', name: 'ممرضة أمل', college: 'كلية التمريض', emoji: '🩺', description: 'الرحمة والعناية هما أساس مهنتنا. سأكون بجانبك لألهمك العطاء.' },
                { id: 'health_sciences', name: 'أخصائي رامي', college: 'كلية العلوم الصحية', emoji: '🧬', description: 'صحة المجتمع تبدأ من المختبر. معًا سنكتشف أسرار الوقاية والعلاج.' },
                { id: 'sciences', name: 'عالمة نور', college: 'كلية العلوم', emoji: '🔬', description: 'الكون مليء بالأسئلة، والعلوم هي وسيلتنا للإجابة. دعنا نستكشف بشغف.' },
                { id: 'arts', name: 'أديبة ليلى', college: 'كلية الآداب', emoji: '📚', description: 'الكلمات تبني الحضارات. سأجعل رحلتك مليئة بالإبداع والمعاني الجميلة.' },
                { id: 'law', name: 'فقيه يوسف', college: 'كلية الشريعة والقانون', emoji: '⚖️', description: 'العدل هو أساس الملك. سأعلمك كيف توازن بين الحقوق والواجبات.' },
                { id: 'religion', name: 'داعية إيمان', college: 'كلية أصول الدين', emoji: '🕌', description: 'العلم بالدين ينير الدرب. سأرافقك في رحلة لفهم مقاصد شريعتنا السمحة.' },
                { id: 'education', name: 'أستاذة هدى', college: 'كلية التربية', emoji: '👩‍🏫', description: 'بناء الأجيال هو أسمى الرسالات. معًا سنتعلم كيف نلهم العقول ونبني المستقبل.' },
                { id: 'economics', name: 'خبير مالي', college: 'كلية الاقتصاد', emoji: '💼', description: 'فهم المال والاقتصاد هو مفتاح بناء مستقبل مزدهر. دعنا نخطط لنجاحك.' }
            ];

            const guideMessages = {
                'gate': {
                    medicine: "مرحباً بك! الدخول للجامعة يشبه التشخيص الأول، يجب أن يكون دقيقاً. ركز جيداً.",
                    engineering: "أهلاً بك. هذه البوابة هي أساس مشروعك التعليمي. لنبدأ ببناء متين!",
                    it: "مصادقة ناجحة! لقد تجاوزت جدار الحماية الأول. أهلاً بك في نظام الجامعة.",
                    nursing: "تماماً مثل استقبال المريض، نرحب بك بحرارة. رحلتك نحو العطاء تبدأ الآن.",
                    health_sciences: "العينة الأولى هي سؤال الدخول! حلله بعناية لتكشف الإجابة الصحيحة.",
                    sciences: "مرحباً أيها الباحث! كل اكتشاف عظيم يبدأ بفرضية. ما هي فرضيتك للإجابة الصحيحة؟",
                    arts: "لكل قصة بداية، وهذه بداية قصتك الجامعية. اجعلها بداية مُلهمة.",
                    law: "قبل الدخول، يجب التأكد من استيفاء الشروط. هل أنت مستعد لإثبات جدارتك؟",
                    religion: "بسم الله نبدأ. هذه البوابة هي مدخلك إلى صرح من صروح العلم والإيمان.",
                    education: "أهلاً بك في الفصل الأول من رحلتك. كل إجابة صحيحة هي خطوة نحو إلهام الآخرين.",
                    economics: "هذه أول صفقة لك! استثمر تركيزك جيداً لتحقيق أول ربح في رصيدك."
                },
                'library': {
                    medicine: "المكتبة هي مصدر الأبحاث الطبية الحديثة. كل كتاب هنا قد ينقذ حياة في المستقبل.",
                    engineering: "هنا تجد المخططات والمراجع لبناء أي شيء تتخيله. المعرفة هي أقوى مواد البناء.",
                    it: "المكتبة هي قاعدة بياناتنا الضخمة. ابحث جيداً وستجد الخوارزمية الصحيحة لحل أي تحدٍ.",
                    nursing: "كما نحتاج للمراجع لمعرفة أفضل طرق الرعاية، ستجد هنا كل ما تحتاجه لتغذية عقلك.",
                    health_sciences: "نتائج أبحاثنا تعتمد على دقة مصادرنا. المكتبة هي مختبرك النظري الأول.",
                    sciences: "هنا تجد أبحاث من سبقونا. قف على أكتاف العمالقة لترى أبعد.",
                    arts: "الكتب هي غذاء الروح. استلهم من قصص العظماء هنا لتكتب قصتك الخاصة.",
                    law: "هنا تجد نصوص القوانين والسوابق القضائية. كل قضية ناجحة تبدأ ببحث دقيق.",
                    religion: "هذه رياض من رياض الجنة. هنا كتب التفسير والحديث التي تنير العقل والقلب.",
                    education: "المكتبة هي مصدر إعداد الدروس للمستقبل. كلما قرأت أكثر، زادت قدرتك على التعليم.",
                    economics: "هنا تجد نظريات كبار الاقتصاديين. دراسة الماضي هي أفضل طريقة للتنبؤ بالمستقبل."
                },
                'faculties-list': {
                    medicine: "ستجد كلية الطب هنا، حيث نتعلم كيف ننقذ الأرواح. اختر بحكمة وشغف.",
                    engineering: "هذه منطقة الكليات، وكليتي (الهندسة) هنا! كل مبنى يحمل معرفة مختلفة. استكشف بشغف.",
                    it: "هذه هي الشبكة الرئيسية للكليات. كل كلية تمثل خادماً (Server) للمعرفة. إلى أي واحد ستتصل؟",
                    nursing: "هنا تتوزع أقسام المستشفى التعليمي... عفواً، أقصد كليات الجامعة. كل كلية تقدم نوعاً فريداً من الرعاية.",
                    health_sciences: "كل كلية هنا تختص بمجال حيوي. استكشفها لتجد المجال الذي يثير شغفك.",
                    sciences: "هذه الكليات تمثل فروع شجرة المعرفة. أي فرع ستختار لتتسلقه؟",
                    arts: "كل كلية هنا تمثل فصلاً في كتاب الجامعة الكبير. أي فصل ستختار أن تقرأ؟",
                    law: "أمامك هيئات تشريعية مختلفة للمعرفة. اختر الهيئة التي ستنتمي إليها.",
                    religion: "كل كلية هنا هي منبر علم. اختر المنبر الذي ستنهل منه العلم الشرعي.",
                    education: "هذه هي الفصول الدراسية للجامعة. اختر الفصل الذي ستتعلم فيه لكي تُعلِّم.",
                    economics: "هذه هي أسواق المعرفة المختلفة. كل كلية لها أصولها وقيمتها. استثمر في مستقبلك."
                }
            };
            // --- END: بيانات المرشدين المحدّثة ---

            const gameData = {
                'gate': { id: 'gate_q1', image: 'hares 1.webp', question: 'أهلاً بك في الجامعة الإسلامية! للدخول، أجب عن السؤال التالي: في أي عام تأسست الجامعة؟', options: { '1978': '1978', '1982': '1982', '1960': '1960', '1990': '1990' }, correctAnswer: '1978', points: 1, correctFeedback: 'رائع! لقد حصلت على جنيه واحد. البوابة الآن مفتوحة أمامك!', incorrectFeedback: 'إجابة غير صحيحة. حاول مرة أخرى!' },
                'library': [ { id: 'library_q1', image: 'library_question.webp', question: 'تضم مكتبتنا كنزاً معرفياً ضخماً. كم عدد المراجع الإلكترونية التي توفرها؟', options: { '100k': 'أكثر من 100 ألف مرجع الكتروني', '150k': 'أكثر من 150 ألف مرجع الكتروني', '50k': 'أقل من 50 ألف مرجع الكتروني', '200k': 'أكثر من 200 ألف مرجع الكتروني' }, correctAnswer: '150k', points: 1, correctFeedback: 'إجابة ممتازة! معرفتك دقيقة. لقد ربحت جنيهًا واحدًا. لننتقل للتحدي التالي.', incorrectFeedback: 'حاول مرة أخرى! المعرفة قوة.' }, { id: 'library_q2', image: 'library_question_2.webp', question: 'هل توفر المكتبة قاعات هادئة ومخصصة للدراسة؟', options: { 'yes': 'نعم، توفر قاعات هادئة', 'no': 'لا، المكتبة للكتب فقط' }, correctAnswer: 'yes', points: 1, correctFeedback: 'بالتأكيد! راحتك أثناء الدراسة تهمنا. لقد ربحت جنيهًا واحدًا إضافيًا.', incorrectFeedback: 'إجابة غير صحيحة. المكتبة مكان مثالي للدراسة.' }, { id: 'library_q3', image: 'library_question_3.webp', question: 'كيف تساعدك المكتبة في أبحاثك الجامعية؟', options: { 'resources': 'توفر مصادر ومراجع متنوعة', 'writes_for_you': 'تكتب البحث بدلاً عنك' }, correctAnswer: 'resources', points: 1, correctFeedback: 'صحيح! المكتبة هي شريكك الأول في البحث العلمي. ربحت جنيهًا واحدًا.', incorrectFeedback: 'إجابة غير دقيقة. المكتبة تدعمك بالمصادر لا بالقيام بالعمل عنك.' }, { id: 'library_q4', image: 'library_question_4.webp', question: 'هل توفر المكتبة مواد رقمية يمكن الوصول إليها عن بعد؟', options: { 'yes_ebooks': 'نعم، توفر كتباً إلكترونية', 'no_digital': 'لا، كل المواد ورقية فقط' }, correctAnswer: 'yes_ebooks', points: 1, correctFeedback: 'أحسنت! يمكنك الوصول لكنز معرفي من أي مكان. لقد ربحت آخر جنيه في هذه المرحلة.', incorrectFeedback: 'إجابة غير صحيحة. العصر الرقمي في قلب مكتبتنا.' } ],
                'faculties-list': { isInfoScreen: true, nextScene: 'faculties' },
                'faculties': { image: 'first_faculties_q.webp', question: 'اختر نوع التحدي الذي تود خوضه هنا:', options: { 'tf_questions': '<span class="icon">✔️❌</span> أسئلة صح وخطأ', 'mc_questions': '<span class="icon">❓</span> أسئلة اختيار من متعدد' }, correctAnswer: null, points: 0, nextScene: { 'tf_questions': 'tf_questions', 'mc_questions': 'mc_questions' } },
                'tf_questions': [ { id: 'tf_q1', image: 'all_q.webp', question: 'تأسست الجامعة الإسلامية بغزة عام 1978.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'tf_q2', image: 'all_q.webp', question: 'الجامعة لديها 11 كلية.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'tf_q3', image: 'all_q.webp', question: 'كلية الطب تأسست عام 2006.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'tf_q4', image: 'all_q.webp', question: 'كلية تكنولوجيا المعلومات أُسست قبل كلية التجارة.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'incorrect', points: 1, correctFeedback: 'خطأ! كلية التجارة تأسست عام 1981، بينما تكنولوجيا المعلومات تأسست عام 2005. ربحت جنيهاً.' }, { id: 'tf_q5', image: 'all_q.webp', question: 'الجامعة تقدم شهادات دكتوراة (PhD) في الإدارة، الاقتصاد، الهندسة، الفنون، وتكنولوجيا المعلومات.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'tf_q6', image: 'all_q.webp', question: 'الجامعة الأولى على مستوى غزة من حيث الترتيب العالمي.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'tf_q7', image: 'all_q.webp', question: 'في كلية الطب، يجب على الطالب نشر بحث علمي في مجلة محكّمة كجزء من متطلبات التخرج.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'tf_q8', image: 'all_q.webp', question: 'كلية الطب هي المركز الوحيد المعتمد لإجراء امتحانات IFOM داخل غزة.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'tf_q9', image: 'all_q.webp', question: 'الجامعة مقرها فقط في مدينة غزة، ولا يوجد لها فروع أخرى.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'incorrect', points: 1, correctFeedback: 'خطأ! للجامعة فروع في وسط قطاع غزة (الزهراء) وجنوبه. ربحت جنيهاً.' }, { id: 'tf_q10', image: 'all_q.webp', question: 'الجامعة عضو في الاتحاد الدولي للجامعات ومجموعة جامعات البحر الأبيض المتوسط.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'tf_q11', image: 'all_q.webp', question: 'لدى الجامعة أكثر من 20 مركزًا ومعهدًا بحثيًا.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'tf_q12', image: 'all_q.webp', question: 'تأسست كلية التربية قبل كلية الشريعة والأصول.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'incorrect', points: 1, correctFeedback: 'خطأ! كلية الشريعة والأصول تأسست عام 1978، بينما كلية التربية تأسست عام 1980. ربحت جنيهاً.' }, { id: 'tf_q13', image: 'all_q.webp', question: 'الجامعة رائدة في خدمات البحث والتعليم في غزة منذ أكثر من 38 عامًا.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 } ],
                'mc_questions': [ { id: 'mc_q1', image: 'all_q.webp', question: 'كم عدد الكليات في الجامعة الإسلامية بغزة؟', options: { '11': '11', '9': '9', '10': '10', '12': '12' }, correctAnswer: '11', points: 1 }, { id: 'mc_q2', image: 'all_q.webp', question: 'أي من الكليات التالية ليست من كليات الجامعة؟', options: { 'it': 'تكنولوجيا المعلومات', 'الفنون': 'الفنون', 'الطب': 'الطب', 'الهندسة': 'الهندسة' }, correctAnswer: 'الفنون', points: 1 }, { id: 'mc_q3', image: 'all_q.webp', question: 'متى تأسست كلية الطب بالجامعة؟', options: { '2006': '2006', '1980': '1980', '1993': '1993', '2005': '2005' }, correctAnswer: '2006', points: 1 }, { id: 'mc_q4', image: 'all_q.webp', question: 'أي من التالي يصف مكانة الجامعة على مستوى غزة؟', options: { 'الأولى': 'الأولى', 'الثالثة': 'الثالثة', 'الرابعة': 'الرابعة', 'الثانية': 'الثانية' }, correctAnswer: 'الأولى', points: 1 }, { id: 'mc_q5', image: 'all_q.webp', question: 'في أي كلية يجب على الطالب اجتياز امتحاني IFOM-BSE وIFOM-CSE للتخرج؟', options: { 'الطب': 'الطب', 'الهندسة': 'الهندسة', 'it': 'تكنولوجيا المعلومات', 'التربية': 'التربية' }, correctAnswer: 'الطب', points: 1 }, { id: 'mc_q6', image: 'all_q.webp', question: 'من بين هذه الكليات، أيها تأسست أولاً؟', options: { 'التربية (1980)': 'التربية (1980)', 'تكنولوجيا المعلومات (2005)': 'تكنولوجيا المعلومات (2005)', 'التجارة (1981)': 'التجارة (1981)', 'الطب (2006)': 'الطب (2006)' }, correctAnswer: 'التربية (1980)', points: 1 }, { id: 'mc_q7', image: 'all_q.webp', question: 'أي من الاتحادات التالية الجامعة عضو فيها؟', options: { 'اتحاد البحر المتوسط لجامعات': 'اتحاد البحر المتوسط لجامعات', 'رابطة الجامعات الأمريكية': 'رابطة الجامعات الأمريكية', 'روسيا الجامعات الإسلامية': 'روسيا الجامعات الإسلامية', 'رابطة الجامعات الصينية': 'رابطة الجامعات الصينية' }, correctAnswer: 'اتحاد البحر المتوسط لجامعات', points: 1 }, { id: 'mc_q8', image: 'all_q.webp', question: 'كم عدد المراكز والمعاهد البحثية بالجامعة؟', options: { 'أكثر من 20': 'أكثر من 20', 'أقل من 10': 'أقل من 10', 'حوالي 15': 'حوالي 15', '30 فقط': '30 فقط' }, correctAnswer: 'أكثر من 20', points: 1 }, { id: 'mc_q9', image: 'all_q.webp', question: 'ما السنة التي تقدّمت فيها الجامعة 304 مرتبة في الترتيب العالمي (Webometrics)؟', options: { '2022': '2022', '2020': '2020', '2021': '2021', '2023': '2023' }, correctAnswer: '2022', points: 1 }, { id: 'mc_q10', image: 'all_q.webp', question: 'ما الترتيب العربي للجامعة حسب Webometrics؟', options: { '77': '77', '50': '50', '100': '100', '125': '125' }, correctAnswer: '77', points: 1 }, { id: 'mc_q11', image: 'all_q.webp', question: 'الجامعة توصّلت إلى شراكة بحثية مع...؟', options: { 'معهد التربية بجامعة UCL': 'معهد التربية بجامعة UCL', 'جامعة هارفارد': 'جامعة هارفارد', 'جامعة لندن للعلوم': 'جامعة لندن للعلوم', 'جامعة كامبريدج': 'جامعة كامبريدج' }, correctAnswer: 'معهد التربية بجامعة UCL', points: 1 }, { id: 'mc_q12', image: 'all_q.webp', question: 'أي من التالي يشكّل جزءًا من أهداف كلية الطب؟', options: { 'إعداد أطباء تلبية لاحتياجات المجتمع': 'إعداد أطباء تلبية لاحتياجات المجتمع', 'إعداد مهندسين مدنيين': 'إعداد مهندسين مدنيين', 'تطوير برامج الإدارة فقط': 'تطوير برامج الإدارة فقط', 'نشر الفكر الفلسفي فقط': 'نشر الفكر الفلسفي فقط' }, correctAnswer: 'إعداد أطباء تلبية لاحتياجات المجتمع', points: 1 }, { id: 'mc_q13', image: 'all_q.webp', question: 'من كان أول عميد لكلية الطب في الجامعة الإسلامية بغزة؟', options: { 'د. مفيد المخللاتي': 'د. مفيد المخللاتي', 'د. فاضل نعيم': 'د. فاضل نعيم', 'د. أنور شيخ خليل': 'د. أنور شيخ خليل', 'د. نصر المزين': 'د. نصر المزين' }, correctAnswer: 'د. مفيد المخللاتي', points: 1 }, { id: 'mc_q14', image: 'all_q.webp', question: 'أي من التالي يعبّر عن وصف الجامعة بأنها "بيت الطالب الفلسطيني"؟', options: { 'جامعة مستقلة عريقة في خدمة الطلبة الفلسطينيين': 'جامعة مستقلة عريقة في خدمة الطلبة الفلسطينيين', 'جامعة فلسطينية خاصة': 'جامعة فلسطينية خاصة', 'مؤسسة تعليمية فقط': 'مؤسسة تعليمية فقط', 'كلية تقنية فقط': 'كلية تقنية فقط' }, correctAnswer: 'جامعة مستقلة عريقة في خدمة الطلبة الفلسطينيين', points: 1 }, { id: 'mc_q15', image: 'all_q.webp', question: 'أي كلية تضم برنامج "هندسة النظم الذكية"؟', options: { 'كلية الهندسة': 'كلية الهندسة', 'كلية تكنولوجيا المعلومات': 'كلية تكنولوجيا المعلومات', 'كلية العلوم': 'كلية العلوم', 'كلية الآداب': 'كلية الآداب' }, correctAnswer: 'كلية الهندسة', points: 1 }, { id: 'mc_q16', image: 'all_q.webp', question: 'أي المسارات التالية موجود ضمن "هندسة النظم الذكية"؟', options: { 'أنظمة الطاقة الذكية': 'أنظمة الطاقة الذكية', 'هندسة الطيران': 'هندسة الطيران', 'هندسة البترول': 'هندسة البترول', 'هندسة الطب الحيوي': 'هندسة الطب الحيوي' }, correctAnswer: 'أنظمة الطاقة الذكية', points: 1 }, { id: 'mc_q17', image: 'all_q.webp', question: 'أيٌّ مما يلي يُعد مسارًا ضمن برنامج الهندسة المعمارية؟', options: { 'تصميم داخلي': 'تصميم داخلي', 'هندسة البحار': 'هندسة البحار', 'الهندسة الطبية': 'الهندسة الطبية', 'الكيمياء الحيوية': 'الكيمياء الحيوية' }, correctAnswer: 'تصميم داخلي', points: 1 }, { id: 'mc_q18', image: 'all_q.webp', question: 'أي درجة دكتوراه تُطرح في كلية الهندسة؟', options: { 'دكتوراه هندسة الحاسوب': 'دكتوراه هندسة الحاسوب', 'دكتوراه طب الأسنان': 'دكتوراه طب الأسنان', 'دكتوراه الإعلام': 'دكتوراه الإعلام', 'دكتوراه الترجمة': 'دكتوراه الترجمة' }, correctAnswer: 'دكتوراه هندسة الحاسوب', points: 1 }, { id: 'mc_q19', image: 'all_q.webp', question: 'أيٌّ من المختبرات التالية مُدرج ضمن مختبرات قسم الهندسة الكهربائية؟', options: { 'مختبر المعالجات والمتحكمات الدقيقة': 'مختبر المعالجات والمتحكمات الدقيقة', 'مختبر الأحياء الدقيقة': 'مختبر الأحياء الدقيقة', 'مختبر التشريح': 'مختبر التشريح', 'مختبر الصحافة التلفزيونية': 'مختبر الصحافة التلفزيونية' }, correctAnswer: 'مختبر المعالجات والمتحكمات الدقيقة', points: 1 }, { id: 'mc_q20', image: 'all_q.webp', question: 'أي برنامج "بكالوريوس" يوجد في كلية الآداب؟', options: { 'الإعلام الرقمي': 'الإعلام الرقمي', 'هندسة الذكاء الاصطناعي': 'هندسة الذكاء الاصطناعي', 'التمريض': 'التمريض', 'الطب البشري': 'الطب البشري' }, correctAnswer: 'الإعلام الرقمي', points: 1 }, { id: 'mc_q21', image: 'all_q.webp', question: 'أي مسمّى صحيح لتخصص ضمن "الصحافة والإعلام" بكلية الآداب؟', options: { 'علاقات عامة وإعلان': 'علاقات عامة وإعلان', 'تصميم ميكاترونيكس': 'تصميم ميكاترونيكس', 'هندسة كيميائية': 'هندسة كيميائية', 'نظم معلومات صحية': 'نظم معلومات صحية' }, correctAnswer: 'علاقات عامة وإعلان', points: 1 }, { id: 'mc_q22', image: 'all_q.webp', question: 'أي خيار يُمثّل فرعيًا موجودًا في قسم اللغة العربية بكلية الآداب؟', options: { 'تدقيق لغوي': 'تدقيق لغوي', 'جراحة عامة': 'جراحة عامة', 'هندسة موانئ': 'هندسة موانئ', 'فيزياء طبية': 'فيزياء طبية' }, correctAnswer: 'تدقيق لغوي', points: 1 }, { id: 'mc_q23', image: 'all_q.webp', question: 'أي "مساق" وارد في خطة برنامج اللغة الإنجليزية/فرعي ترجمة (سنة رابعة – فصل ثانٍ)؟', options: { 'الترجمة الفورية': 'الترجمة الفورية', 'فيزياء الكم': 'فيزياء الكم', 'تشريح الإنسان': 'تشريح الإنسان', 'مقاومة المواد': 'مقاومة المواد' }, correctAnswer: 'الترجمة الفورية', points: 1 }, { id: 'mc_q24', image: 'all_q.webp', question: 'أي مركز يتبع كلية الآداب؟', options: { 'مركز التاريخ الشفوي والتراث الفلسطيني': 'مركز التاريخ الشفوي والتراث الفلسطيني', 'مركز طب المناطق الحارة': 'مركز طب المناطق الحارة', 'مركز تحلية المياه': 'مركز تحلية المياه', 'مركز الذكاء الاصطناعي الطبي': 'مركز الذكاء الاصطناعي الطبي' }, correctAnswer: 'مركز التاريخ الشفوي والتراث الفلسطيني', points: 1 }, { id: 'mc_q25', image: 'all_q.webp', question: 'أيٌّ من الآتي "برنامج/تخصص" بكالوريوس في كلية العلوم؟', options: { 'التكنولوجيا الحيوية': 'التكنولوجيا الحيوية', 'هندسة البترول': 'هندسة البترول', 'طب الأسنان': 'طب الأسنان', 'علوم سياسية': 'علوم سياسية' }, correctAnswer: 'التكنولوجيا الحيوية', points: 1 }, { id: 'mc_q26', image: 'all_q.webp', question: 'أي عبارة صحيحة تخص قسم الرياضيات بكلية العلوم؟', options: { 'أطلق أول برنامج دكتوراه في الرياضيات بقطاع غزة عام 2014': 'أطلق أول برنامج دكتوراه في الرياضيات بقطاع غزة عام 2014', 'لا يطرح برامج دراسات عليا': 'لا يطرح برامج دراسات عليا', 'أول ماجستير بدأ عام 2022': 'أول ماجستير بدأ عام 2022', 'يمنح فقط بكالوريوس': 'يمنح فقط بكالوريوس' }, correctAnswer: 'أطلق أول برنامج دكتوراه في الرياضيات بقطاع غزة عام 2014', points: 1 }, { id: 'mc_q27', image: 'all_q.webp', question: 'أين يقع "الفرع الرئيس" للجامعة بحسب الصفحة الرسمية؟', options: { 'شارع الثلاثيني – حي الرمال – غزة': 'شارع الثلاثيني – حي الرمال – غزة', 'خان يونس': 'خان يونس', 'رفح': 'رفح', 'دير البلح': 'دير البلح' }, correctAnswer: 'شارع الثلاثيني – حي الرمال – غزة', points: 1 }, { id: 'mc_q28', image: 'all_q.webp', question: 'أي خدمة/منصة تظهر ضمن روابط الخدمات الإلكترونية في الواجهة الرئيسية للموقع؟', options: { 'Moodle': 'Moodle', 'Coursera': 'Coursera', 'edX': 'edX', 'Khan Academy': 'Khan Academy' }, correctAnswer: 'Moodle', points: 1 }, { id: 'mc_q29', image: 'all_q.webp', question: 'أي خبر جامعي نُشر بتاريخ 9 أغسطس 2025؟', options: { 'حصول الجامعة على اعتماد لافتتاح برنامج هندسة الذكاء الاصطناعي': 'حصول الجامعة على اعتماد لافتتاح برنامج هندسة الذكاء الاصطناعي', 'افتتاح مكتبة الطب': 'افتتاح مكتبة الطب', 'تخريج دفعة 2026': 'تخريج دفعة 2026', 'اعتماد برنامج طب الأسنان': 'اعتماد برنامج طب الأسنان' }, correctAnswer: 'حصول الجامعة على اعتماد لافتتاح برنامج هندسة الذكاء الاصطناعي', points: 1 }, { id: 'mc_q30', image: 'all_q.webp', question: 'أي عبارة صحيحة عن كلية الهندسة؟', options: { 'تضم قسم هندسة الحاسوب وتطرح له خطة دراسية وبرنامج ماجستير': 'تضم قسم هندسة الحاسوب وتطرح له خطة دراسية وبرنامج ماجستير', 'لا تضم أي أقسام للحاسوب': 'لا تضم أي أقسام للحاسوب', 'لا تملك مختبرات': 'لا تملك مختبرات', 'لا تقدم دراسات عليا': 'لا تقدم دراسات عليا' }, correctAnswer: 'تضم قسم هندسة الحاسوب وتطرح له خطة دراسية وبرنامج ماجستير', points: 1 }, { id: 'mc_q31', image: 'all_q.webp', question: 'أيٌّ من التالي برنامج داخل كلية تكنولوجيا المعلومات؟', options: { 'الذكاء الاصطناعي وعلوم البيانات': 'الذكاء الاصطناعي وعلوم البيانات', 'إدارة المستشفيات': 'إدارة المستشفيات', 'العلوم السياسية': 'العلوم السياسية', 'الصيدلة': 'الصيدلة' }, correctAnswer: 'الذكاء الاصطناعي وعلوم البيانات', points: 1 }, { id: 'mc_q32', image: 'all_q.webp', question: 'أي من "المساقات" التالية يندرج ضمن برنامج اللغة الإنجليزية/صحافة وإعلام أو فرعي ترجمة (كلية الآداب)؟', options: { 'الترجمة التجارية والأكاديمية': 'الترجمة التجارية والأكاديمية', 'مقاومة المواد': 'مقاومة المواد', 'تشريح مقارن': 'تشريح مقارن', 'أساسيات الدوائر الكهربائية': 'أساسيات الدوائر الكهربائية' }, correctAnswer: 'الترجمة التجارية والأكاديمية', points: 1 }, { id: 'mc_q33', image: 'all_q.webp', question: 'أيٌّ مما يلي يعدّ "برنامج ماجستير" مذكورًا تحت كلية الآداب؟', options: { 'ماجستير الصحافة': 'ماجستير الصحافة', 'ماجستير هندسة الميكاترونيكس': 'ماجستير هندسة الميكاترونيكس', 'ماجستير التحاليل الطبية': 'ماجستير التحاليل الطبية', 'ماجستير طب الفم والأسنان': 'ماجستير طب الفم والأسنان' }, correctAnswer: 'ماجستير الصحافة', points: 1 } ],
                'exchange-info': { isInfoScreen: true, nextScene: 'exchange' },
                'exchange': { image: 'all_q.webp', question: 'اختر نوع التحدي الذي تود خوضه هنا:', options: { 'exchange_tf_questions': '<span class="icon">✔️❌</span> أسئلة صح وخطأ', 'exchange_mc_questions': '<span class="icon">❓</span> أسئلة اختيار من متعدد' }, correctAnswer: null, points: 0, nextScene: { 'exchange_tf_questions': 'exchange_tf_questions', 'exchange_mc_questions': 'exchange_mc_questions' } },
                'exchange_tf_questions': [ { id: 'ex_tf_q1', image: 'all_q.webp', question: 'تهتم العلاقات الخارجية في الجامعة بتوفير منح بكالوريوس، ماجستير، دكتوراه وما بعد الدكتوراه في جامعات عالمية مثل هارفارد وأوكسفورد وغيرها.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'ex_tf_q2', image: 'all_q.webp', question: 'الجامعة عضو في شبكة جامعات البحر الأسود وشرق البحر المتوسط (BSEMAN).', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'ex_tf_q3', image: 'all_q.webp', question: 'العلاقات الخارجية أبرمت مشاريع تبادل أكاديمي ضمن برنامج Erasmus+ مع جامعة جلاسكو وجامعة Algarve.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'ex_tf_q4', image: 'all_q.webp', question: 'إحدى اتفاقيات التبادل مع جامعة جلاسكو دعمت تبادل طلبة وأعضاء هيئة تدريس ضمن فترة 2016–2019.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'ex_tf_q5', image: 'all_q.webp', question: 'نظمت العلاقات الخارجية ورشة عمل خاصة بالمشاريع الأوروبية مثل Erasmus+ وTEMPUS وبرنامج المقدسي.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'ex_tf_q6', image: 'all_q.webp', question: 'تم الترتيب لعقد مؤتمر دولي في الأبحاث الإدارية والاقتصادية بتمويل من Erasmus+ ضمن مشروع BERC.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 } ],
                'exchange_mc_questions': [ { id: 'ex_mc_q1', image: 'all_q.webp', question: 'أياً من الخدمات التالية تتولّاها دائرة العلاقات الخارجية؟', options: { 'توفير منح دراسية دولية والتبادل الأكاديمي واستقطاب الباحثين': 'توفير منح دراسية دولية والتبادل الأكاديمي واستقطاب الباحثين', 'تأمين المنح الدراسية فقط': 'تأمين المنح الدراسية فقط', 'تنظيم الرحلات السياحية': 'تنظيم الرحلات السياحية', 'إصدار التراخيص الحكومية': 'إصدار التراخيص الحكومية' }, correctAnswer: 'توفير منح دراسية دولية والتبادل الأكاديمي واستقطاب الباحثين', points: 1 }, { id: 'ex_mc_q2', image: 'all_q.webp', question: 'ما البرنامج الأوروبي الذي فتح المجال لتبادل أعضاء هيئة التدريس والطلبة مع جامعات كالاسكوتلندية والبرتغالية؟', options: { 'Erasmus+ (Key Action 1)': 'Erasmus+ (Key Action 1)', 'Horizon 2020': 'Horizon 2020', 'Marie Skłodowska-Curie': 'Marie Skłodowska-Curie', 'Erasmus Mundus': 'Erasmus Mundus' }, correctAnswer: 'Erasmus+ (Key Action 1)', points: 1 }, { id: 'ex_mc_q3', image: 'all_q.webp', question: 'أي مشروع كان موجّهًا لتطوير مراكز الأبحاث الإدارية والاقتصادية والمعروف اختصاراً بـ "BERC"؟', options: { 'BERC بدعم من Erasmus+': 'BERC بدعم من Erasmus+', 'برنامج مد الأولويات': 'برنامج مد الأولويات', 'وثائق تبادل البحوث': 'وثائق تبادل البحوث', 'مشروع التواصل الثقافي': 'مشروع التواصل الثقافي' }, correctAnswer: 'BERC بدعم من Erasmus+', points: 1 }, { id: 'ex_mc_q4', image: 'all_q.webp', question: 'أي من التالي صحيح حول اتفاقيات الجامعة؟', options: { 'الاتفاقيات تشمل تبادل طلاب وأكاديميين ضمن برامج دولية': 'الاتفاقيات تشمل تبادل طلاب وأكاديميين ضمن برامج دولية', 'Erasmus+ يشمل فقط البحث': 'Erasmus+ يشمل فقط البحث', 'لا يوجد تبادل طلبة مع أوروبا': 'لا يوجد تبادل طلبة مع أوروبا', 'الاتفاقيات محلية فقط': 'الاتفاقيات محلية فقط' }, correctAnswer: 'الاتفاقيات تشمل تبادل طلاب وأكاديميين ضمن برامج دولية', points: 1 }, { id: 'ex_mc_q5', image: 'all_q.webp', question: 'أي من البرامج التالية نُظمت عنه ورشة تقديمية بحضور أكثر من 350 مشاركاً وأطراف من وزارة التعليم العالي؟', options: { 'Erasmus+': 'Erasmus+', 'Horizon Europe': 'Horizon Europe', 'TEMPUS': 'TEMPUS', 'برنامج النفاذ المفتوح': 'برنامج النفاذ المفتوح' }, correctAnswer: 'Erasmus+', points: 1 }, { id: 'ex_mc_q6', image: 'all_q.webp', question: 'مع أي جامعة أبرمت الجامعة الإسلامية اتفاقاً ضمن مشروع Erasmus+ بعنوان ROMOR؟', options: { 'جامعة جلاسكو (University of Glasgow)': 'جامعة جلاسكو (University of Glasgow)', 'جامعة برشلونة': 'جامعة برشلونة', 'جامعة ساساري': 'جامعة ساساري', 'جامعة Algarve': 'جامعة Algarve' }, correctAnswer: 'جامعة جلاسكو (University of Glasgow)', points: 1 }, { id: 'ex_mc_q7', image: 'all_q.webp', question: 'أي من الجامعات التالية لم يتم ذكرها ضمن اتفاقيات التبادل الأكاديمي؟', options: { 'جامعة هارفارد – أمريكا': 'جامعة هارفارد – أمريكا', 'جامعة Siegen – ألمانيا': 'جامعة Siegen – ألمانيا', 'جامعة Barcelona – إسبانيا': 'جامعة Barcelona – إسبانيا', 'جامعة Algarve – البرتغال': 'جامعة Algarve – البرتغال' }, correctAnswer: 'جامعة هارفارد – أمريكا', points: 1 }, { id: 'ex_mc_q8', image: 'all_q.webp', question: 'أيٌّ مما يلي ليس من اختصاص العلاقات الخارجية بحسب الموقع؟', options: { 'قبول طلبات القبول الجامعي المحلي': 'قبول طلبات القبول الجامعي المحلي', 'برامج التعاون الأكاديمي': 'برامج التعاون الأكاديمي', 'التبادل الأكاديمي': 'التبادل الأكاديمي', 'بوابة الباحثين عن منح': 'بوابة الباحثين عن منح' }, correctAnswer: 'قبول طلبات القبول الجامعي المحلي', points: 1 } ],
                'grants-info': { isInfoScreen: true, nextScene: 'grants' },
                'grants': [ { id: 'grants_q1', image: 'all_q.webp', question: 'أنهت مريم فصلها الدراسي الأول في كلية الهندسة بتفوق، وحصلت على معدل فصلي 96% بعد أن درست 16 ساعة معتمدة. ما هي نسبة "منحة الامتياز" التي تستحقها تلقائياً في الفصل التالي؟', options: { '35': '35%', '50': '50%', '70': '70%', '100': '100%' }, correctAnswer: '70', points: 1, correctFeedback: 'إجابة دقيقة! الجامعة تكافئ المتميزين فصلياً. تفوقك هو مفتاح دعمك.', incorrectFeedback: 'الإجابة الصحيحة هي 70%. تمنح هذه النسبة لمن يحصل على معدل فصلي بين 95% و 100%.' }, { id: 'grants_q2', image: 'all_q.webp', question: 'ننتقل الآن إلى "منحة الأسرة". ما هي نسبة المنحة التي يحصل عليها كل فرد من أسرة لديها "شقيقان فقط" يدرسان في الجامعة؟', options: { '15': '15%', '25': '25%', '30': '30%', '50': '50%' }, correctAnswer: '15', points: 1, correctFeedback: 'صحيح! نسبة المنحة لشقيقين هي 15% لكل منهما. لنرَ الحالة التالية.' }, { id: 'grants_q3', image: 'all_q.webp', question: 'وماذا عن أسرة لديها "3 أشقاء" يدرسون معاً في الجامعة؟', options: { '15': '15%', '25': '25%', '30': '30%', '35': '35%' }, correctAnswer: '25', points: 1, correctFeedback: 'ممتاز! النسبة ترتفع إلى 25% لكل طالب عند وجود 3 أشقاء.' }, { id: 'grants_q4', image: 'all_q.webp', question: 'أخيراً، في "منحة الأسرة"، ما هي نسبة المنحة لأسرة لديها "4 أشقاء أو أكثر"؟', options: { '25': '25%', '30': '30%', '35': '35%', '40': '40%' }, correctAnswer: '30', points: 1, correctFeedback: 'إجابة صحيحة! 30% هي النسبة الأعلى لمنحة الأسرة. الآن سؤال عن الشروط!' }, { id: 'grants_q5', image: 'all_q.webp', question: 'سؤال للمحترفين: إذا كان معدل أحد الأشقاء في كلية الطب 72%، هل يستمر في الاستفادة منحة الأسرة؟', options: { 'yes_continue': 'نعم، ستستمر', 'no_stop': 'لا، ستتوقف' }, correctAnswer: 'no_stop', points: 1, correctFeedback: 'ملاحظة مهمة! شرط المعدل أساسي، حيث يجب أن يحافظ طالب الطب على معدل 75% فأكثر. فهمك للشروط يستحق مكافأة.', incorrectFeedback: 'الإجابة الصحيحة هي "لا". معظم المنح تتوقف إذا لم يتم الحفاظ على المعدل المطلوب.' }, { id: 'grants_q6', image: 'all_q.webp', question: 'الجامعة تقدر المواهب الخاصة. ما هي نسبة المنحة التي يحصل عليها الطالب الذي يحفظ القرآن الكريم كاملاً بعد اجتياز امتحان التسميع؟', options: { '35': '35%', '50': '50%', '70': '70%', '100': '100%' }, correctAnswer: '50', points: 1, correctFeedback: 'أحسنت! منحة حفظة القرآن الكريم هي 50%، وهي من المنح القيمة التي تقدمها الجامعة.' }, { id: 'grants_q7', image: 'all_q.webp', question: 'ما هي نسبة المنحة المخصصة للطالب من ذوي الاحتياجات الخاصة الذي لديه إعاقة بنسبة 70% فما فوق (حسب تقرير طبيب الجامعة)؟', options: { '35': '35%', '50': '50%', '70': '70%', '85': '85%' }, correctAnswer: '70', points: 1, correctFeedback: 'صحيح! الجامعة تقدم دعماً كبيراً بنسبة 70% لهذه الفئة من الطلبة.' }, { id: 'grants_q8', image: 'all_q.webp', question: 'لتشجيع الالتحاق ببعض التخصصات، تقدم الجامعة منحاً خاصة. أي من التخصصات التالية يحصل طلبتها على منحة خاصة قد تصل إلى 70%؟', options: { 'physics_chemistry': 'الفيزياء والكيمياء', 'sharia_usul': 'الشريعة وأصول الدين', 'both': 'كلاهما معاً' }, correctAnswer: 'both', points: 1, correctFeedback: 'رائع! بالفعل، كليات الشريعة وأصول الدين وبعض تخصصات العلوم مثل الفيزياء والكيمياء تحظى بدعم خاص.' }, { id: 'grants_q9', image: 'all_q.webp', question: 'سؤال مصيري: حصل سعيد على منحة تتطلب منه الحفاظ على معدل فصلي 80%. في الفصل الماضي، كان معدله 79%. هل ستستمر منحته في الفصل القادم؟', options: { 'yes_continue': 'نعم، ستستمر', 'no_stop': 'لا، ستتوقف' }, correctAnswer: 'no_stop', points: 1, correctFeedback: 'إجابة دقيقة! الحفاظ على المعدل هو شرط أساسي لاستمرار معظم المنح. فهمك لهذه النقطة يجعلك طالباً واعياً.', incorrectFeedback: 'الإجابة الصحيحة هي "لا". معظم المنح تتوقف إذا لم يتم الحفاظ على المعدل المطلوب.' } ],
                'admission-info': { isInfoScreen: true, nextScene: 'admission' },
                'admission': { image: 'all_q.webp', question: 'اختر نوع التحدي الذي تود خوضه هنا:', options: { 'admission_tf_questions': '<span class="icon">✔️❌</span> أسئلة صح وخطأ', 'admission_mc_questions': '<span class="icon">❓</span> أسئلة اختيار من متعدد' }, correctAnswer: null, points: 0, nextScene: { 'admission_tf_questions': 'admission_tf_questions', 'admission_mc_questions': 'admission_mc_questions' } },
                'admission_tf_questions': [ { id: 'ad_tf_q1', image: 'all_q.webp', question: 'معدل القبول في كلية الطب البشري هو 96%.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'incorrect', points: 1, correctFeedback: 'خطأ! معدل القبول في الطب البشري هو 97%.' }, { id: 'ad_tf_q2', image: 'all_q.webp', question: 'تخصص "هندسة الويب" هو تخصص جديد في كلية الهندسة.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'incorrect', points: 1, correctFeedback: 'خطأ! تخصص "حوسبة الويب" هو الجديد في كلية تكنولوجيا المعلومات.' }, { id: 'ad_tf_q3', image: 'all_q.webp', question: 'يمكن لطلبة الفرع الأدبي الالتحاق بكلية التمريض بمعدل 80%.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 }, { id: 'ad_tf_q4', image: 'all_q.webp', question: 'معدل القبول في تخصص "الإذاعة والتلفزيون" هو 75%.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'incorrect', points: 1, correctFeedback: 'خطأ! معدل القبول في هذا التخصص هو 65%.' }, { id: 'ad_tf_q5', image: 'all_q.webp', question: 'كلية العلوم الصحية لا تقبل طلبة من الفرع الأدبي.', options: { 'correct': 'صح', 'incorrect': 'خطأ' }, correctAnswer: 'correct', points: 1 } ],
                'admission_mc_questions': [ { id: 'ad_mc_q1', image: 'all_q.webp', question: 'ما هو معدل القبول المطلوب للالتحاق بتخصص "الذكاء الاصطناعي"؟', options: { '80': '80%', '65': '65%', '70': '70%', '75': '75%' }, correctAnswer: '80', points: 1 }, { id: 'ad_mc_q2', image: 'all_q.webp', question: 'أي من التخصصات التالية يعتبر "جديد" حسب مفتاح التنسيق؟', options: { 'الذكاء الاصطناعي': 'الذكاء الاصطناعي', 'التحاليل الطبية': 'التحاليل الطبية', 'التمريض': 'التمريض', 'التصميم الداخلي': 'التصميم الداخلي' }, correctAnswer: 'الذكاء الاصطناعي', points: 1 }, { id: 'ad_mc_q3', image: 'all_q.webp', question: 'كم يبلغ معدل القبول في كلية الشريعة والقانون (فرع الشريعة)؟', options: { '65': '65%', '70': '70%', '75': '75%', '80': '80%' }, correctAnswer: '75', points: 1 }, { id: 'ad_mc_q4', image: 'all_q.webp', question: 'أي كلية تتطلب أعلى معدل قبول للفرع العلمي؟', options: { 'الهندسة': 'الهندسة', 'الطب': 'الطب', 'تكنولوجيا المعلومات': 'تكنولوجيا المعلومات', 'العلوم': 'العلوم' }, correctAnswer: 'الطب', points: 1 }, { id: 'ad_mc_q5', image: 'all_q.webp', question: 'ما هو أدنى معدل قبول يمكن للطالب الحاصل على شهادة الثانوية العامة (الفرع العلمي) الالتحاق به في الجامعة؟', options: { '65': '65%', '70': '70%', '75': '75%', '60': '60%' }, correctAnswer: '65', points: 1 } ],
                'cafeteria': { isUnderConstruction: true },
                'hospital': { isUnderConstruction: true },
                'studentaffairs': { isUnderConstruction: true },
                'conference': { isUnderConstruction: true },
                'stadium': { isUnderConstruction: true }
            };

            const admissionInfoData = [
                { faculty: "الطب", specializations: [ { name: "الطب البشري", score: "97% علمي / 96% طلاب" } ] },
                { faculty: "الهندسة", specializations: [ { name: "الهندسة المدنية، الهندسة المعمارية (تصميم داخلي، تكنولوجيا مباني، تخطيط عمراني)، الذكاء الاصطناعي، هندسة الحاسوب، الهندسة الصناعية، الهندسة الكهربائية، الهندسة البيئية، الهندسة الميكانيكية، هندسة النظم الذكية", score: "80% علمي" } ] },
                { faculty: "تكنولوجيا المعلومات", specializations: [ { name: "علم الحاسوب، تطوير البرمجيات، تكنولوجيا المعلومات، حوسبة الويب (جديد)", score: "65% علمي" }, { name: "الوسائط المتعددة", score: "70% علمي / 65% أدبي" } ] },
                { faculty: "العلوم", specializations: [ { name: "الكيمياء، الرياضيات، الفيزياء، الأحياء، علوم الأرض والبيئة، الكيمياء الحيوية، علوم البحار، الإنتاج النباتي، التكنولوجيا الحيوية، رياضيات فرعي كمبيوتر", score: "65% علمي" } ] },
                { faculty: "العلوم الصحية", specializations: [ { name: "العلوم الطبية المخبرية، البصريات، العلاج الطبيعي، تقنيات التصوير الطبي (جديد)، التغذية السريرية (جديد)", score: "70% علمي" } ] },
                { faculty: "التمريض", specializations: [ { name: "التمريض", score: "70% علمي / 80% أدبي" }, { name: "القبالة", score: "70% علمي / 80% أدبي" } ] },
                { faculty: "الاقتصاد والعلوم الإدارية", specializations: [ { name: "المحاسبة (دراسة باللغة العربية)، إدارة الأعمال (دراسة باللغة العربية)", score: "65% علمي وأدبي" }, { name: "المحاسبة (دراسة باللغة الإنجليزية)، إدارة الأعمال (دراسة باللغة الإنجليزية)", score: "65% علمي وأدبي" }, { name: "إدارة الأعمال فرعي الريادة والإبتكار (جديد)، التسويق والتجارة الالكترونية، العلوم السياسية والإعلام، الاقتصاد والعلوم السياسية، الاقتصاد فرعي الإحصاء التطبيقي، العلوم المالية والمصرفية، المحاسبة فرعي تكنولوجيا المعلومات، الاقتصاد الرقمي وتكنولوجيا المال", score: "65% علمي وأدبي" } ] },
                { faculty: "الشريعة والقانون", specializations: [ { name: "الشريعة الإسلامية", score: "65% علمي وأدبي" }, { name: "الشريعة الإسلامية فرعي فتوى وتحكيم", score: "75% علمي وأدبي" }, { name: "الشريعة والقانون", score: "75% علمي وأدبي" } ] },
                { faculty: "أصول الدين", specializations: [ { name: "أصول الدين (عام)، الدعوة والإعلام", score: "65% علمي وأدبي" } ] },
                { faculty: "الآداب", specializations: [ { name: "اللغة العربية، اللغة العربية فرعي الصحافة، اللغة العربية فرعي التدقيق اللغوي، اللغة الإنجليزية، لغة إنجليزية فرعي ترجمة، لغة إنجليزية فرعي صحافة وإعلام (جديد)، الجغرافيا، الجغرافيا فرعي نظم المعلومات الجغرافية، الصحافة والإعلام، الإعلام الرقمي، الخدمة الاجتماعية، التاريخ والآثار، التاريخ فرعي دراسات إسرائيلية، صحافة وإعلام فرعي تكنولوجيا الإذاعة والتلفزيون", score: "65% علمي وأدبي" } ] },
                { faculty: "التربية", specializations: [ { name: "تعليم اللغة العربية، تعليم اللغة الإنجليزية، تعليم العلوم، تعليم الرياضيات، تعليم اجتماعيات، تعليم التربية الإسلامية، المرحلة الأساسية، الإرشاد النفسي والتوجيه التربوي، الكيمياء وأساليب تدريسها، الفيزياء وأساليب تدريسها، الأحياء وأساليب تدريسها، الحاسوب وأساليب تدريسه، اللغة العربية وأساليب تدريسها، اللغة الإنجليزية وأساليب تدريسها، التاريخ وأساليب تدريسه، الجغرافيا وأساليب تدريسها، الرياضيات وأساليب تدريسها", score: "65% علمي وأدبي" } ] }
            ];

            const gameState = { playerName: '', playerPhone: '', tawjihiYear: '', uniquePlayerId: null, score: 0, currentScene: null, currentSubQuestionIndex: 0, answeredQuestions: new Set(), selectedGuide: null };
            
            const sceneParentMap = {
                'tf_questions': 'faculties', 'mc_questions': 'faculties', 'exchange_tf_questions': 'exchange', 'exchange_mc_questions': 'exchange', 'admission_tf_questions': 'admission', 'admission_mc_questions': 'admission'
            };
            
            const landingScreen = document.getElementById('landing-screen');
            const startScreen = document.getElementById('start-screen');
            const gameSceneContainer = document.getElementById('game-scene');
            const playerForm = document.getElementById('player-form');
            const playerNameDisplay = document.getElementById('player-name-display');
            const playerScoreDisplay = document.getElementById('player-score-display');
            const statusBar = document.getElementById('status-bar');
            const modal = document.getElementById('feedback-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalText = document.getElementById('modal-text');
            const modalCloseBtn = document.getElementById('modal-close-btn');
            const correctSound = document.getElementById('correct-sound');
            const incorrectSound = document.getElementById('incorrect-sound');
            const transitionSound = document.getElementById('transition-sound');
            const videoOverlay = document.getElementById('video-overlay');
            const welcomeVideo = document.getElementById('welcome-video');
            const skipVideoBtn = document.getElementById('skip-video-btn');
            const adModal = document.getElementById('ad-modal');
            let adShownThisSession = false; 
            let adTriggerQuestionIndex = -1; 
            let isAudioUnlocked = false;
            
            // --- START: New progressive image preloading logic ---
            const preloadedImages = new Set();

            function preloadImage(url) {
                if (!url || preloadedImages.has(url)) {
                    return; // Skip if no URL or already preloaded
                }
                const img = new Image();
                img.src = url;
                preloadedImages.add(url);
                console.log(`Preloading: ${url}`);
            }

            function getUrlsForNextScenes(sceneId, questionIndex = 0) {
                const urls = new Set();
                if (sceneId === 'map') {
                    // Preload images for all destinations on the map
                    const mapButtons = document.querySelectorAll('#map-scene .option-btn');
                    mapButtons.forEach(btn => {
                        const dest = btn.dataset.destination;
                        if (gameData[dest]) {
                            const destData = Array.isArray(gameData[dest]) ? gameData[dest][0] : gameData[dest];
                            if(destData.image) urls.add(destData.image);
                        }
                    });
                } else {
                    const sceneData = gameData[sceneId];
                    if (Array.isArray(sceneData)) {
                        const nextIndex = questionIndex + 1;
                        if (nextIndex < sceneData.length) {
                            // Preload the next question's image in the same sequence
                            if(sceneData[nextIndex].image) urls.add(sceneData[nextIndex].image);
                        }
                    }
                }
                return Array.from(urls);
            }
            
            function preloadNextImages(sceneId, questionIndex = 0) {
                const urlsToLoad = getUrlsForNextScenes(sceneId, questionIndex);
                urlsToLoad.forEach(preloadImage);
            }
            // --- END: New progressive image preloading logic ---

            async function unlockAudio() {
                if (isAudioUnlocked) return;
                const sounds = [correctSound, incorrectSound, transitionSound];
                for (const sound of sounds) {
                    try {
                        await sound.play();
                        sound.pause();
                    } catch (error) {
                        console.warn("Audio unlock failed for one sound, this is expected.", error.name);
                    }
                }
                isAudioUnlocked = true;
                console.log("Audio context unlocked.");
            }

            function playSound(soundElement) {
                if (soundElement) {
                    soundElement.currentTime = 0;
                    soundElement.play().catch(error => {
                        console.error(`Could not play sound: ${soundElement.src}`, error);
                    });
                }
            }
            
            // --- START: دالة محدثة لعرض رسائل المرشدين الجدد ---
            function showGuideMessage(sceneId) {
                const guideId = gameState.selectedGuide;
                if (!guideId || !guideMessages[sceneId] || !guideMessages[sceneId][guideId]) {
                    return;
                }

                const message = guideMessages[sceneId][guideId];
                const guideInfo = allGuides.find(g => g.id === guideId);
                
                if (!guideInfo) return;

                const modalContent = `
                    <div style="text-align: center;">
                        <div class="guide-icon" style="margin: 0 auto 10px; font-size: 48px; width: 80px; height: 80px;">${guideInfo.emoji}</div>
                        <h3 style="color: var(--primary-dark); margin: 0;">${guideInfo.name} يقول:</h3>
                        <p style="font-size: 16px; color: var(--text-light); margin-top: 10px;">"${message}"</p>
                    </div>
                `;
                
                showModal('رسالة من مرشدك', modalContent, null);
            }
            // --- END: دالة محدثة لعرض رسائل المرشدين الجدد ---

            function saveGameState() {
                try {
                    const stateToSave = { ...gameState, answeredQuestions: Array.from(gameState.answeredQuestions) };
                    localStorage.setItem('iugGameProgress', JSON.stringify(stateToSave));
                } catch (e) {
                    console.error("Failed to save game state:", e);
                }
            }

            function loadGameState() {
                try {
                    const savedStateJSON = localStorage.getItem('iugGameProgress');
                    if (savedStateJSON) {
                        const savedState = JSON.parse(savedStateJSON);
                        Object.assign(gameState, savedState);
                        gameState.answeredQuestions = new Set(savedState.answeredQuestions);
                        return true;
                    }
                    return false;
                } catch (e) {
                    console.error("Failed to load game state:", e);
                    return false;
                }
            }

            function resetGameState() {
                if (confirm("هل أنت متأكد أنك تريد بدء رحلة جديدة؟ سيتم حذف كل تقدمك الحالي.")) {
                    localStorage.removeItem('iugGameProgress');
                    location.reload();
                }
            }

            function restoreGameSession() {
                if (loadGameState() && gameState.uniquePlayerId) {
                    landingScreen.classList.add('hidden');
                    startScreen.classList.add('hidden');
                    gameSceneContainer.classList.remove('hidden');
                    statusBar.classList.remove('hidden');

                    updatePlayerStats();

                    const sceneToRender = gameState.currentScene && gameData[gameState.currentScene] ? gameState.currentScene : 'map';
                    const indexToRender = gameState.currentSubQuestionIndex || 0;

                    showModal('أهلاً بعودتك!', `مرحباً ${gameState.playerName}، يسعدنا رؤيتك مجدداً! سنكمل من حيث توقفنا.`, () => {
                        if (sceneToRender === 'admission-info') renderAdmissionInfoScene();
                        else if (sceneToRender === 'exchange-info') renderExchangeInfoScene();
                        else if (sceneToRender === 'grants-info') renderGrantsInfoScene();
                        else if (sceneToRender === 'faculties-list') renderFacultiesListScene();
                        else if (sceneToRender === 'grants' || (sceneParentMap[sceneToRender] === 'grants')) renderScene('grants', indexToRender, false);
                        else if (sceneToRender === 'faculties' || (sceneParentMap[sceneToRender] === 'faculties')) renderScene('faculties', indexToRender, false);
                        else if (sceneToRender === 'exchange' || (sceneParentMap[sceneToRender] === 'exchange')) renderScene('exchange', indexToRender, false);
                        else if (sceneToRender === 'admission' || (sceneParentMap[sceneToRender] === 'admission')) renderScene('admission', indexToRender, false);
                        else if (sceneToRender) renderScene(sceneToRender, indexToRender, false);
                        else renderScene('map', 0, false);
                    });
                    return true;
                }
                return false;
            }
            
            function startGame(event) {
                event.preventDefault();
                const nameInput = document.getElementById('name').value.trim();
                const phoneInput = document.getElementById('phone').value.trim();
                const tawjihiYearInput = document.getElementById('tawjihi-year').value.trim();
                const nameRegex = /^[\u0600-\u06FFa-zA-Z\s]+$/;
                if (nameInput.length < 5 || !nameRegex.test(nameInput)) {
                    showModal('تنبيه بخصوص الاسم', 'هذا الاسم سيتم استخدامه في الشهادة، الرجاء كتابته بشكل صحيح (5 حروف على الأقل، وبدون أرقام أو رموز).', null);
                    return;
                }
                const phoneRegex = /^05[9|6|4]\d{7}$/;
                if (!phoneRegex.test(phoneInput)) {
                    showModal('خطأ في رقم الجوال', 'الرجاء إدخال رقم جوال صحيح يبدأ بـ 059 أو 056 أو 054.', null);
                    return;
                }
                const currentYear = new Date().getFullYear();
                const tawjihiYear = parseInt(tawjihiYearInput);
                if (isNaN(tawjihiYear) || tawjihiYear < 2000 || tawjihiYear > currentYear + 1) {
                    showModal('خطأ في سنة التوجيهي', 'الرجاء إدخال سنة توجيهي منطقية (مثال: 2024).', null);
                    return;
                }
                const startButton = event.target.querySelector('.action-button');
                startButton.disabled = true;
                startButton.textContent = 'جاري التسجيل...';
                registerPlayer(nameInput, phoneInput, tawjihiYearInput)
                    .then(data => {
                        if (data.result === 'success' && data.uniqueId) {
                            gameState.playerName = nameInput;
                            gameState.playerPhone = phoneInput;
                            gameState.tawjihiYear = tawjihiYearInput;
                            gameState.uniquePlayerId = data.uniqueId;
                            saveGameState();
                            updatePlayerStats();
                            startScreen.classList.add('hidden');
                            document.getElementById('guide-selection-screen').classList.remove('hidden');
                        } else {
                            showModal('خطأ في التسجيل', 'حدث خطأ أثناء التسجيل. الرجاء المحاولة مرة أخرى.', null);
                            startButton.disabled = false;
                            startButton.textContent = 'ابدأ الرحلة!';
                        }
                    })
                    .catch(error => {
                        showModal('خطأ في الاتصال', 'فشل الاتصال بالخادم. الرجاء التحقق من اتصالك بالإنترنت.', null);
                        startButton.disabled = false;
                        startButton.textContent = 'ابدأ الرحلة!';
                    });
            }

            function showEndScene() {
                document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
                const endScene = document.getElementById('end-scene');
                const finalMessage = document.getElementById('final-message');
                finalMessage.textContent = `أحسنت يا ${gameState.playerName}! لقد أتممت رحلتك بنجاح وأظهرت معرفة ممتازة بالجامعة الإسلامية. رصيدك النهائي هو ${gameState.score} جنيهًا، ويمكنك الآن الحصول على شهادة المشاركة.`;
                endScene.classList.remove('hidden');
                if (gameState.uniquePlayerId) {
                    updatePlayerScore(gameState.uniquePlayerId, gameState.score);
                } else {
                    console.error("خطأ: لا يمكن تحديث النتيجة لعدم وجود رقم تعريفي.");
                }
            }

            function renderScene(sceneId, questionIndex = 0, pushState = true) {
                if (questionIndex === 0) {
                    setTimeout(() => showGuideMessage(sceneId), 500);
                }
                playSound(transitionSound);
                
                if (pushState) history.pushState({ scene: sceneId, index: questionIndex }, '');
                
                document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));

                if ((sceneId === 'tf_questions' || sceneId === 'mc_questions') && questionIndex === 0 && !adShownThisSession) {
                    const sceneData = gameData[sceneId];
                    if (sceneData.length > 3) {
                        const minTrigger = 1; 
                        const maxTrigger = Math.min(sceneData.length - 2, 4); 
                        adTriggerQuestionIndex = Math.floor(Math.random() * (maxTrigger - minTrigger + 1)) + minTrigger;
                    }
                }

                if (sceneId === 'map') {
                    document.getElementById('map-scene').classList.remove('hidden');
                    preloadNextImages('map'); // Preload images for all map destinations
                    return;
                }
                if (sceneId === 'faculties-list') { renderFacultiesListScene(); return; }
                if (sceneId === 'grants-info') { renderGrantsInfoScene(); return; }
                if (sceneId === 'admission-info') { renderAdmissionInfoScene(); return; }
                if (sceneId === 'exchange-info') { renderExchangeInfoScene(); return; }

                const sceneElementId = `${sceneId}-scene`;
                const sceneElement = document.getElementById(sceneElementId);
                let sceneData = gameData[sceneId];

                if (!sceneData || !sceneElement) {
                    console.error(`Scene data or element not found for: ${sceneId}`);
                    showModal("خطأ", "حدث خطأ غير متوقع، سنعيدك للخريطة.", () => renderScene('map'));
                    return;
                }

                gameState.currentScene = sceneId;
                if (Array.isArray(sceneData)) {
                    gameState.currentSubQuestionIndex = questionIndex;
                    sceneData = sceneData[questionIndex];
                } else {
                    gameState.currentSubQuestionIndex = 0;
                }
                saveGameState();

                let progressBarHTML = '';
                if (Array.isArray(gameData[sceneId])) {
                    const totalQuestions = gameData[sceneId].length;
                    const currentProgress = ((questionIndex + 1) / totalQuestions) * 100;
                    progressBarHTML = `<div class="progress-bar-container"><div class="progress-bar" style="width: ${currentProgress}%"></div></div>`;
                }
                
                let optionsHTML = '';
                let delay = 0;
                let optionKeys = Object.keys(sceneData.options);

                if (sceneData.correctAnswer !== null) optionKeys = shuffleArray(optionKeys);

                for (const key of optionKeys) {
                    optionsHTML += `<button class="option-btn" data-answer="${key}" style="animation-delay: ${delay}s">${sceneData.options[key]}</button>`;
                    delay += 0.1;
                }

                sceneElement.innerHTML = `<img src="${sceneData.image}" alt="صورة مشهد ${sceneId}" class="scene-image" loading="lazy"><div class="scene-content">${progressBarHTML}<p class="scene-title">${sceneData.question}</p><div class="options-container">${optionsHTML}</div><div class="feedback-message"></div></div>`;
                sceneElement.classList.remove('hidden');
                sceneElement.querySelector('.options-container').addEventListener('click', handleAnswer);
            }

            function renderAdmissionInfoScene() {
                document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
                const sceneElement = document.getElementById('admission-info-scene');
                sceneElement.classList.remove('hidden');
                gameState.currentScene = 'admission-info';
                saveGameState();
                const container = document.getElementById('admission-info-container');
                container.innerHTML = ''; 
                admissionInfoData.forEach(facultyData => {
                    const card = document.createElement('div');
                    card.className = 'admission-card';
                    let specializationsHTML = '<ul>';
                    facultyData.specializations.forEach(spec => {
                        const isNew = spec.name.includes('(جديد)');
                        specializationsHTML += `<li><span class="specialization">${spec.name.replace(' (جديد)', '')} ${isNew ? '<span class="score new-major">جديد</span>' : ''}</span><span class="score">${spec.score}</span></li>`;
                    });
                    specializationsHTML += '</ul>';
                    card.innerHTML = `<h3>${facultyData.faculty}</h3>${specializationsHTML}`;
                    container.appendChild(card);
                });
                document.getElementById('start-admission-quiz-btn').onclick = () => renderScene('admission');
            }

            function renderGrantsInfoScene() {
                 document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
                 document.getElementById('grants-info-scene').classList.remove('hidden');
                 gameState.currentScene = 'grants-info';
                 saveGameState();
                 document.getElementById('start-grants-quiz-btn').onclick = () => renderScene('grants');
            }
            
            function renderExchangeInfoScene() {
                 document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
                 document.getElementById('exchange-info-scene').classList.remove('hidden');
                 gameState.currentScene = 'exchange-info';
                 saveGameState();
                 document.getElementById('start-exchange-quiz-btn').onclick = () => renderScene('exchange');
            }

            function handleAnswer(event) {
                const targetButton = event.target.closest('.option-btn');
                if (!targetButton || targetButton.disabled) return;

                const sceneId = gameState.currentScene;
                let sceneData = gameData[sceneId];
                let questionId;

                if (Array.isArray(sceneData)) {
                    sceneData = sceneData[gameState.currentSubQuestionIndex];
                    questionId = sceneData.id;
                } else {
                    questionId = sceneData.id || sceneId;
                }
                
                const selectedAnswer = targetButton.dataset.answer;
                
                if (sceneData.nextScene && sceneData.nextScene[selectedAnswer]) {
                    renderScene(sceneData.nextScene[selectedAnswer]);
                    return;
                }

                const feedbackElement = document.querySelector(`#${sceneId}-scene .feedback-message`);
                const isCorrect = selectedAnswer === sceneData.correctAnswer;
                
                if (isCorrect) {
                    document.querySelectorAll(`#${sceneId}-scene .option-btn`).forEach(btn => btn.disabled = true);
                    playSound(correctSound);

                    if (!gameState.answeredQuestions.has(questionId)) {
                        gameState.score += sceneData.points;
                        gameState.answeredQuestions.add(questionId);
                        saveGameState();
                        updatePlayerStats();
                        if (gameState.uniquePlayerId) {
                            updatePlayerScore(gameState.uniquePlayerId, gameState.score);
                        }
                    }
                    
                    targetButton.classList.add('correct');
                    feedbackElement.textContent = sceneData.correctFeedback || 'إجابة صحيحة!';
                    feedbackElement.className = 'feedback-message correct show';

                    if ((sceneId === 'tf_questions' || sceneId === 'mc_questions') && !adShownThisSession) {
                        if (gameState.currentSubQuestionIndex === adTriggerQuestionIndex) {
                            setTimeout(showAdModal, 1000);
                        }
                    }

                    setTimeout(() => {
                        if (sceneId === 'gate') {
                            playWelcomeVideo();
                            preloadNextImages('map'); // Preload for the next step (map)
                        } else if (Array.isArray(gameData[sceneId])) {
                            const nextQuestionIndex = gameState.currentSubQuestionIndex + 1;
                            if (nextQuestionIndex < gameData[sceneId].length) {
                                preloadNextImages(sceneId, nextQuestionIndex); // Preload next question image
                                renderScene(sceneId, nextQuestionIndex);
                            } else {
                                const parentScene = sceneParentMap[sceneId];
                                if (parentScene) {
                                    const siblingScenes = Object.values(gameData[parentScene].nextScene);
                                    const allSiblingsCompleted = siblingScenes.every(siblingId => isStageCompleted(siblingId));
                                    if (allSiblingsCompleted) {
                                        showModal("إنجاز مذهل!", `لقد أكملت كل تحديات هذا القسم بنجاح. لنعد إلى الخريطة.`, () => renderScene('map'));
                                    } else {
                                        showModal("رائع!", `لقد أتممت هذا التحدي. يمكنك الآن تجربة النوع الآخر من الأسئلة.`, () => renderScene(parentScene));
                                    }
                                } else {
                                    showModal("إنجاز رائع!", `لقد أكملت جميع تحديات هذا القسم بنجاح. لنعد إلى الخريطة.`, () => renderScene('map'));
                                }
                            }
                        } else {
                            renderScene('map');
                        }
                    }, 2000);

                } else {
                    playSound(incorrectSound);
                    targetButton.disabled = true; 
                    targetButton.classList.add('incorrect');
                    feedbackElement.textContent = sceneData.incorrectFeedback || 'إجابة غير صحيحة. حاول مرة أخرى!';
                    feedbackElement.className = 'feedback-message incorrect show';

                    setTimeout(() => {
                        targetButton.disabled = false;
                        targetButton.classList.remove('incorrect');
                        feedbackElement.classList.remove('show');
                    }, 1500);
                }
            }

            function updatePlayerStats() {
                playerNameDisplay.textContent = gameState.playerName;
                playerScoreDisplay.innerHTML = `💰 ${gameState.score} جنيه`;
            }

            function showModal(title, text, callback) {
                modalTitle.textContent = title;
                modalText.innerHTML = text;
                modal.classList.remove('hidden');
                modalCloseBtn.onclick = () => {
                    modal.classList.add('hidden');
                    if (callback) callback();
                };
            }

            function endVideoAndProceed() {
                welcomeVideo.pause();
                welcomeVideo.currentTime = 0;
                videoOverlay.classList.add('hidden');
                renderScene('map');
            }

            function playWelcomeVideo() {
                videoOverlay.classList.remove('hidden');
                welcomeVideo.play();
                welcomeVideo.onended = endVideoAndProceed;
                skipVideoBtn.onclick = endVideoAndProceed;
            }

            function showAdModal() {
                adModal.classList.remove('hidden');
                adShownThisSession = true;
            }
            
            function isStageCompleted(stageId) {
                let stageData = gameData[stageId];
                if (!stageData) return false;
                if (stageId === 'faculties' || stageId === 'exchange' || stageId === 'admission') {
                    const subScenes = Object.values(stageData.nextScene);
                    return subScenes.every(s => isStageCompleted(s));
                }
                if (Array.isArray(stageData)) {
                    return stageData.every(q => gameState.answeredQuestions.has(q.id));
                }
                return false;
            }
            
            playerForm.addEventListener('submit', startGame);

            document.getElementById('map-scene').addEventListener('click', (e) => {
                const button = e.target.closest('.option-btn');
                if (!button) return;
                const destination = button.dataset.destination;
                const destinationData = gameData[destination];

                if (destinationData && destinationData.isInfoScreen) {
                    if (isStageCompleted(destinationData.nextScene)) {
                        showModal("مكان مألوف!", "لقد أكملت جميع تحديات هذا المكان. اختر وجهة أخرى.", null);
                        return;
                    }
                    if (destination === 'grants-info') renderGrantsInfoScene();
                    else if (destination === 'admission-info') renderAdmissionInfoScene();
                    else if (destination === 'faculties-list') renderFacultiesListScene();
                    else if (destination === 'exchange-info') renderExchangeInfoScene();
                    return;
                }
                
                if (destination === 'certificate') {
                    const libraryComplete = isStageCompleted('library');
                    const facultiesComplete = isStageCompleted('faculties');
                    const exchangeComplete = isStageCompleted('exchange');
                    const admissionComplete = isStageCompleted('admission');
                    const allKeyStagesComplete = libraryComplete && facultiesComplete && exchangeComplete && admissionComplete;
                    const scoreSufficient = gameState.score >= 50;
                    if (allKeyStagesComplete && scoreSufficient) {
                        showEndScene();
                    } else {
                        let message = "الطريق إلى الشهادة لم يكتمل بعد!<br><br>للحصول عليها، يجب عليك تحقيق شرطين:<br>";
                        message += `1. إكمال تحديات المكتبة، والكليات (كلا المسارين)، والتبادل (كلا المسارين)، والقبول والتسجيل (كلا المسارين).<br>`;
                        message += `(${libraryComplete ? '✔️' : '❌'} المكتبة) | (${facultiesComplete ? '✔️' : '❌'} الكليات) | (${exchangeComplete ? '✔️' : '❌'} التبادل) | (${admissionComplete ? '✔️' : '❌'} القبول والتسجيل)<br>`;
                        message += `2. الحصول على 50 جنيهًا على الأقل (رصيدك: ${gameState.score}). (${scoreSufficient ? '✔️' : '❌'})<br><br>استمر في رحلتك!`;
                        showModal("شروط الحصول على الشهادة", message, null);
                    }
                    return;
                }
                
                if (destinationData && destinationData.isUnderConstruction) {
                    showModal("قيد الإنشاء!", "هذا الجزء من الجامعة سيتم افتتاحه قريباً في التحديثات القادمة للعبة.", null);
                    return;
                }
                if (isStageCompleted(destination)) showModal("مكان مألوف!", "لقد أكملت جميع تحديات هذا المكان. اختر وجهة أخرى.", null);
                else if (destinationData) renderScene(destination);
                else showModal("خطأ", "لم يتم العثور على الوجهة المطلوبة.", null);
            });
            
            document.addEventListener('click', function(event) {
                if (event.target.closest('#show-register-btn')) {
                    landingScreen.classList.add('hidden');
                    startScreen.classList.remove('hidden');
                }
                if (event.target.closest('#logout-btn')) {
                    event.preventDefault();
                    resetGameState();
                }
                if (event.target.closest('#back-to-map-btn')) {
                    event.preventDefault();
                    renderScene('map');
                }
            });

            adModal.addEventListener('click', (event) => {
                if (event.target.classList.contains('close-ad-btn') || event.target.id === 'ad-modal') {
                    adModal.classList.add('hidden');
                }
            });
            
            document.getElementById('new-player-btn').addEventListener('click', resetGameState);
            document.getElementById('reset-progress-btn').addEventListener('click', (e) => {
                e.preventDefault();
                resetGameState();
            });
            
            window.addEventListener('popstate', (event) => {
                if (event.state && event.state.scene) {
                    if (event.state.scene === 'admission-info') renderAdmissionInfoScene();
                    else if (event.state.scene === 'exchange-info') renderExchangeInfoScene();
                    else if (event.state.scene === 'grants-info') renderGrantsInfoScene();
                    else if (event.state.scene === 'faculties-list') renderFacultiesListScene();
                    else renderScene(event.state.scene, event.state.index, false);
                } else {
                    if (gameState.uniquePlayerId) renderScene('map', 0, false);
                    else location.reload();
                }
            });
            
            function populateFacultiesList() {
                const container = document.getElementById('faculties-grid-container');
                let content = '';
                collegesData.forEach(college => {
                    content += `<div class="college-info-card" data-url="${college.url}" data-name="${college.name}"><h3>${college.emoji} ${college.name}</h3><p>${college.description}</p></div>`;
                });
                container.innerHTML = content;
            }

            function renderFacultiesListScene() {
                document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
                document.getElementById('faculties-list-scene').classList.remove('hidden');
                gameState.currentScene = 'faculties-list';
                saveGameState();
            }
            
            document.getElementById('faculties-grid-container').addEventListener('click', (e) => {
                const card = e.target.closest('.college-info-card');
                if (!card) return;
                const url = card.dataset.url;
                const name = card.dataset.name;
                const websiteScene = document.getElementById('college-website-scene');
                websiteScene.innerHTML = `<div class="scene-content"><div class="website-view-header"><button id="back-to-list-btn" class="action-button" style="width: auto; padding: 10px 20px;"><span class="btn-icon">➡️</span> رجوع لقائمة الكليات</button></div><div class="loader-container" id="loader-container"><div class="loader"></div><p>جاري تحميل صفحة الكلية...</p></div></div>`;
                document.getElementById('back-to-list-btn').addEventListener('click', () => {
                    websiteScene.classList.add('hidden');
                    websiteScene.innerHTML = ''; 
                    document.getElementById('faculties-list-scene').classList.remove('hidden');
                });
                document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
                websiteScene.classList.remove('hidden');
                const iframe = document.createElement('iframe');
                iframe.id = 'college-website-iframe';
                iframe.src = url;
                iframe.title = name;
                iframe.onload = () => {
                    const loaderContainer = document.getElementById('loader-container');
                    if (loaderContainer) loaderContainer.remove();
                    iframe.classList.add('loaded');
                };
                websiteScene.querySelector('.scene-content').appendChild(iframe);
            });

            document.getElementById('proceed-to-faculties-quiz-btn').addEventListener('click', () => {
                document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
                renderScene('faculties');
            });

            // --- START: منطق شاشة اختيار المرشد المحدّث ---
            function populateGuideSelection() {
                const container = document.querySelector('#guide-selection-screen .guides-container');
                container.innerHTML = ''; 
                allGuides.forEach(guide => {
                    const cardHTML = `
                        <div class="guide-card" data-guide="${guide.id}">
                            <div class="guide-icon">${guide.emoji}</div>
                            <h3>${guide.name}</h3>
                            <span>${guide.college}</span>
                            <p>${guide.description}</p>
                        </div>
                    `;
                    container.innerHTML += cardHTML;
                });
            }

            const guideSelectionScreen = document.getElementById('guide-selection-screen');
            const guidesContainer = guideSelectionScreen.querySelector('.guides-container');
            const confirmGuideBtn = document.getElementById('confirm-guide-btn');
            
            guidesContainer.addEventListener('click', (e) => {
                const selectedCard = e.target.closest('.guide-card');
                if (!selectedCard) return;
                
                guidesContainer.querySelectorAll('.guide-card').forEach(card => card.classList.remove('selected'));
                selectedCard.classList.add('selected');
                
                gameState.selectedGuide = selectedCard.dataset.guide;
                confirmGuideBtn.disabled = false;
            });

            confirmGuideBtn.addEventListener('click', () => {
                if (gameState.selectedGuide) {
                    saveGameState();
                    guideSelectionScreen.classList.add('hidden');
                    gameSceneContainer.classList.remove('hidden');
                    statusBar.classList.remove('hidden');
                    showModal(`اختيار موفق!`, `مرشدك الأكاديمي سيكون بجانبك. لنبدأ الرحلة الآن!`, () => {
                        renderScene('gate');
                    });
                }
            });
            // --- END: منطق شاشة اختيار المرشد المحدّث ---

            document.body.addEventListener('click', unlockAudio, { once: true });
            populateFacultiesList();
            populateGuideSelection(); // استدعاء الدالة الجديدة لملء شاشة المرشدين
            restoreGameSession();
        });
    </script>
</body>
</html>