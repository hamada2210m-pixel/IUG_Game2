/* --- inline scripts extracted from original index.html --- */

const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycby2RjbdyISPTbhfR8h-lE41eY0lEWEOxZevGyTMxNbpY2zTmRzWa3DEAd5Dc6O72GgtMA/exec';
    
    const form = document.getElementById('player-form');
    if(form){
        const startBtn = form.querySelector('button');
        const inputs = form.querySelectorAll('input[required]');
        form.addEventListener('input', () => {
            startBtn.disabled = !form.checkValidity();
        });
    }

    function registerPlayer(name, phone, year) {
        const formData = new FormData();
        formData.append('action', 'register');
        formData.append('name', name);
        formData.append('phone', phone);
        formData.append('year', year);
        return fetch(SCRIPT_URL, { method: 'POST', body: formData }).then(response => response.json());
    }
    
    function updatePlayerScore(uniqueId, score) {
        if (!uniqueId) {
            console.error("Attempted to update score without a uniqueId.");
            return;
        }
        const formData = new FormData();
        formData.append('action', 'updateScore');
        formData.append('uniqueId', uniqueId);
        formData.append('score', score);
        fetch(SCRIPT_URL, { method: 'POST', body: formData })
            .then(response => response.json())
            .then(data => {
                if (data.result === 'success') {
                    console.log(`Score updated to: ${score}`);
                } else {
                    console.error('Error updating score:', data.message);
                }
            })
            .catch(error => console.error('Error in update fetch:', error));
    }

    function shuffleArray(array) {
        let currentIndex = array.length, randomIndex;
        const newArray = [...array]; 
        
        while (currentIndex !== 0) {
            randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;
            [newArray[currentIndex], newArray[randomIndex]] = [
                newArray[randomIndex], newArray[currentIndex]
            ];
        }
        return newArray;
    }

    document.addEventListener('DOMContentLoaded', () => {
        const collegesData = [
            { name: 'ูููุฉ ุงูุทุจ', description: 'ุงูุทุจ ูุนูููู ูุทุจูุจู ูููุณุชูุจู', url: 'https://medicine.iugaza.edu.ps/', emoji: 'โ๏ธ' },
            { name: 'ูููุฉ ุงูููุฏุณุฉ', description: 'ููุฏุณุฉ ุงููุณุชูุจู ุจูุงูุฉ ูุฌุงูุงุช ุงูุญูุงุฉ', url: 'https://eng.iugaza.edu.ps/', emoji: '๐๏ธ' },
            { name: 'ูููุฉ ุชูููููุฌูุง ุงููุนูููุงุช', description: 'ุนุตุฑ ุงูุชูููููุฌูุง ูุงููุนูููุงุชูุฉ ูุฃูู ุงููุนูููุงุช ูุงูุจูุงูุงุช', url: 'https://fit.iugaza.edu.ps/', emoji: '๐ป' },
            { name: 'ูููุฉ ุงูุชูุฑูุถ', description: 'ุจุฐูู ูุนุทุงุกู ูุชูุงูู ููู ูุฑูุถ ููู ูู ููุงู', url: 'https://nursing.iugaza.edu.ps/', emoji: '๐ฉบ' },
            { name: 'ูููุฉ ุงูุนููู ุงูุตุญูุฉ', description: 'ุงูุนูุงุฌ ุงูุณููู ูุจุฏุฃ ูู ููุง', url: 'https://healthscience.iugaza.edu.ps/', emoji: '๐งฌ' },
            { name: 'ูููุฉ ุงูุนููู', description: 'ุนููู ุงูุทุจูุนุฉ ูุฃุณุฑุงุฑ ุงูููู', url: 'https://science.iugaza.edu.ps/', emoji: '๐ฌ' },
            { name: 'ูููุฉ ุงูุขุฏุงุจ', description: 'ุนููู ููุบุงุชู ูุฃุฏุจู ูุซูุงูุฉ ุงูุฃูู ุงููุฎุชููุฉ ูุฏููุงู ูุญุฏูุซุงู', url: 'https://arts.iugaza.edu.ps/', emoji: '๐' },
            { name: 'ูููุฉ ุงูุดุฑูุนุฉ ูุงููุงููู', description: 'ุฏุฑุงุณุฉ ููุดุฑูุนุฉ ุงูุงุณูุงููุฉ ูุงููุญุงูุงุฉ ุนูู ูุจุงุฏุฆ ุงูุดุฑูุนุฉ ุงูุณูุญุฉ', url: 'https://sharea.iugaza.edu.ps/', emoji: 'โ๏ธ' },
            { name: 'ูููุฉ ุฃุตูู ุงูุฏูู', description: 'ุงูุฏูู ุงูุฅุณูุงูู ุ ุฃุตููู ูุฃุญูุงูู', url: 'https://osool.iugaza.edu.ps/', emoji: '๐' },
            { name: 'ูููุฉ ุงูุชุฑุจูุฉ', description: 'ูุนููู .. ูุฑุจู ุฃุฌูุงู ุงููุณุชูุจู ุงููุณุชููุฑุฉ', url: 'https://education.iugaza.edu.ps/', emoji: '๐ฉโ๐ซ' },
            { name: 'ูููุฉ ุงูุงูุชุตุงุฏ ูุงูุนููู ุงูุฅุฏุงุฑูุฉ', description: 'ุจูุงุก ุงูุงูุชุตุงุฏ ูุงูุฅุฏุงุฑุฉ ุงูุณูููุฉ ูุงููุงู', url: 'https://commerce.iugaza.edu.ps/', emoji: '๐ผ' }
        ];

        const allGuides = [
            { id: 'medicine', name: 'ุฏ. ุฎุงูุฏ', gender: 'male', college: 'ูููุฉ ุงูุทุจ', emoji: 'โ๏ธ', description: 'ุงูุฏูุฉ ูุงูุชุดุฎูุต ุงูุณููู ููุง ููุชุงุญ ุงููุฌุงุญ. ุณุฃุฑุดุฏู ูู ุฑุญูุฉ ูุนุฑููุฉ ุตุญูุฉ.' },
            { id: 'engineering', name: 'ู. ุณุงุฑุฉ', gender: 'female', college: 'ูููุฉ ุงูููุฏุณุฉ', emoji: '๐๏ธ', description: 'ูู ูุดุฑูุน ุนุธูู ูุจุฏุฃ ุจุชุตููู ุฏููู. ููุจูู ูุณุชูุจูู ุฎุทูุฉ ุจุฎุทูุฉ.' },
            { id: 'it', name: 'ูุจุฑูุฌ ุจุฏุฑ', gender: 'male', college: 'ูููุฉ ุชูููููุฌูุง ุงููุนูููุงุช', emoji: '๐ป', description: 'ูู ุนุงูู ุงูุฃููุงุฏุ ูู ูุดููุฉ ููุง ุญู. ุณุฃุณุงุนุฏู ุนูู ุงูุชูููุฑ ุจููุทููุฉ ูุฅูุฌุงุฏ ุงูุญููู.' },
            { id: 'nursing', name: 'ููุฑุถุฉ ุฃูู', gender: 'female', college: 'ูููุฉ ุงูุชูุฑูุถ', emoji: '๐ฉบ', description: 'ุงูุฑุญูุฉ ูุงูุนูุงูุฉ ููุง ุฃุณุงุณ ูููุชูุง. ุณุฃููู ุจุฌุงูุจู ูุฃูููู ุงูุนุทุงุก.' },
            { id: 'health_sciences', name: 'ุฃุฎุตุงุฆู ุฑุงูู', gender: 'male', college: 'ูููุฉ ุงูุนููู ุงูุตุญูุฉ', emoji: '๐งฌ', description: 'ุตุญุฉ ุงููุฌุชูุน ุชุจุฏุฃ ูู ุงููุฎุชุจุฑ. ูุนูุง ุณููุชุดู ุฃุณุฑุงุฑ ุงูููุงูุฉ ูุงูุนูุงุฌ.' },
            { id: 'sciences', name: 'ุนุงููุฉ ููุฑ', gender: 'female', college: 'ูููุฉ ุงูุนููู', emoji: '๐ฌ', description: 'ุงูููู ูููุก ุจุงูุฃุณุฆูุฉุ ูุงูุนููู ูู ูุณููุชูุง ููุฅุฌุงุจุฉ. ุฏุนูุง ูุณุชูุดู ุจุดุบู.' },
            { id: 'arts', name: 'ุฃุฏูุจุฉ ูููู', gender: 'female', college: 'ูููุฉ ุงูุขุฏุงุจ', emoji: '๐', description: 'ุงููููุงุช ุชุจูู ุงูุญุถุงุฑุงุช. ุณุฃุฌุนู ุฑุญูุชู ูููุฆุฉ ุจุงูุฅุจุฏุงุน ูุงููุนุงูู ุงูุฌูููุฉ.' },
            { id: 'law', name: 'ูููู ููุณู', gender: 'male', college: 'ูููุฉ ุงูุดุฑูุนุฉ ูุงููุงููู', emoji: 'โ๏ธ', description: 'ุงูุนุฏู ูู ุฃุณุงุณ ุงูููู. ุณุฃุนููู ููู ุชูุงุฒู ุจูู ุงูุญููู ูุงููุงุฌุจุงุช.' },
            { id: 'religion', name: 'ุฏุงุนูุฉ ุฅููุงู', gender: 'female', college: 'ูููุฉ ุฃุตูู ุงูุฏูู', emoji: '๐', description: 'ุงูุนูู ุจุงูุฏูู ูููุฑ ุงูุฏุฑุจ. ุณุฃุฑุงููู ูู ุฑุญูุฉ ูููู ููุงุตุฏ ุดุฑูุนุชูุง ุงูุณูุญุฉ.' },
            { id: 'education', name: 'ุฃุณุชุงุฐุฉ ูุฏู', gender: 'female', college: 'ูููุฉ ุงูุชุฑุจูุฉ', emoji: '๐ฉโ๐ซ', description: 'ุจูุงุก ุงูุฃุฌูุงู ูู ุฃุณูู ุงูุฑุณุงูุงุช. ูุนูุง ุณูุชุนูู ููู ูููู ุงูุนููู ููุจูู ุงููุณุชูุจู.' },
            { id: 'economics', name: 'ุฎุจูุฑ ูุงูู', gender: 'male', college: 'ูููุฉ ุงูุงูุชุตุงุฏ', emoji: '๐ผ', description: 'ููู ุงููุงู ูุงูุงูุชุตุงุฏ ูู ููุชุงุญ ุจูุงุก ูุณุชูุจู ูุฒุฏูุฑ. ุฏุนูุง ูุฎุทุท ููุฌุงุญู.' }
        ];

        const guideMessages = {
            'gate': {
                medicine: "ูุฑุญุจุงู ุจู! ุงูุฏุฎูู ููุฌุงูุนุฉ ูุดุจู ุงูุชุดุฎูุต ุงูุฃููุ ูุฌุจ ุฃู ูููู ุฏูููุงู. ุฑูุฒ ุฌูุฏุงู.",
                engineering: "ุฃููุงู ุจู. ูุฐู ุงูุจูุงุจุฉ ูู ุฃุณุงุณ ูุดุฑูุนู ุงูุชุนูููู. ููุจุฏุฃ ุจุจูุงุก ูุชูู!",
                it: "ูุตุงุฏูุฉ ูุงุฌุญุฉ! ููุฏ ุชุฌุงูุฒุช ุฌุฏุงุฑ ุงูุญูุงูุฉ ุงูุฃูู. ุฃููุงู ุจู ูู ูุธุงู ุงูุฌุงูุนุฉ.",
                nursing: "ุชูุงูุงู ูุซู ุงุณุชูุจุงู ุงููุฑูุถุ ูุฑุญุจ ุจู ุจุญุฑุงุฑุฉ. ุฑุญูุชู ูุญู ุงูุนุทุงุก ุชุจุฏุฃ ุงูุขู.",
                health_sciences: "ุงูุนููุฉ ุงูุฃููู ูู ุณุคุงู ุงูุฏุฎูู! ุญููู ุจุนูุงูุฉ ูุชูุดู ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ.",
                sciences: "ูุฑุญุจุงู ุฃููุง ุงูุจุงุญุซ! ูู ุงูุชุดุงู ุนุธูู ูุจุฏุฃ ุจูุฑุถูุฉ. ูุง ูู ูุฑุถูุชู ููุฅุฌุงุจุฉ ุงูุตุญูุญุฉุ",
                arts: "ููู ูุตุฉ ุจุฏุงูุฉุ ููุฐู ุจุฏุงูุฉ ูุตุชู ุงูุฌุงูุนูุฉ. ุงุฌุนููุง ุจุฏุงูุฉ ูููููุฉ.",
                law: "ูุจู ุงูุฏุฎููุ ูุฌุจ ุงูุชุฃูุฏ ูู ุงุณุชููุงุก ุงูุดุฑูุท. ูู ุฃูุช ูุณุชุนุฏ ูุฅุซุจุงุช ุฌุฏุงุฑุชูุ",
                religion: "ุจุณู ุงููู ูุจุฏุฃ. ูุฐู ุงูุจูุงุจุฉ ูู ูุฏุฎูู ุฅูู ุตุฑุญ ูู ุตุฑูุญ ุงูุนูู ูุงูุฅููุงู.",
                education: "ุฃููุงู ุจู ูู ุงููุตู ุงูุฃูู ูู ุฑุญูุชู. ูู ุฅุฌุงุจุฉ ุตุญูุญุฉ ูู ุฎุทูุฉ ูุญู ุฅููุงู ุงูุขุฎุฑูู.",
                economics: "ูุฐู ุฃูู ุตููุฉ ูู! ุงุณุชุซูุฑ ุชุฑููุฒู ุฌูุฏุงู ูุชุญููู ุฃูู ุฑุจุญ ูู ุฑุตูุฏู."
            },
            'library': {
                medicine: "ุงูููุชุจุฉ ูู ูุตุฏุฑ ุงูุฃุจุญุงุซ ุงูุทุจูุฉ ุงูุญุฏูุซุฉ. ูู ูุชุงุจ ููุง ูุฏ ูููุฐ ุญูุงุฉ ูู ุงููุณุชูุจู.",
                engineering: "ููุง ุชุฌุฏ ุงููุฎุทุทุงุช ูุงููุฑุงุฌุน ูุจูุงุก ุฃู ุดูุก ุชุชุฎููู. ุงููุนุฑูุฉ ูู ุฃููู ููุงุฏ ุงูุจูุงุก.",
                it: "ุงูููุชุจุฉ ูู ูุงุนุฏุฉ ุจูุงูุงุชูุง ุงูุถุฎูุฉ. ุงุจุญุซ ุฌูุฏุงู ูุณุชุฌุฏ ุงูุฎูุงุฑุฒููุฉ ุงูุตุญูุญุฉ ูุญู ุฃู ุชุญุฏู.",
                nursing: "ููุง ูุญุชุงุฌ ูููุฑุงุฌุน ููุนุฑูุฉ ุฃูุถู ุทุฑู ุงูุฑุนุงูุฉุ ุณุชุฌุฏ ููุง ูู ูุง ุชุญุชุงุฌู ูุชุบุฐูุฉ ุนููู.",
                health_sciences: "ูุชุงุฆุฌ ุฃุจุญุงุซูุง ุชุนุชูุฏ ุนูู ุฏูุฉ ูุตุงุฏุฑูุง. ุงูููุชุจุฉ ูู ูุฎุชุจุฑู ุงููุธุฑู ุงูุฃูู.",
                sciences: "ููุง ุชุฌุฏ ุฃุจุญุงุซ ูู ุณุจูููุง. ูู ุนูู ุฃูุชุงู ุงูุนูุงููุฉ ูุชุฑู ุฃุจุนุฏ.",
                arts: "ุงููุชุจ ูู ุบุฐุงุก ุงูุฑูุญ. ุงุณุชููู ูู ูุตุต ุงูุนุธูุงุก ููุง ูุชูุชุจ ูุตุชู ุงูุฎุงุตุฉ.",
                law: "ููุง ุชุฌุฏ ูุตูุต ุงูููุงููู ูุงูุณูุงุจู ุงููุถุงุฆูุฉ. ูู ูุถูุฉ ูุงุฌุญุฉ ุชุจุฏุฃ ุจุจุญุซ ุฏููู.",
                religion: "ูุฐู ุฑูุงุถ ูู ุฑูุงุถ ุงูุฌูุฉ. ููุง ูุชุจ ุงูุชูุณูุฑ ูุงูุญุฏูุซ ุงูุชู ุชููุฑ ุงูุนูู ูุงูููุจ.",
                education: "ุงูููุชุจุฉ ูู ูุตุฏุฑ ุฅุนุฏุงุฏ ุงูุฏุฑูุณ ูููุณุชูุจู. ูููุง ูุฑุฃุช ุฃูุซุฑุ ุฒุงุฏุช ูุฏุฑุชู ุนูู ุงูุชุนููู.",
                economics: "ููุง ุชุฌุฏ ูุธุฑูุงุช ูุจุงุฑ ุงูุงูุชุตุงุฏููู. ุฏุฑุงุณุฉ ุงููุงุถู ูู ุฃูุถู ุทุฑููุฉ ููุชูุจุค ุจุงููุณุชูุจู."
            },
            'faculties-list': {
                medicine: "ุณุชุฌุฏ ูููุฉ ุงูุทุจ ููุงุ ุญูุซ ูุชุนูู ููู ูููุฐ ุงูุฃุฑูุงุญ. ุงุฎุชุฑ ุจุญููุฉ ูุดุบู.",
                engineering: "ูุฐู ููุทูุฉ ุงููููุงุชุ ููููุชู (ุงูููุฏุณุฉ) ููุง! ูู ูุจูู ูุญูู ูุนุฑูุฉ ูุฎุชููุฉ. ุงุณุชูุดู ุจุดุบู.",
                it: "ูุฐู ูู ุงูุดุจูุฉ ุงูุฑุฆูุณูุฉ ูููููุงุช. ูู ูููุฉ ุชูุซู ุฎุงุฏูุงู (Server) ูููุนุฑูุฉ. ุฅูู ุฃู ูุงุญุฏ ุณุชุชุตูุ",
                nursing: "ููุง ุชุชูุฒุน ุฃูุณุงู ุงููุณุชุดูู ุงูุชุนูููู... ุนููุงูุ ุฃูุตุฏ ูููุงุช ุงูุฌุงูุนุฉ. ูู ูููุฉ ุชูุฏู ููุนุงู ูุฑูุฏุงู ูู ุงูุฑุนุงูุฉ.",
                health_sciences: "ูู ูููุฉ ููุง ุชุฎุชุต ุจูุฌุงู ุญููู. ุงุณุชูุดููุง ูุชุฌุฏ ุงููุฌุงู ุงูุฐู ูุซูุฑ ุดุบูู.",
                sciences: "ูุฐู ุงููููุงุช ุชูุซู ูุฑูุน ุดุฌุฑุฉ ุงููุนุฑูุฉ. ุฃู ูุฑุน ุณุชุฎุชุงุฑ ูุชุชุณูููุ",
                arts: "ูู ูููุฉ ููุง ุชูุซู ูุตูุงู ูู ูุชุงุจ ุงูุฌุงูุนุฉ ุงููุจูุฑ. ุฃู ูุตู ุณุชุฎุชุงุฑ ุฃู ุชูุฑุฃุ",
                law: "ุฃูุงูู ููุฆุงุช ุชุดุฑูุนูุฉ ูุฎุชููุฉ ูููุนุฑูุฉ. ุงุฎุชุฑ ุงูููุฆุฉ ุงูุชู ุณุชูุชูู ุฅูููุง.",
                religion: "ูู ูููุฉ ููุง ูู ููุจุฑ ุนูู. ุงุฎุชุฑ ุงูููุจุฑ ุงูุฐู ุณุชููู ููู ุงูุนูู ุงูุดุฑุนู.",
                education: "ูุฐู ูู ุงููุตูู ุงูุฏุฑุงุณูุฉ ููุฌุงูุนุฉ. ุงุฎุชุฑ ุงููุตู ุงูุฐู ุณุชุชุนูู ููู ููู ุชูุนูููู.",
                economics: "ูุฐู ูู ุฃุณูุงู ุงููุนุฑูุฉ ุงููุฎุชููุฉ. ูู ูููุฉ ููุง ุฃุตูููุง ููููุชูุง. ุงุณุชุซูุฑ ูู ูุณุชูุจูู."
            },
            'studentaffairs-info': {
                medicine: "ุตุญุฉ ุงูุทุงูุจ ุงูููุณูุฉ ูุงูุงุฌุชูุงุนูุฉ ุฌุฒุก ูุง ูุชุฌุฒุฃ ูู ูุฌุงุญู. ุดุคูู ุงูุทูุจุฉ ูู 'ุงูุทุจูุจ' ุงูุฐู ูุนุงูุฌ ุฃู ูุดููุฉ ุชูุงุฌูู.",
                engineering: "ููุง ุชุญุชุงุฌ ุงููุดุงุฑูุน ุงููุจุฑู ุฅูู ุฅุฏุงุฑุฉ ูุฅุดุฑุงูุ ุชุญุชุงุฌ ุฑุญูุชู ุงูุฌุงูุนูุฉ ุฅูู ุฏุนู. ุดุคูู ุงูุทูุจุฉ ูู ุงูุฌูุฉ ุงููุดุฑูุฉ.",
                it: "ุดุคูู ุงูุทูุจุฉ ูู 'ูุธุงู ุงูุฏุนู ุงูููู' ูู. ูููุง ูุงูุช ุงููุดููุฉุ ูุฏููู ุญู ุฃู ุชูุฌูู.",
                nursing: "ููุง ุชุฌุฏ ุงูุฑุนุงูุฉ ูุงูุฏุนู. ุนูุงุฏุฉ ุดุคูู ุงูุทูุจุฉ ูู ููุจ ุงูุฌุงูุนุฉ ุงูุฐู ููุชู ุจูู ุทุงูุจ.",
                health_sciences: "ุชุญููู ุงููุดููุงุช ุงูุทูุงุจูุฉ ูุฅูุฌุงุฏ ุญููู ููุง ูู ุชุฎุตุตูู. ูุง ุชุชุฑุฏุฏ ูู ุงุณุชุดุงุฑุชูู.",
                sciences: "ูู ูุฏุฑุณูู 'ุงูุธูุงูุฑ' ุงูุทูุงุจูุฉ ููุถุนูู ุงูุญููู. ุงุณุชูุดู ุงูุฎุฏูุงุช ุงูุชู ููุฏููููุง ูู.",
                arts: "ููุง ูุชู ูุณุฌ ูุตุต ุงููุฌุงุญ ุงูุทูุงุจูุฉ ูุฏุนู ุงูููุงูุจ. ุดุคูู ุงูุทูุจุฉ ูู ููุตุฉ ุฅุจุฏุงุนู.",
                law: "ูู ูุถูููู ุญูููู ูุทุงูุจ ูููุฌูููู ููุงุฌุจุงุชู. ุชุนุฑู ุนูู 'ููุงููู' ุงูุฏุนู ุงูุทูุงุจู.",
                religion: "ุงูุฅุฑุดุงุฏ ูุงูุชูุฌูู ุงูุณููู ูู ุฃูู ููุงูููุ ุงุณุชุนู ุจูู ูุชููู ุฑุญูุชู ูุจุงุฑูุฉ.",
                education: "ูู 'ุงููุนูููู' ุงูุฐูู ูุฑุดุฏููู ุฎุงุฑุฌ ุงููุงุนุฉ ุงูุฏุฑุงุณูุฉุ ููุณุงุนุฏููู ุนูู ุชูููุฉ ููุงุฑุงุชู.",
                economics: "ูุฏูุฑูู 'ูุญูุธุฉ' ุงูููุญ ูุงููุฑูุถ ููุณุงุนุฏุชู. ุงุณุชุซูุฑ ููุชู ูู ุงูุชุนุฑู ุนูู ุฎุฏูุงุชูู ุงููุงููุฉ."
            }
        };

        const gameData = {
            'gate': { id: 'gate_q1', image: 'assets/images/hares 1.webp', question: 'ุฃููุงู ุจู ูู ุงูุฌุงูุนุฉ ุงูุฅุณูุงููุฉ! ููุฏุฎููุ ุฃุฌุจ ุนู ุงูุณุคุงู ุงูุชุงูู: ูู ุฃู ุนุงู ุชุฃุณุณุช ุงูุฌุงูุนุฉุ', options: { '1978': '1978', '1982': '1982', '1960': '1960', '1990': '1990' }, correctAnswer: '1978', points: 1, 
                hint: { default: "ุงูุชุงุฑูุฎ ูุฑูุจ ูู ููุงูุฉ ุงูุณุจุนูููุงุช." },
                correctFeedback: { default: 'ุฑุงุฆุน! ููุฏ ุญุตูุช ุนูู ููุทุฉ ูุงุญุฏุฉ. ุงูุจูุงุจุฉ ุงูุขู ููุชูุญุฉ ุฃูุงูู!' },
                incorrectFeedback: { default: 'ุฅุฌุงุจุฉ ุบูุฑ ุตุญูุญุฉ. ุญุงูู ูุฑุฉ ุฃุฎุฑู!' }
            },
            'library': [ { id: 'library_q1', image: 'assets/images/library_question.webp', question: 'ุชุถู ููุชุจุชูุง ููุฒุงู ูุนุฑููุงู ุถุฎูุงู. ูู ุนุฏุฏ ุงููุฑุงุฌุน ุงูุฅููุชุฑูููุฉ ุงูุชู ุชููุฑูุงุ', options: { '100k': 'ุฃูุซุฑ ูู 100 ุฃูู ูุฑุฌุน ุงููุชุฑููู', '150k': 'ุฃูุซุฑ ูู 150 ุฃูู ูุฑุฌุน ุงููุชุฑููู', '50k': 'ุฃูู ูู 50 ุฃูู ูุฑุฌุน ุงููุชุฑููู', '200k': 'ุฃูุซุฑ ูู 200 ุฃูู ูุฑุฌุน ุงููุชุฑููู' }, correctAnswer: '150k', points: 1, 
                hint: { it: "ููุงุนุฏ ุงูุจูุงูุงุช ูุฏููุง ูุงุณุนุฉ ุฌุฏุงูุ ููุฑ ูู ุฑูู ูุจูุฑ ูููู ููุณ ุงูุฃูุจุฑ ูู ุงูุฎูุงุฑุงุช." },
                correctFeedback: { default: 'ุฅุฌุงุจุฉ ููุชุงุฒุฉ! ูุนุฑูุชู ุฏูููุฉ. ููุฏ ุฑุจุญุช ููุทุฉ ูุงุญุฏุฉ.' },
                incorrectFeedback: { default: 'ุงููุนุฑูุฉ ููุฉุ ุญุงูู ูุฑุฉ ุฃุฎุฑู!' } 
            }, { id: 'library_q2', image: 'assets/images/library_question_2.webp', question: 'ูู ุชููุฑ ุงูููุชุจุฉ ูุงุนุงุช ูุงุฏุฆุฉ ููุฎุตุตุฉ ููุฏุฑุงุณุฉุ', options: { 'yes': 'ูุนูุ ุชููุฑ ูุงุนุงุช ูุงุฏุฆุฉ', 'no': 'ูุงุ ุงูููุชุจุฉ ูููุชุจ ููุท' }, correctAnswer: 'yes', points: 1, 
                hint: { education: "ุจูุฆุฉ ุงูุชุนูู ุงูููุงุณุจุฉ ุถุฑูุฑูุฉุ ูุงูุฌุงูุนุฉ ุชูุชู ุจุฐูู." },
                correctFeedback: { default: 'ุจุงูุชุฃููุฏ! ุฑุงุญุชู ุฃุซูุงุก ุงูุฏุฑุงุณุฉ ุชูููุง. ููุฏ ุฑุจุญุช ููุทุฉ ูุงุญุฏุฉ ุฅุถุงููุฉ.' },
                incorrectFeedback: { default: 'ุฅุฌุงุจุฉ ุบูุฑ ุตุญูุญุฉ. ุงูููุชุจุฉ ููุงู ูุซุงูู ููุฏุฑุงุณุฉ.' } 
            }, { id: 'library_q3', image: 'assets/images/library_question_3.webp', question: 'ููู ุชุณุงุนุฏู ุงูููุชุจุฉ ูู ุฃุจุญุงุซู ุงูุฌุงูุนูุฉุ', options: { 'resources': 'ุชููุฑ ูุตุงุฏุฑ ููุฑุงุฌุน ูุชููุนุฉ', 'writes_for_you': 'ุชูุชุจ ุงูุจุญุซ ุจุฏูุงู ุนูู' }, correctAnswer: 'resources', points: 1, 
                hint: { sciences: "ุงูุจุญุซ ุงูุนููู ูุนุชูุฏ ุนูู ุงูุงุณุชุดูุงุฏ ุจูุตุงุฏุฑ ููุซููุฉ." },
                correctFeedback: { default: 'ุตุญูุญ! ุงูููุชุจุฉ ูู ุดุฑููู ุงูุฃูู ูู ุงูุจุญุซ ุงูุนููู. ุฑุจุญุช ููุทุฉ ูุงุญุฏุฉ.' },
                incorrectFeedback: { default: 'ุฅุฌุงุจุฉ ุบูุฑ ุฏูููุฉ. ุงูููุชุจุฉ ุชุฏุนูู ุจุงููุตุงุฏุฑ ูุง ุจุงูููุงู ุจุงูุนูู ุนูู.' } 
            }, { id: 'library_q4', image: 'assets/images/library_question_4.webp', question: 'ูู ุชููุฑ ุงูููุชุจุฉ ููุงุฏ ุฑูููุฉ ูููู ุงููุตูู ุฅูููุง ุนู ุจุนุฏุ', options: { 'yes_ebooks': 'ูุนูุ ุชููุฑ ูุชุจุงู ุฅููุชุฑูููุฉ', 'no_digital': 'ูุงุ ูู ุงูููุงุฏ ูุฑููุฉ ููุท' }, correctAnswer: 'yes_ebooks', points: 1, 
                hint: { it: "ูุญู ูู ุนุตุฑ ุงูุชุญูู ุงูุฑูููุ ูุงูุฌุงูุนุฉ ุชูุงูุจ ุฐูู." },
                correctFeedback: { default: 'ุฃุญุณูุช! ููููู ุงููุตูู ูููุฒ ูุนุฑูู ูู ุฃู ููุงู. ููุฏ ุฑุจุญุช ุขุฎุฑ ููุทุฉ ูู ูุฐู ุงููุฑุญูุฉ.' },
                incorrectFeedback: { default: 'ุฅุฌุงุจุฉ ุบูุฑ ุตุญูุญุฉ. ุงูุนุตุฑ ุงูุฑููู ูู ููุจ ููุชุจุชูุง.' } 
            } ],
            'faculties-list': { isInfoScreen: true, nextScene: 'faculties' },
            'faculties': { id: 'faculties_menu', image: 'assets/images/first_faculties_q.webp', question: 'ุงุฎุชุฑ ููุน ุงูุชุญุฏู ุงูุฐู ุชูุฏ ุฎูุถู ููุง:', options: { 'tf_questions': '<span class="icon">โ๏ธโ</span> ุฃุณุฆูุฉ ุตุญ ูุฎุทุฃ', 'mc_questions': '<span class="icon">โ</span> ุฃุณุฆูุฉ ุงุฎุชูุงุฑ ูู ูุชุนุฏุฏ' }, correctAnswer: null, points: 0, nextScene: { 'tf_questions': 'tf_questions', 'mc_questions': 'mc_questions' } },
            'tf_questions': [ { id: 'tf_q1', image: 'assets/images/all_q.webp', question: 'ุชุฃุณุณุช ุงูุฌุงูุนุฉ ุงูุฅุณูุงููุฉ ุจุบุฒุฉ ุนุงู 1978.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint:{default: "ูุฐุง ุงูุณุคุงู ูุดุจู ุณุคุงู ุงูุจูุงุจุฉุ ูู ุชุชุฐูุฑู?"} }, { id: 'tf_q2', image: 'assets/images/all_q.webp', question: 'ุงูุฌุงูุนุฉ ูุฏููุง 11 ูููุฉ.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint:{default: "ูููุง ุจุนุฏู ุงููููุงุช ูู ุดุงุดุฉ ุงุณุชูุดุงู ุงููููุงุชุ ุงูุนุฏุฏ ูุฑุฏู."} }, { id: 'tf_q3', image: 'assets/images/all_q.webp', question: 'ูููุฉ ุงูุทุจ ุชุฃุณุณุช ุนุงู 2006.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint:{medicine: "ุชุงุฑูุฎ ุชุฃุณูุณ ูููุชู ุญุฏูุซ ูุณุจูุงู."} }, { id: 'tf_q4', image: 'assets/images/all_q.webp', question: 'ูููุฉ ุชูููููุฌูุง ุงููุนูููุงุช ุฃูุณุณุช ูุจู ูููุฉ ุงูุชุฌุงุฑุฉ.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'incorrect', points: 1, hint: {economics: "ูููุฉ ุงูุชุฌุงุฑุฉ (ุงูุงูุชุตุงุฏ) ูู ุงููููุงุช ุงููุฏููุฉ ูู ุงูุฌุงูุนุฉ."} }, { id: 'tf_q5', image: 'assets/images/all_q.webp', question: 'ุงูุฌุงูุนุฉ ุชูุฏู ุดูุงุฏุงุช ุฏูุชูุฑุงุฉ (PhD) ูู ุงูุฅุฏุงุฑุฉุ ุงูุงูุชุตุงุฏุ ุงูููุฏุณุฉุ ุงูููููุ ูุชูููููุฌูุง ุงููุนูููุงุช.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint: {default: "ุงูุฌุงูุนุฉ ุชูุฏู ุจุฑุงูุฌ ุฏุฑุงุณุงุช ุนููุง ูุชูุฏูุฉ ูู ูุนุธู ูููุงุชูุง ุงูุฑุฆูุณูุฉ."} }, { id: 'tf_q6', image: 'assets/images/all_q.webp', question: 'ุงูุฌุงูุนุฉ ุงูุฃููู ุนูู ูุณุชูู ุบุฒุฉ ูู ุญูุซ ุงูุชุฑุชูุจ ุงูุนุงููู.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint: {default: "ุงูุฌุงูุนุฉ ุชูุชุฎุฑ ุจุชุตููููุง ุงููุชูุฏู."} }, { id: 'tf_q7', image: 'assets/images/all_q.webp', question: 'ูู ูููุฉ ุงูุทุจุ ูุฌุจ ุนูู ุงูุทุงูุจ ูุดุฑ ุจุญุซ ุนููู ูู ูุฌูุฉ ูุญูููุฉ ูุฌุฒุก ูู ูุชุทูุจุงุช ุงูุชุฎุฑุฌ.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint: {medicine: "ุงูุจุญุซ ุงูุนููู ุฌุฒุก ุฃุณุงุณู ูู ุชูููู ุงูุทุจูุจ ุงููุงุฌุญ."} }, { id: 'tf_q8', image: 'assets/images/all_q.webp', question: 'ูููุฉ ุงูุทุจ ูู ุงููุฑูุฒ ุงููุญูุฏ ุงููุนุชูุฏ ูุฅุฌุฑุงุก ุงูุชุญุงูุงุช IFOM ุฏุงุฎู ุบุฒุฉ.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint: {medicine: "ูุฐุง ุงูุงูุชุญุงู ุงูุฏููู ููู ูุชูููู ุงูุนููู ุงูุทุจูุฉ ุงูุฃุณุงุณูุฉ ูุงูุณุฑูุฑูุฉ."} }, { id: 'tf_q9', image: 'assets/images/all_q.webp', question: 'ุงูุฌุงูุนุฉ ููุฑูุง ููุท ูู ูุฏููุฉ ุบุฒุฉุ ููุง ููุฌุฏ ููุง ูุฑูุน ุฃุฎุฑู.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'incorrect', points: 1, hint: {default: "ูู ุชุตู ุฎุฏูุงุช ุงูุฌุงูุนุฉ ุงูุชุนููููุฉ ุฅูู ููุงุทู ุฃุฎุฑู ูู ุงููุทุงุนุ"} }, { id: 'tf_q10', image: 'assets/images/all_q.webp', question: 'ุงูุฌุงูุนุฉ ุนุถู ูู ุงูุงุชุญุงุฏ ุงูุฏููู ููุฌุงูุนุงุช ููุฌููุนุฉ ุฌุงูุนุงุช ุงูุจุญุฑ ุงูุฃุจูุถ ุงููุชูุณุท.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint: {default: "ุงูุงูุชูุงุก ููุฐู ุงูุงุชุญุงุฏุงุช ูุนุฒุฒ ูู ููุงูุฉ ุงูุฌุงูุนุฉ ุงูุนุงูููุฉ."} } ],
            'mc_questions': [ { id: 'mc_q1', image: 'assets/images/all_q.webp', question: 'ูู ุนุฏุฏ ุงููููุงุช ูู ุงูุฌุงูุนุฉ ุงูุฅุณูุงููุฉ ุจุบุฒุฉุ', options: { '11': '11', '9': '9', '10': '10', '12': '12' }, correctAnswer: '11', points: 1, hint:{default: "ุงูุฑูู ูุฑุฏู ูุฃูุจุฑ ูู 10."} }, { id: 'mc_q2', image: 'assets/images/all_q.webp', question: 'ุฃู ูู ุงููููุงุช ุงูุชุงููุฉ ููุณุช ูู ูููุงุช ุงูุฌุงูุนุฉุ', options: { 'it': 'ุชูููููุฌูุง ุงููุนูููุงุช', 'ุงููููู': 'ุงููููู', 'ุงูุทุจ': 'ุงูุทุจ', 'ุงูููุฏุณุฉ': 'ุงูููุฏุณุฉ' }, correctAnswer: 'ุงููููู', points: 1, hint:{arts: "ูููุชู ูู 'ุงูุขุฏุงุจ'ุ ููู ุชุฎุชูู ุนู ุงููููู ุงูุฌูููุฉ."} }, { id: 'mc_q3', image: 'assets/images/all_q.webp', question: 'ูุชู ุชุฃุณุณุช ูููุฉ ุงูุทุจ ุจุงูุฌุงูุนุฉุ', options: { '2006': '2006', '1980': '1980', '1993': '1993', '2005': '2005' }, correctAnswer: '2006', points: 1, hint:{default: "ูุงู ุฐูู ูู ููุชุตู ุงูุนูุฏ ุงูุฃูู ูู ุงูุฃูููุฉ ุงูุฌุฏูุฏุฉ."} }, { id: 'mc_q4', image: 'assets/images/all_q.webp', question: 'ุฃู ูู ุงูุชุงูู ูุตู ููุงูุฉ ุงูุฌุงูุนุฉ ุนูู ูุณุชูู ุบุฒุฉุ', options: { 'ุงูุฃููู': 'ุงูุฃููู', 'ุงูุซุงูุซุฉ': 'ุงูุซุงูุซุฉ', 'ุงูุฑุงุจุนุฉ': 'ุงูุฑุงุจุนุฉ', 'ุงูุซุงููุฉ': 'ุงูุซุงููุฉ' }, correctAnswer: 'ุงูุฃููู', points: 1, hint: {default: "ุงูุฌุงูุนุฉ ุฑุงุฆุฏุฉ ูู ูุทุงุน ุบุฒุฉ."} }, { id: 'mc_q5', image: 'assets/images/all_q.webp', question: 'ูู ุฃู ูููุฉ ูุฌุจ ุนูู ุงูุทุงูุจ ุงุฌุชูุงุฒ ุงูุชุญุงูู IFOM-BSE ูIFOM-CSE ููุชุฎุฑุฌุ', options: { 'ุงูุทุจ': 'ุงูุทุจ', 'ุงูููุฏุณุฉ': 'ุงูููุฏุณุฉ', 'it': 'ุชูููููุฌูุง ุงููุนูููุงุช', 'ุงูุชุฑุจูุฉ': 'ุงูุชุฑุจูุฉ' }, correctAnswer: 'ุงูุทุจ', points: 1, hint: {medicine: "ูุฐู ุงูุชุญุงูุงุช ุฏูููุฉ ูููุงุณ ุงูููุงุกุฉ ุงูุทุจูุฉุ ููู ุถุฑูุฑูุฉ ูู ูููุชู."} }, { id: 'mc_q6', image: 'assets/images/all_q.webp', question: 'ูู ุจูู ูุฐู ุงููููุงุชุ ุฃููุง ุชุฃุณุณุช ุฃููุงูุ', options: { 'ุงูุชุฑุจูุฉ (1980)': 'ุงูุชุฑุจูุฉ (1980)', 'ุชูููููุฌูุง ุงููุนูููุงุช (2005)': 'ุชูููููุฌูุง ุงููุนูููุงุช (2005)', 'ุงูุชุฌุงุฑุฉ (1981)': 'ุงูุชุฌุงุฑุฉ (1981)', 'ุงูุทุจ (2006)': 'ุงูุทุจ (2006)' }, correctAnswer: 'ุงูุชุฑุจูุฉ (1980)', points: 1, hint: {education: "ูููุชูุง ูู ุงููููุงุช ุงููุคุณุณุฉ ููุฌุงูุนุฉ."} }, { id: 'mc_q7', image: 'assets/images/all_q.webp', question: 'ุฃู ูู ุงูุงุชุญุงุฏุงุช ุงูุชุงููุฉ ุงูุฌุงูุนุฉ ุนุถู ูููุงุ', options: { 'ุงุชุญุงุฏ ุงูุจุญุฑ ุงููุชูุณุท ูุฌุงูุนุงุช': 'ุงุชุญุงุฏ ุงูุจุญุฑ ุงููุชูุณุท ูุฌุงูุนุงุช', 'ุฑุงุจุทุฉ ุงูุฌุงูุนุงุช ุงูุฃูุฑูููุฉ': 'ุฑุงุจุทุฉ ุงูุฌุงูุนุงุช ุงูุฃูุฑูููุฉ', 'ุฑูุณูุง ุงูุฌุงูุนุงุช ุงูุฅุณูุงููุฉ': 'ุฑูุณูุง ุงูุฌุงูุนุงุช ุงูุฅุณูุงููุฉ', 'ุฑุงุจุทุฉ ุงูุฌุงูุนุงุช ุงูุตูููุฉ': 'ุฑุงุจุทุฉ ุงูุฌุงูุนุงุช ุงูุตูููุฉ' }, correctAnswer: 'ุงุชุญุงุฏ ุงูุจุญุฑ ุงููุชูุณุท ูุฌุงูุนุงุช', points: 1, hint: {default: "ูููุน ููุณุทูู ุงูุฌุบุฑุงูู ูุฏ ูุณุงุนุฏู ูู ุชุญุฏูุฏ ุงูุฅุฌุงุจุฉ."} }, { id: 'mc_q8', image: 'assets/images/all_q.webp', question: 'ูู ุนุฏุฏ ุงููุฑุงูุฒ ูุงููุนุงูุฏ ุงูุจุญุซูุฉ ุจุงูุฌุงูุนุฉุ', options: { 'ุฃูุซุฑ ูู 20': 'ุฃูุซุฑ ูู 20', 'ุฃูู ูู 10': 'ุฃูู ูู 10', 'ุญูุงูู 15': 'ุญูุงูู 15', '30 ููุท': '30 ููุท' }, correctAnswer: 'ุฃูุซุฑ ูู 20', points: 1, hint: {sciences: "ุงูุจุญุซ ุงูุนููู ุฃููููุฉุ ูุฐุง ุนุฏุฏ ุงููุฑุงูุฒ ูุจูุฑ ููุฏุนู ุชุฎุตุตุงุช ูุฎุชููุฉ."} } ],
            'exchange-info': { isInfoScreen: true, nextScene: 'exchange' },
            'exchange': { id: 'exchange_menu', image: 'assets/images/all_q.webp', question: 'ุงุฎุชุฑ ููุน ุงูุชุญุฏู ุงูุฐู ุชูุฏ ุฎูุถู ููุง:', options: { 'exchange_tf_questions': '<span class="icon">โ๏ธโ</span> ุฃุณุฆูุฉ ุตุญ ูุฎุทุฃ', 'exchange_mc_questions': '<span class="icon">โ</span> ุฃุณุฆูุฉ ุงุฎุชูุงุฑ ูู ูุชุนุฏุฏ' }, correctAnswer: null, points: 0, nextScene: { 'exchange_tf_questions': 'exchange_tf_questions', 'exchange_mc_questions': 'exchange_mc_questions' } },
            'exchange_tf_questions': [ { id: 'ex_tf_q1', image: 'assets/images/all_q.webp', question: 'ุชูุชู ุงูุนูุงูุงุช ุงูุฎุงุฑุฌูุฉ ูู ุงูุฌุงูุนุฉ ุจุชูููุฑ ููุญ ุจูุงููุฑููุณุ ูุงุฌุณุชูุฑุ ุฏูุชูุฑุงู ููุง ุจุนุฏ ุงูุฏูุชูุฑุงู ูู ุฌุงูุนุงุช ุนุงูููุฉ.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint:{default:"ูู ุชูุฏู ุงูุฌุงูุนุฉ ูุฑุจุท ุทูุงุจูุง ุจุงูุนุงููุ"} }, { id: 'ex_tf_q2', image: 'assets/images/all_q.webp', question: 'ุงูุฌุงูุนุฉ ุนุถู ูู ุดุจูุฉ ุฌุงูุนุงุช ุงูุจุญุฑ ุงูุฃุณูุฏ ูุดุฑู ุงูุจุญุฑ ุงููุชูุณุท (BSEMAN).', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint:{arts: "ุงูุงููุชุงุญ ุนูู ุซูุงูุงุช ูุญุถุงุฑุงุช ูุฎุชููุฉ ูู ูู ุฃูุฏุงููุง."} }, { id: 'ex_tf_q3', image: 'assets/images/all_q.webp', question: 'ุงูุนูุงูุงุช ุงูุฎุงุฑุฌูุฉ ุฃุจุฑูุช ูุดุงุฑูุน ุชุจุงุฏู ุฃูุงุฏููู ุถูู ุจุฑูุงูุฌ Erasmus+ ูุน ุฌุงูุนุฉ ุฌูุงุณูู ูุฌุงูุนุฉ Algarve.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint:{default: "ุจุฑูุงูุฌ ุฅูุฑุงุณููุณ ูู ุจุฑูุงูุฌ ุชุจุงุฏู ุทูุงุจู ุฃูุฑูุจู ุดููุฑ."} } ],
            'exchange_mc_questions': [ { id: 'ex_mc_q1', image: 'assets/images/all_q.webp', question: 'ุฃูุงู ูู ุงูุฎุฏูุงุช ุงูุชุงููุฉ ุชุชูููุงูุง ุฏุงุฆุฑุฉ ุงูุนูุงูุงุช ุงูุฎุงุฑุฌูุฉุ', options: { 'ุชูููุฑ ููุญ ุฏุฑุงุณูุฉ ุฏูููุฉ ูุงูุชุจุงุฏู ุงูุฃูุงุฏููู ูุงุณุชูุทุงุจ ุงูุจุงุญุซูู': 'ุชูููุฑ ููุญ ุฏุฑุงุณูุฉ ุฏูููุฉ ูุงูุชุจุงุฏู ุงูุฃูุงุฏููู ูุงุณุชูุทุงุจ ุงูุจุงุญุซูู', 'ุชุฃููู ุงูููุญ ุงูุฏุฑุงุณูุฉ ููุท': 'ุชุฃููู ุงูููุญ ุงูุฏุฑุงุณูุฉ ููุท', 'ุชูุธูู ุงูุฑุญูุงุช ุงูุณูุงุญูุฉ': 'ุชูุธูู ุงูุฑุญูุงุช ุงูุณูุงุญูุฉ', 'ุฅุตุฏุงุฑ ุงูุชุฑุงุฎูุต ุงูุญููููุฉ': 'ุฅุตุฏุงุฑ ุงูุชุฑุงุฎูุต ุงูุญููููุฉ' }, correctAnswer: 'ุชูููุฑ ููุญ ุฏุฑุงุณูุฉ ุฏูููุฉ ูุงูุชุจุงุฏู ุงูุฃูุงุฏููู ูุงุณุชูุทุงุจ ุงูุจุงุญุซูู', points: 1, hint:{default: "ุงุจุญุซ ุนู ุงูุฅุฌุงุจุฉ ุงูุฃูุซุฑ ุดูููุงู ูุชุฎุตุตุงู."} }, { id: 'ex_mc_q2', image: 'assets/images/all_q.webp', question: 'ูุง ุงูุจุฑูุงูุฌ ุงูุฃูุฑูุจู ุงูุฐู ูุชุญ ุงููุฌุงู ูุชุจุงุฏู ุฃุนุถุงุก ููุฆุฉ ุงูุชุฏุฑูุณ ูุงูุทูุจุฉุ', options: { 'Erasmus+ (Key Action 1)': 'Erasmus+ (Key Action 1)', 'Horizon 2020': 'Horizon 2020', 'Marie Skลodowska-Curie': 'Marie Skลodowska-Curie', 'Erasmus Mundus': 'Erasmus Mundus' }, correctAnswer: 'Erasmus+ (Key Action 1)', points: 1, hint:{default: "ุฅูุฑุงุณููุณ ูู ุงูุงุณู ุงูุฃูุซุฑ ุดูุฑุฉ ูู ุจุฑุงูุฌ ุงูุชุจุงุฏู ุงูุฃูุฑูุจูุฉ."} }, { id: 'ex_mc_q3', image: 'assets/images/all_q.webp', question: 'ุฃููู ููุง ููู ููุณ ูู ุงุฎุชุตุงุต ุงูุนูุงูุงุช ุงูุฎุงุฑุฌูุฉ ุจุญุณุจ ุงููููุนุ', options: { 'ูุจูู ุทูุจุงุช ุงููุจูู ุงูุฌุงูุนู ุงููุญูู': 'ูุจูู ุทูุจุงุช ุงููุจูู ุงูุฌุงูุนู ุงููุญูู', 'ุจุฑุงูุฌ ุงูุชุนุงูู ุงูุฃูุงุฏููู': 'ุจุฑุงูุฌ ุงูุชุนุงูู ุงูุฃูุงุฏููู', 'ุงูุชุจุงุฏู ุงูุฃูุงุฏููู': 'ุงูุชุจุงุฏู ุงูุฃูุงุฏููู', 'ุจูุงุจุฉ ุงูุจุงุญุซูู ุนู ููุญ': 'ุจูุงุจุฉ ุงูุจุงุญุซูู ุนู ููุญ' }, correctAnswer: 'ูุจูู ุทูุจุงุช ุงููุจูู ุงูุฌุงูุนู ุงููุญูู', points: 1, hint:{default: "ููุงู ุนูุงุฏุฉ ุฃุฎุฑู ูุฎุชุตุฉ ุจุงููุจูู ุงููุญูู."} } ],
            'grants-info': { isInfoScreen: true, nextScene: 'grants' },
            'grants': [ { id: 'grants_q1', image: 'assets/images/all_q.webp', question: 'ุฃููุช ูุฑูู ูุตููุง ุงูุฏุฑุงุณู ุงูุฃูู ูู ูููุฉ ุงูููุฏุณุฉ ุจุชูููุ ูุญุตูุช ุนูู ูุนุฏู ูุตูู 96% ุจุนุฏ ุฃู ุฏุฑุณุช 16 ุณุงุนุฉ ูุนุชูุฏุฉ. ูุง ูู ูุณุจุฉ "ููุญุฉ ุงูุงูุชูุงุฒ" ุงูุชู ุชุณุชุญููุง ุชููุงุฆูุงู ูู ุงููุตู ุงูุชุงููุ', options: { '35': '35%', '50': '50%', '70': '70%', '100': '100%' }, correctAnswer: '70', points: 1, hint:{economics:"ุงูุชููุฒ ุงูุนุงูู ููุงูุฃ ุจุฃุนูู ูุณุจุฉ ููุญุฉ ุชููู ูุชุงุญุฉ (70% ูููุนุฏู ููู 95%)."} }, { id: 'grants_q2', image: 'assets/images/all_q.webp', question: 'ูุง ูู ูุณุจุฉ "ููุญุฉ ุงูุฃุณุฑุฉ" ุงูุชู ูุญุตู ุนูููุง ูู ูุฑุฏ ูู ุฃุณุฑุฉ ูุฏููุง "ุดูููุงู ููุท" ูุฏุฑุณุงู ูู ุงูุฌุงูุนุฉุ', options: { '15': '15%', '25': '25%', '30': '30%', '50': '50%' }, correctAnswer: '15', points: 1, hint:{default:"ูู ุงููุณุจุฉ ุงูุฃูู ูู ููุญุฉ ุงูุฃุณุฑุฉ."} }, { id: 'grants_q3', image: 'assets/images/all_q.webp', question: 'ุฅุฐุง ูุงู ูุนุฏู ุฃุญุฏ ุงูุฃุดูุงุก ูู ูููุฉ ุงูุทุจ 72%ุ ูู ูุณุชูุฑ ูู ุงูุงุณุชูุงุฏุฉ ููุญุฉ ุงูุฃุณุฑุฉุ', options: { 'yes_continue': 'ูุนูุ ุณุชุณุชูุฑ', 'no_stop': 'ูุงุ ุณุชุชููู' }, correctAnswer: 'no_stop', points: 1, hint:{medicine:"ููุงุณุชูุฑุงุฑูุฉ ูู ุงูููุญุฉุ ูุฌุจ ุฃู ูููู ูุนุฏู ุทุงูุจ ุงูุทุจ 75% ููุง ููู."} }, { id: 'grants_q4', image: 'assets/images/all_q.webp', question: 'ูุง ูู ูุณุจุฉ ุงูููุญุฉ ุงูุชู ูุญุตู ุนูููุง ุงูุทุงูุจ ุงูุฐู ูุญูุธ ุงููุฑุขู ุงููุฑูู ูุงููุงู ุจุนุฏ ุงุฌุชูุงุฒ ุงูุชุญุงู ุงูุชุณููุนุ', options: { '35': '35%', '50': '50%', '70': '70%', '100': '100%' }, correctAnswer: '50', points: 1, hint:{religion:"ุงูุฌุงูุนุฉ ุชูุฏุฑ ุญูุธุฉ ูุชุงุจ ุงููู ูุชููุญูู ูุตู ุงูุฑุณูู."} } ],
            'admission-info': { isInfoScreen: true, nextScene: 'admission' },
            'admission': { id: 'admission_menu', image: 'assets/images/all_q.webp', question: 'ุงุฎุชุฑ ููุน ุงูุชุญุฏู ุงูุฐู ุชูุฏ ุฎูุถู ููุง:', options: { 'admission_tf_questions': '<span class="icon">โ๏ธโ</span> ุฃุณุฆูุฉ ุตุญ ูุฎุทุฃ', 'admission_mc_questions': '<span class="icon">โ</span> ุฃุณุฆูุฉ ุงุฎุชูุงุฑ ูู ูุชุนุฏุฏ' }, correctAnswer: null, points: 0, nextScene: { 'admission_tf_questions': 'admission_tf_questions', 'admission_mc_questions': 'admission_mc_questions' } },
            'admission_tf_questions': [ { id: 'ad_tf_q1', image: 'assets/images/all_q.webp', question: 'ูุนุฏู ุงููุจูู ูู ูููุฉ ุงูุทุจ ุงูุจุดุฑู ูู 96%.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'incorrect', points: 1, hint:{medicine: "ุงููุจูู ูู ูููุชู ูุชุทูุจ ุฃุนูู ูุนุฏู ุนูู ุงูุฅุทูุงูุ ููู ุฃุนูู ูู ูุฐุง ุงูุฑูู ุจูููู."} }, { id: 'ad_tf_q2', image: 'assets/images/all_q.webp', question: 'ูููู ูุทูุจุฉ ุงููุฑุน ุงูุฃุฏุจู ุงูุงูุชุญุงู ุจูููุฉ ุงูุชูุฑูุถ.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint:{nursing:"ูุนูุ ูููู ุจูุนุฏู ูุจูู ุฃุนูู ูู ุงููุฑุน ุงูุนููู."} }, { id: 'ad_tf_q3', image: 'assets/images/all_q.webp', question: 'ูููุฉ ุงูุนููู ุงูุตุญูุฉ ูุง ุชูุจู ุทูุจุฉ ูู ุงููุฑุน ุงูุฃุฏุจู.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint:{health_sciences:"ุชุฎุตุตุงุชูุง ุชุชุทูุจ ุฃุณุงุณุงู ุนูููุงู ูููุงู."} } ],
            'admission_mc_questions': [ { id: 'ad_mc_q1', image: 'assets/images/all_q.webp', question: 'ูุง ูู ูุนุฏู ุงููุจูู ุงููุทููุจ ููุงูุชุญุงู ุจุชุฎุตุต "ุงูุฐูุงุก ุงูุงุตุทูุงุนู"ุ', options: { '80': '80%', '65': '65%', '70': '70%', '75': '75%' }, correctAnswer: '80', points: 1, hint:{it:"ุงูุฐูุงุก ุงูุงุตุทูุงุนู ูู ุชุฎุตุต ููุฏุณูุ ููุนุฏูุงุช ุงูููุฏุณุฉ ุชุจุฏุฃ ูู ูุฐุง ุงูุฑูู."} }, { id: 'ad_mc_q2', image: 'assets/images/all_q.webp', question: 'ุฃู ูููุฉ ุชุชุทูุจ ุฃุนูู ูุนุฏู ูุจูู ูููุฑุน ุงูุนูููุ', options: { 'ุงูููุฏุณุฉ': 'ุงูููุฏุณุฉ', 'ุงูุทุจ': 'ุงูุทุจ', 'ุชูููููุฌูุง ุงููุนูููุงุช': 'ุชูููููุฌูุง ุงููุนูููุงุช', 'ุงูุนููู': 'ุงูุนููู' }, correctAnswer: 'ุงูุทุจ', points: 1, hint:{medicine:"ูููุชู ุชุชุทูุจ ุฃุนูู ูุนุฏู ูุจูู ูู ุงูุฌุงูุนุฉ."} }, { id: 'ad_mc_q3', image: 'assets/images/all_q.webp', question: 'ูุง ูู ุฃุฏูู ูุนุฏู ูุจูู ูููู ููุทุงูุจ ุงูุญุงุตู ุนูู ุดูุงุฏุฉ ุงูุซุงูููุฉ ุงูุนุงูุฉ (ุงููุฑุน ุงูุนููู) ุงูุงูุชุญุงู ุจู ูู ุงูุฌุงูุนุฉุ', options: { '65': '65%', '70': '70%', '75': '75%', '60': '60%' }, correctAnswer: '65', points: 1, hint:{default:"ูุฐุง ุงููุนุฏู ููุชุญ ูู ุฃุจูุงุจ ุงูุนุฏูุฏ ูู ุงููููุงุช ูุซู ุงูุนููู ูุชูููููุฌูุง ุงููุนูููุงุช."} } ],
            'studentaffairs-info': { isInfoScreen: true, nextScene: 'studentaffairs' },
            'studentaffairs': { id: 'studentaffairs_menu', image: 'assets/images/all_q.webp', question: 'ุฃูุช ุงูุขู ูู ูุญุทุฉ ุดุคูู ุงูุทูุจุฉุ ุงุฎุชุฑ ููุน ุงูุชุญุฏู:', options: { 'studentaffairs_tf_questions': '<span class="icon">โ๏ธโ</span> ุฃุณุฆูุฉ ุตุญ ูุฎุทุฃ', 'studentaffairs_mc_questions': '<span class="icon">โ</span> ุฃุณุฆูุฉ ุงุฎุชูุงุฑ ูู ูุชุนุฏุฏ' }, correctAnswer: null, points: 0, nextScene: { 'studentaffairs_tf_questions': 'studentaffairs_tf_questions', 'studentaffairs_mc_questions': 'studentaffairs_mc_questions' } },
            'studentaffairs_tf_questions': [
                { id: 'sa_tf_q1', image: 'assets/images/all_q.webp', question: 'ุชุฃุณุณุช ุนูุงุฏุฉ ุดุคูู ุงูุทูุจุฉ ูู ููุณ ุนุงู ุชุฃุณูุณ ุงูุฌุงูุนุฉ.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'incorrect', points: 1, hint: { default: 'ุงูุฌุงูุนุฉ ุชุฃุณุณุช ุนุงู 1978ุ ููู ุงูุนูุงุฏุฉ ุชุฃุณุณุช ุจุนุฏ ุฐูู ุจุจุถุน ุณููุงุช ููููุฉ.' }, correctFeedback: { default: 'ุฅุฌุงุจุฉ ุตุญูุญุฉ! ุชุฃุณุณุช ุงูุนูุงุฏุฉ ุนุงู 1981ู.' } },
                { id: 'sa_tf_q2', image: 'assets/images/all_q.webp', question: 'ูู ููุงู ุนูุงุฏุฉ ุดุคูู ุงูุทูุจุฉ ุงูุฅุดุฑุงู ุนูู ุงููุดุงุท ุงูุซูุงูู ูุงูุฑูุงุถู.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint: { default: 'ุงูุฃูุดุทุฉ ุงููุงูููุฌูุฉ ูู ุฌุฒุก ุฃุณุงุณู ูู ุนูู ุงูุนูุงุฏุฉ.' } },
                { id: 'sa_tf_q3', image: 'assets/images/all_q.webp', question: 'ูุณู ุงูุจุญุซ ุงูุงุฌุชูุงุนู ูู ุงููุณุคูู ุนู ุชุฑุดูุญ ุงูุทูุจุฉ ููููุญ ุงูุฎุงุฑุฌูุฉ.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint: { economics: 'ุงูุญุงูุฉ ุงููุงุฏูุฉ ููุทุงูุจ ุนุงูู ููู ูู ุชุญุฏูุฏ ุงุณุชุญูุงูู ููููุญุ ููุฐุง ุงููุณู ูุฏุฑุณ ุฐูู.' } },
                { id: 'sa_tf_q4', image: 'assets/images/all_q.webp', question: 'ุงูุนูู ุงูุชุทูุนู ูู ูุณุงู ุงุฎุชูุงุฑู ูููู ููุทุงูุจ ุงูุชุณุฌูู ููู.', options: { 'correct': 'ุตุญ', 'incorrect': 'ุฎุทุฃ' }, correctAnswer: 'correct', points: 1, hint: { education: 'ุชุดุฌุน ุงูุฌุงูุนุฉ ุนูู ุฎุฏูุฉ ุงููุฌุชูุนุ ูุงูุนูู ุงูุชุทูุนู ูู ุฃุญุฏ ุฃุดูุงู ูุฐู ุงูุฎุฏูุฉ.' } }
            ],
            'studentaffairs_mc_questions': [
                { id: 'sa_mc_q1', image: 'assets/images/all_q.webp', question: 'ูู ุฃู ุนุงู ุฃูุดุฆุช ุนูุงุฏุฉ ุดุคูู ุงูุทูุจุฉุ', options: { '1978': '1978ู', '1981': '1981ู', '1990': '1990ู', '2000': '2000ู' }, correctAnswer: '1981', points: 1, hint: { default: 'ูุงู ุฐูู ุจุนุฏ 3 ุณููุงุช ูู ุชุฃุณูุณ ุงูุฌุงูุนุฉ.' } },
                { id: 'sa_mc_q2', image: 'assets/images/all_q.webp', question: 'ุฃู ูู ุงูุฃูุณุงู ุงูุชุงููุฉ ูุง ูุชุจุน ูุนูุงุฏุฉ ุดุคูู ุงูุทูุจุฉุ', options: { 'research': 'ุงูุจุญุซ ุงูุงุฌุชูุงุนู', 'sports': 'ุงููุดุงุท ุงูุฑูุงุถู', 'guidance': 'ุงูุชูุฌูู ูุงูุฅุฑุดุงุฏ', 'admission': 'ุงููุจูู ูุงูุชุณุฌูู' }, correctAnswer: 'admission', points: 1, hint: { default: 'ุงููุจูู ูุงูุชุณุฌูู ูู ุนูุงุฏุฉ ูุณุชููุฉ ููุฎุชุตุฉ.' } },
                { id: 'sa_mc_q3', image: 'assets/images/all_q.webp', question: 'ูุง ูู ุงููุฏู ูู ูุณู ุงูุจุญุซ ุงูุงุฌุชูุงุนู ุจุดูู ุฃุณุงุณูุ', options: { 'academic': 'ูุณุงุนุฏุฉ ุงูุทูุจุฉ ุฃูุงุฏูููุงู', 'financial': 'ูุณุงุนุฏุฉ ุงูุทูุจุฉ ูุงููุงู', 'sports': 'ุชูุธูู ุงููุฑู ุงูุฑูุงุถูุฉ', 'cultural': 'ุฅูุงูุฉ ุงููุฏูุงุช ุงูุซูุงููุฉ' }, correctAnswer: 'financial', points: 1, hint: { economics: 'ูุฑูุฒ ุงููุณู ุนูู ุฏุฑุงุณุฉ ุงููุดููุงุช ุงูุงูุชุตุงุฏูุฉ ููุทูุจุฉ.' } },
                { id: 'sa_mc_q4', image: 'assets/images/all_q.webp', question: 'ูุง ูู ุฃูู ุฎุทูุฉ ูุฌุจ ุนูู ุงูุทุงูุจ ุงุชุจุงุนูุง ููุงุณุชูุงุฏุฉ ูู ุฎุฏูุงุช ุงูุจุญุซ ุงูุงุฌุชูุงุนูุ', options: { 'visit': 'ุฒูุงุฑุฉ ุงูุนูุงุฏุฉ ุดุฎุตูุงู', 'form': 'ุชุนุจุฆุฉ ุงุณุชูุงุฑุฉ ุฅููุชุฑูููุฉ', 'call': 'ุงูุงุชุตุงู ูุงุชููุงู ุจุงููุณู', 'email': 'ุฅุฑุณุงู ุจุฑูุฏ ุฅููุชุฑููู' }, correctAnswer: 'form', points: 1, hint: { it: 'ุชุจุฏุฃ ูุนุธู ุงููุนุงููุงุช ุงูุญุฏูุซุฉ ุจุฎุทูุฉ ุฑูููุฉ.' } }
            ],
            'cafeteria': { isUnderConstruction: true },
            'hospital': { isUnderConstruction: true },
            'conference': { isUnderConstruction: true },
            'stadium': { isUnderConstruction: false }
        };

        const badgesData = [
            { id: 'library-expert', name: 'ุดุงุฑุฉ ุงููุซูู', emoji: '๐', stageId: 'library' },
            { id: 'faculties-expert', name: 'ุดุงุฑุฉ ุงูุฎุจูุฑ ุงูููุฏุณู', emoji: '๐', stageId: 'faculties' },
            { id: 'speed-runner', name: 'ุดุงุฑุฉ ุงูุจุฑู', emoji: 'โก', stageId: 'any-timed-stage' },
            { id: 'grants-master', name: 'ุดุงุฑุฉ ุงูููุญ', emoji: 'โจ', stageId: 'grants' },
            { id: 'exchange-master', name: 'ุดุงุฑุฉ ุงูุฌุณุฑ', emoji: '๐', stageId: 'exchange' },
            { id: 'student-affairs-master', name: 'ุดุงุฑุฉ ุงููุงุฆุฏ', emoji: '๐ฏ', stageId: 'studentaffairs' },
            { id: 'admission-master', name: 'ุดุงุฑุฉ ุงููุจูู', emoji: '๐', stageId: 'admission' },
            { id: 'perfect-score', name: 'ุดุงุฑุฉ ุงูุนูุงูุฉ ุงููุงููุฉ', emoji: '๐ฏ', stageId: 'any-stage-perfect' }
        ];

        const admissionInfoData = [
            { faculty: "ุงูุทุจ", specializations: [ { name: "ุงูุทุจ ุงูุจุดุฑู", score: "97% ุนููู / 96% ุทูุงุจ" } ] },
            { faculty: "ุงูููุฏุณุฉ", specializations: [ { name: "ุงูููุฏุณุฉ ุงููุฏููุฉุ ุงูููุฏุณุฉ ุงููุนูุงุฑูุฉ (ุชุตููู ุฏุงุฎููุ ุชูููููุฌูุง ูุจุงููุ ุชุฎุทูุท ุนูุฑุงูู)ุ ุงูุฐูุงุก ุงูุงุตุทูุงุนูุ ููุฏุณุฉ ุงูุญุงุณูุจุ ุงูููุฏุณุฉ ุงูุตูุงุนูุฉุ ุงูููุฏุณุฉ ุงูููุฑุจุงุฆูุฉุ ุงูููุฏุณุฉ ุงูุจูุฆูุฉุ ุงูููุฏุณุฉ ุงููููุงููููุฉุ ููุฏุณุฉ ุงููุธู ุงูุฐููุฉ", score: "80% ุนููู" } ] },
            { faculty: "ุชูููููุฌูุง ุงููุนูููุงุช", specializations: [ { name: "ุนูู ุงูุญุงุณูุจุ ุชุทููุฑ ุงูุจุฑูุฌูุงุชุ ุชูููููุฌูุง ุงููุนูููุงุชุ ุญูุณุจุฉ ุงูููุจ (ุฌุฏูุฏ)", score: "65% ุนููู" }, { name: "ุงููุณุงุฆุท ุงููุชุนุฏุฏุฉ", score: "70% ุนููู / 65% ุฃุฏุจู" } ] },
            { faculty: "ุงูุนููู", specializations: [ { name: "ุงูููููุงุกุ ุงูุฑูุงุถูุงุชุ ุงูููุฒูุงุกุ ุงูุฃุญูุงุกุ ุนููู ุงูุฃุฑุถ ูุงูุจูุฆุฉุ ุงูููููุงุก ุงูุญูููุฉุ ุนููู ุงูุจุญุงุฑุ ุงูุฅูุชุงุฌ ุงููุจุงุชูุ ุงูุชูููููุฌูุง ุงูุญูููุฉุ ุฑูุงุถูุงุช ูุฑุนู ููุจููุชุฑ", score: "65% ุนููู" } ] },
            { faculty: "ุงูุนููู ุงูุตุญูุฉ", specializations: [ { name: "ุงูุนููู ุงูุทุจูุฉ ุงููุฎุจุฑูุฉุ ุงูุจุตุฑูุงุชุ ุงูุนูุงุฌ ุงูุทุจูุนูุ ุชูููุงุช ุงูุชุตููุฑ ุงูุทุจู (ุฌุฏูุฏ)ุ ุงูุชุบุฐูุฉ ุงูุณุฑูุฑูุฉ (ุฌุฏูุฏ)", score: "70% ุนููู" } ] },
            { faculty: "ุงูุชูุฑูุถ", specializations: [ { name: "ุงูุชูุฑูุถ", score: "70% ุนููู / 80% ุฃุฏุจู" }, { name: "ุงููุจุงูุฉ", score: "70% ุนููู / 80% ุฃุฏุจู" } ] },
            { faculty: "ุงูุงูุชุตุงุฏ ูุงูุนููู ุงูุฅุฏุงุฑูุฉ", specializations: [ { name: "ุงููุญุงุณุจุฉ (ุฏุฑุงุณุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ)ุ ุฅุฏุงุฑุฉ ุงูุฃุนูุงู (ุฏุฑุงุณุฉ ุจุงููุบุฉ ุงูุนุฑุจูุฉ)", score: "65% ุนููู ูุฃุฏุจู" }, { name: "ุงููุญุงุณุจุฉ (ุฏุฑุงุณุฉ ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ)ุ ุฅุฏุงุฑุฉ ุงูุฃุนูุงู (ุฏุฑุงุณุฉ ุจุงููุบุฉ ุงูุฅูุฌููุฒูุฉ)", score: "65% ุนููู ูุฃุฏุจู" }, { name: "ุฅุฏุงุฑุฉ ุงูุฃุนูุงู ูุฑุนู ุงูุฑูุงุฏุฉ ูุงูุฅุจุชูุงุฑ (ุฌุฏูุฏ)ุ ุงูุชุณููู ูุงูุชุฌุงุฑุฉ ุงูุงููุชุฑูููุฉุ ุงูุนููู ุงูุณูุงุณูุฉ ูุงูุฅุนูุงูุ ุงูุงูุชุตุงุฏ ูุงูุนููู ุงูุณูุงุณูุฉุ ุงูุงูุชุตุงุฏ ูุฑุนู ุงูุฅุญุตุงุก ุงูุชุทุจูููุ ุงูุนููู ุงููุงููุฉ ูุงููุตุฑููุฉุ ุงููุญุงุณุจุฉ ูุฑุนู ุชูููููุฌูุง ุงููุนูููุงุชุ ุงูุงูุชุตุงุฏ ุงูุฑููู ูุชูููููุฌูุง ุงููุงู", score: "65% ุนููู ูุฃุฏุจู" } ] },
            { faculty: "ุงูุดุฑูุนุฉ ูุงููุงููู", specializations: [ { name: "ุงูุดุฑูุนุฉ ุงูุฅุณูุงููุฉ", score: "65% ุนููู ูุฃุฏุจู" }, { name: "ุงูุดุฑูุนุฉ ุงูุฅุณูุงููุฉ ูุฑุนู ูุชูู ูุชุญููู", score: "75% ุนููู ูุฃุฏุจู" }, { name: "ุงูุดุฑูุนุฉ ูุงููุงููู", score: "75% ุนููู ูุฃุฏุจู" } ] },
            { faculty: "ุฃุตูู ุงูุฏูู", specializations: [ { name: "ุฃุตูู ุงูุฏูู (ุนุงู)ุ ุงูุฏุนูุฉ ูุงูุฅุนูุงู", score: "65% ุนููู ูุฃุฏุจู" } ] },
            { faculty: "ุงูุขุฏุงุจ", specializations: [ { name: "ุงููุบุฉ ุงูุนุฑุจูุฉุ ุงููุบุฉ ุงูุนุฑุจูุฉ ูุฑุนู ุงูุตุญุงูุฉุ ุงููุบุฉ ุงูุนุฑุจูุฉ ูุฑุนู ุงูุชุฏููู ุงููุบููุ ุงููุบุฉ ุงูุฅูุฌููุฒูุฉุ ูุบุฉ ุฅูุฌููุฒูุฉ ูุฑุนู ุชุฑุฌูุฉุ ูุบุฉ ุฅูุฌููุฒูุฉ ูุฑุนู ุตุญุงูุฉ ูุฅุนูุงู (ุฌุฏูุฏ)ุ ุงูุฌุบุฑุงููุงุ ุงูุฌุบุฑุงููุง ูุฑุนู ูุธู ุงููุนูููุงุช ุงูุฌุบุฑุงููุฉุ ุงูุตุญุงูุฉ ูุงูุฅุนูุงูุ ุงูุฅุนูุงู ุงูุฑูููุ ุงูุฎุฏูุฉ ุงูุงุฌุชูุงุนูุฉุ ุงูุชุงุฑูุฎ ูุงูุขุซุงุฑุ ุงูุชุงุฑูุฎ ูุฑุนู ุฏุฑุงุณุงุช ุฅุณุฑุงุฆูููุฉุ ุตุญุงูุฉ ูุฅุนูุงู ูุฑุนู ุชูููููุฌูุง ุงูุฅุฐุงุนุฉ ูุงูุชููุฒููู", score: "65% ุนููู ูุฃุฏุจู" } ] },
            { faculty: "ุงูุชุฑุจูุฉ", specializations: [ { name: "ุชุนููู ุงููุบุฉ ุงูุนุฑุจูุฉุ ุชุนููู ุงููุบุฉ ุงูุฅูุฌููุฒูุฉุ ุชุนููู ุงูุนูููุ ุชุนููู ุงูุฑูุงุถูุงุชุ ุชุนููู ุงุฌุชูุงุนูุงุชุ ุชุนููู ุงูุชุฑุจูุฉ ุงูุฅุณูุงููุฉุ ุงููุฑุญูุฉ ุงูุฃุณุงุณูุฉุ ุงูุฅุฑุดุงุฏ ุงูููุณู ูุงูุชูุฌูู ุงูุชุฑุจููุ ุงูููููุงุก ูุฃุณุงููุจ ุชุฏุฑูุณูุงุ ุงูููุฒูุงุก ูุฃุณุงููุจ ุชุฏุฑูุณูุงุ ุงูุฃุญูุงุก ูุฃุณุงููุจ ุชุฏุฑูุณูุงุ ุงูุญุงุณูุจ ูุฃุณุงููุจ ุชุฏุฑูุณูุ ุงููุบุฉ ุงูุนุฑุจูุฉ ูุฃุณุงููุจ ุชุฏุฑูุณูุงุ ุงููุบุฉ ุงูุฅูุฌููุฒูุฉ ูุฃุณุงููุจ ุชุฏุฑูุณูุงุ ุงูุชุงุฑูุฎ ูุฃุณุงููุจ ุชุฏุฑูุณูุ ุงูุฌุบุฑุงููุง ูุฃุณุงููุจ ุชุฏุฑูุณูุงุ ุงูุฑูุงุถูุงุช ูุฃุณุงููุจ ุชุฏุฑูุณูุง", score: "65% ุนููู ูุฃุฏุจู" } ] }
        ];

       const gameState = {
            playerName: '', playerPhone: '', tawjihiYear: '', uniquePlayerId: null,
            score: 0, currentScene: null, currentSubQuestionIndex: 0,
            answeredQuestions: new Set(), selectedGuide: null,
            powerUps: {},
            badges: [],
            stageScores: {}, // ุชูุช ุงูุฅุถุงูุฉ ููุง
            currentQuestionAttempts: 0
       };
        let questionTimer = null;
        const TIME_LIMIT = 25;
        let timeLeft = TIME_LIMIT;
        let startTime = 0;
        let stagePoints = 0;

       const sceneParentMap = {
           'tf_questions': 'faculties', 'mc_questions': 'faculties', 
            'exchange_tf_questions': 'exchange', 'exchange_mc_questions': 'exchange', 
           'admission_tf_questions': 'admission', 'admission_mc_questions': 'admission',
            'studentaffairs_tf_questions': 'studentaffairs', 'studentaffairs_mc_questions': 'studentaffairs'
       };
       
        const landingScreen = document.getElementById('landing-screen');
        const startScreen = document.getElementById('start-screen');
        const gameSceneContainer = document.getElementById('game-scene');
        const playerForm = document.getElementById('player-form');
        const playerNameDisplay = document.getElementById('player-name-display');
        const playerScoreDisplay = document.getElementById('player-score-display');
        const statusBar = document.getElementById('status-bar');
        const modal = document.getElementById('feedback-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalText = document.getElementById('modal-text');
        const modalCloseBtn = document.getElementById('modal-close-btn');
        const correctSound = document.getElementById('correct-sound');
        const incorrectSound = document.getElementById('incorrect-sound');
        const transitionSound = document.getElementById('transition-sound');
        const guideAppearsSound = document.getElementById('guide-appears-sound');
        const badgeSound = document.getElementById('badge-sound');
        const videoOverlay = document.getElementById('video-overlay');
        const welcomeVideo = document.getElementById('welcome-video');
        const skipVideoBtn = document.getElementById('skip-video-btn');
        const adModal = document.getElementById('ad-modal');
        let adShownThisSession = false; 
        let adTriggerQuestionIndex = -1; 
        let isAudioUnlocked = false;
        
        const preloadedImages = new Set();

        function preloadImage(url) {
            if (!url || preloadedImages.has(url)) return;
            const img = new Image();
            img.src = url;
            preloadedImages.add(url);
        }
        
        async function unlockAudio() {
            if (isAudioUnlocked) return;
            const sounds = [correctSound, incorrectSound, transitionSound, guideAppearsSound, badgeSound];
            for (const sound of sounds) {
                try {
                    await sound.play();
                    sound.pause();
                } catch (error) {
                    // console.warn("Audio unlock failed for one sound, this is expected.", error.name);
                }
            }
            isAudioUnlocked = true;
        }

        function playSound(soundElement) {
            if (isAudioUnlocked && soundElement) {
                soundElement.currentTime = 0;
                soundElement.play().catch(error => {
                    console.error(`Could not play sound: ${soundElement.src}`, error);
                });
            }
        }
        
        function showGuideModal(title, message, playSoundEffect = true) {
            const guideInfo = allGuides.find(g => g.id === gameState.selectedGuide);
            if (!guideInfo) return;
            
            if (playSoundEffect) {
                playSound(guideAppearsSound);
            }

            const verb = guideInfo.gender === 'female' ? 'ุชููู' : 'ูููู';

            const modalContent = `
                <div style="text-align: center;">
                    <div class="guide-icon" style="margin: 0 auto 10px; font-size: 48px; width: 80px; height: 80px;">${guideInfo.emoji}</div>
                    <h3 style="color: var(--primary-dark); margin: 0;">${guideInfo.name} ${verb}:</h3>
                    <p style="font-size: 16px; color: var(--text-light); margin-top: 10px;">"${message}"</p>
                </div>
            `;
            
            showModal(title, modalContent, null);
        }
        
        function saveGameState() {
            try {
                const stateToSave = { 
                    ...gameState, 
                    answeredQuestions: Array.from(gameState.answeredQuestions),
                    badges: gameState.badges
                };
                localStorage.setItem('iugGameProgress', JSON.stringify(stateToSave));
            } catch (e) {
                console.error("Failed to save game state:", e);
            }
        }

        function loadGameState() {
            try {
                const savedStateJSON = localStorage.getItem('iugGameProgress');
                if (savedStateJSON) {
                    const savedState = JSON.parse(savedStateJSON);
                    Object.assign(gameState, savedState);
                    gameState.answeredQuestions = new Set(savedState.answeredQuestions);
                    if (!gameState.powerUps) gameState.powerUps = {};
                    if (!gameState.badges) gameState.badges = [];
                    if (!gameState.stageScores) gameState.stageScores = {}; // ุชูุช ุงูุฅุถุงูุฉ ููุง
                    return true;
                }
                return false;
            } catch (e) {
                console.error("Failed to load game state:", e);
                return false;
            }
        }
        
        function addBadge(badgeId) {
            if (!gameState.badges.includes(badgeId)) {
                gameState.badges.push(badgeId);
                saveGameState();
                const badge = badgesData.find(b => b.id === badgeId);
                if (badge) {
                    showBadgePopup(badge.name, badge.emoji);
                }
            }
        }

        function showBadgePopup(name, emoji) {
            const badgeModal = document.getElementById('badge-modal');
            const badgeIcon = badgeModal.querySelector('.badge-icon');
            const badgeName = document.getElementById('badge-name');
            const badgeCloseBtn = document.getElementById('badge-close-btn');

            badgeIcon.textContent = emoji;
            badgeName.textContent = name;
            playSound(badgeSound);
            badgeModal.classList.remove('hidden');

            badgeCloseBtn.onclick = () => {
                badgeModal.classList.add('hidden');
            };
        }
        
        function performLogout() {
            localStorage.removeItem('iugGameProgress');
            location.reload();
        }

        function showLogoutConfirmation() {
            const logoutModal = document.getElementById('logout-confirm-modal');
            logoutModal.classList.remove('hidden');
        }

        function restoreGameSession() {
            if (loadGameState() && gameState.uniquePlayerId) {
                landingScreen.classList.add('hidden');
                startScreen.classList.add('hidden');
                gameSceneContainer.classList.remove('hidden');
                statusBar.classList.remove('hidden');

                updatePlayerStats();

                const sceneToRender = gameState.currentScene && gameData[gameState.currentScene] ? gameState.currentScene : 'map';
                const indexToRender = gameState.currentSubQuestionIndex || 0;

                showModal('ุฃููุงู ุจุนูุฏุชู!', `ูุฑุญุจุงู ${gameState.playerName}ุ ูุณุนุฏูุง ุฑุคูุชู ูุฌุฏุฏุงู! ุณูููู ูู ุญูุซ ุชููููุง.`, () => {
                    const sceneMappings = {
                        'admission-info': renderAdmissionInfoScene,
                        'exchange-info': renderExchangeInfoScene,
                        'grants-info': renderGrantsInfoScene,
                        'faculties-list': renderFacultiesListScene,
                        'studentaffairs-info': renderStudentAffairsInfoScene,
                        'player-profile': renderPlayerProfile
                    };

                    const parentScene = sceneParentMap[sceneToRender] || sceneToRender;

                    if (sceneMappings[parentScene]) {
                        sceneMappings[parentScene]();
                    } else if (gameData[parentScene] && gameData[parentScene].nextScene) {
                            renderScene(parentScene, indexToRender, false);
                    }
                    else if (sceneToRender) {
                        renderScene(sceneToRender, indexToRender, false);
                    } else {
                        renderScene('map', 0, false);
                    }
                });
                return true;
            }
            return false;
        }
        
        function startGame(event) {
            event.preventDefault();
            const nameInput = document.getElementById('name').value.trim();
            const phoneInput = document.getElementById('phone').value.trim();
            const tawjihiYearInput = document.getElementById('tawjihi-year').value.trim();
            const nameRegex = /^[\u0600-\u06FFa-zA-Z\s]+$/;
            if (nameInput.length < 5 || !nameRegex.test(nameInput)) {
                showModal('ุชูุจูู ุจุฎุตูุต ุงูุงุณู', 'ูุฐุง ุงูุงุณู ุณูุชู ุงุณุชุฎุฏุงูู ูู ุงูุดูุงุฏุฉุ ุงูุฑุฌุงุก ูุชุงุจุชู ุจุดูู ุตุญูุญ (5 ุญุฑูู ุนูู ุงูุฃููุ ูุจุฏูู ุฃุฑูุงู ุฃู ุฑููุฒ).', null);
                return;
            }
            const phoneRegex = /^05[9|6|4]\d{7}$/;
            if (!phoneRegex.test(phoneInput)) {
                showModal('ุฎุทุฃ ูู ุฑูู ุงูุฌูุงู', 'ุงูุฑุฌุงุก ุฅุฏุฎุงู ุฑูู ุฌูุงู ุตุญูุญ ูุจุฏุฃ ุจู 059 ุฃู 056 ุฃู 054.', null);
                return;
            }
            const currentYear = new Date().getFullYear();
            const tawjihiYear = parseInt(tawjihiYearInput);
            if (isNaN(tawjihiYear) || tawjihiYear < 2000 || tawjihiYear > currentYear + 1) {
                showModal('ุฎุทุฃ ูู ุณูุฉ ุงูุชูุฌููู', 'ุงูุฑุฌุงุก ุฅุฏุฎุงู ุณูุฉ ุชูุฌููู ููุทููุฉ (ูุซุงู: 2024).', null);
                return;
            }
            const startButton = event.target.querySelector('.action-button');
            startButton.disabled = true;
            startButton.innerHTML = 'ุฌุงุฑู ุงูุชุณุฌูู... <span class="spinner"></span>';

            registerPlayer(nameInput, phoneInput, tawjihiYearInput)
                .then(data => {
                    if (data.result === 'success' && data.uniqueId) {
                        gameState.playerName = nameInput;
                        gameState.playerPhone = phoneInput;
                        gameState.tawjihiYear = tawjihiYearInput;
                        gameState.uniquePlayerId = data.uniqueId;
                        saveGameState();
                        updatePlayerStats();
                        startScreen.classList.add('hidden');
                        document.getElementById('guide-selection-screen').classList.remove('hidden');
                    } else {
                        showModal('ุฎุทุฃ ูู ุงูุชุณุฌูู', 'ุญุฏุซ ุฎุทุฃ ุฃุซูุงุก ุงูุชุณุฌูู. ุงูุฑุฌุงุก ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.', null);
                        startButton.disabled = false;
                        startButton.innerHTML = 'ุงุจุฏุฃ ุงูุฑุญูุฉ!';
                    }
                })
                .catch(error => {
                    showModal('ุฎุทุฃ ูู ุงูุงุชุตุงู', 'ูุดู ุงูุงุชุตุงู ุจุงูุฎุงุฏู. ุงูุฑุฌุงุก ุงูุชุญูู ูู ุงุชุตุงูู ุจุงูุฅูุชุฑูุช.', null);
                    startButton.disabled = false;
                    startButton.innerHTML = 'ุงุจุฏุฃ ุงูุฑุญูุฉ!';
                });
        }

        function showEndScene() {
            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
            const endScene = document.getElementById('end-scene');
            const finalMessage = document.getElementById('final-message');
            finalMessage.textContent = `ุฃุญุณูุช ูุง ${gameState.playerName}! ููุฏ ุฃุชููุช ุฑุญูุชู ุจูุฌุงุญ ูุฃุธูุฑุช ูุนุฑูุฉ ููุชุงุฒุฉ ุจุงูุฌุงูุนุฉ ุงูุฅุณูุงููุฉ. ุฑุตูุฏู ุงูููุงุฆู ูู ${gameState.score} ููุทุฉุ ูููููู ุงูุขู ุงูุญุตูู ุนูู ุดูุงุฏุฉ ุงููุดุงุฑูุฉ.`;
            endScene.classList.remove('hidden');
            if (gameState.uniquePlayerId) {
                updatePlayerScore(gameState.uniquePlayerId, gameState.score);
            } else {
                console.error("ุฎุทุฃ: ูุง ูููู ุชุญุฏูุซ ุงููุชูุฌุฉ ูุนุฏู ูุฌูุฏ ุฑูู ุชุนุฑููู.");
            }
        }

        function clearTimer() {
            if (questionTimer) {
                clearInterval(questionTimer);
                questionTimer = null;
            }
        }

        function handleTimeUp() {
            playSound(incorrectSound);

            const sceneId = gameState.currentScene;
            const sceneElement = document.getElementById(`${sceneId}-scene`);
            if (!sceneElement) return;

            const allOptionButtons = sceneElement.querySelectorAll('.option-btn');
            allOptionButtons.forEach(btn => btn.disabled = true);
            
            const currentSceneEl = document.getElementById(`${gameState.currentScene}-scene`);
            const helpBtn = currentSceneEl.querySelector('#guide-help-btn');
            if (helpBtn) helpBtn.disabled = true;

            let sceneData = gameData[sceneId];
            if (Array.isArray(sceneData)) {
                sceneData = sceneData[gameState.currentSubQuestionIndex];
            }
            const correctAnswer = sceneData.correctAnswer;
            const correctButton = sceneElement.querySelector(`.option-btn[data-answer="${correctAnswer}"]`);
            if (correctButton) {
                correctButton.classList.add('correct');
            }

            const modalCallback = () => {
                if (Array.isArray(gameData[sceneId])) {
                    const nextQuestionIndex = gameState.currentSubQuestionIndex + 1;
                    if (nextQuestionIndex < gameData[sceneId].length) {
                        renderScene(sceneId, nextQuestionIndex);
                    } else {
                        const parentScene = sceneParentMap[sceneId];
                        if (parentScene) {
                            const siblingScenes = Object.values(gameData[parentScene].nextScene);
                            const allSiblingsCompleted = siblingScenes.every(siblingId => isStageCompleted(siblingId));
                            if (allSiblingsCompleted) {
                                showModal("ุฅูุฌุงุฒ ูุฐูู!", `ููุฏ ุฃูููุช ูู ุชุญุฏูุงุช ูุฐุง ุงููุณู ุจูุฌุงุญ. ููุนุฏ ุฅูู ุงูุฎุฑูุทุฉ.`, () => renderScene('map'));
                            } else {
                                showModal("ุงูุชูุช ุงูุฃุณุฆูุฉ", `ููุฏ ุฃุชููุช ูุฐุง ุงูุชุญุฏู. ููููู ุงูุขู ุชุฌุฑุจุฉ ุงูููุน ุงูุขุฎุฑ ูู ุงูุฃุณุฆูุฉ ุฃู ุงูุนูุฏุฉ ููุฎุฑูุทุฉ.`, () => renderScene(parentScene));
                            }
                        } else {
                            showModal("ุฅูุฌุงุฒ ุฑุงุฆุน!", `ููุฏ ุฃูููุช ุฌููุน ุชุญุฏูุงุช ูุฐุง ุงููุณู ุจูุฌุงุญ. ููุนุฏ ุฅูู ุงูุฎุฑูุทุฉ.`, () => renderScene('map'));
                        }
                    }
                } else {
                    renderScene('map');
                }
            };
            
            showModal("ุงูุชูู ุงูููุช!", "ููุฃุณูุ ููุฏ ููุฏ ุงูููุช. ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ุชู ุชุญุฏูุฏูุง. ุงุณุชุนุฏ ููุณุคุงู ุงูุชุงูู.", modalCallback);
        }

        function startTimer() {
            clearTimer();
            const currentSceneEl = document.getElementById(`${gameState.currentScene}-scene`);
            if (!currentSceneEl) return; 

            const timerContainer = currentSceneEl.querySelector('#timer-container');
            const timerDisplay = currentSceneEl.querySelector('#timer-display');
            if (!timerDisplay || !timerContainer) return;

            timeLeft = TIME_LIMIT;
            startTime = Date.now();
            timerDisplay.textContent = timeLeft;
            timerContainer.classList.remove('low-time');

            questionTimer = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = timeLeft;
                if (timeLeft <= 5 && timeLeft > 0) {
                    timerContainer.classList.add('low-time');
                }
                if (timeLeft < 0) {
                    clearTimer();
                    handleTimeUp();
                }
            }, 1000);
        }

        function renderScene(sceneId, questionIndex = 0, pushState = true) {
            clearTimer();
            gameState.currentQuestionAttempts = 0;
            if (questionIndex === 0) stagePoints = 0;

            if (questionIndex === 0 && sceneId !== 'map' && guideMessages[sceneId]) {
                const messageSceneId = sceneParentMap[sceneId] || sceneId;
                if(guideMessages[messageSceneId] && guideMessages[messageSceneId][gameState.selectedGuide]) {
                    setTimeout(() => showGuideModal('ุฑุณุงูุฉ ูู ูุฑุดุฏู', guideMessages[messageSceneId][gameState.selectedGuide]), 500);
                }
            }
            playSound(transitionSound);
            
            if (pushState) history.pushState({ scene: sceneId, index: questionIndex }, '');
            
            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));

            if ((sceneId.includes('questions')) && questionIndex === 0 && !adShownThisSession) {
                const sceneData = gameData[sceneId];
                if (sceneData.length > 3) {
                    const minTrigger = 1; 
                    const maxTrigger = Math.min(sceneData.length - 2, 4); 
                    adTriggerQuestionIndex = Math.floor(Math.random() * (maxTrigger - minTrigger + 1)) + minTrigger;
                }
            }

            const sceneMappings = {
                'map': () => document.getElementById('map-scene').classList.remove('hidden'),
                'faculties-list': renderFacultiesListScene,
                'grants-info': renderGrantsInfoScene,
                'admission-info': renderAdmissionInfoScene,
                'exchange-info': renderExchangeInfoScene,
                'studentaffairs-info': renderStudentAffairsInfoScene,
                'player-profile': renderPlayerProfile,
                'stadium': renderStadiumGame,
            };

            if (sceneMappings[sceneId]) {
                sceneMappings[sceneId]();
                return;
            }

            const sceneElementId = `${sceneId}-scene`;
            const sceneElement = document.getElementById(sceneElementId);
            let sceneData = gameData[sceneId];

            if (!sceneData || !sceneElement) {
                console.error(`Scene data or element not found for: ${sceneId}`);
                showModal("ุฎุทุฃ", "ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุนุ ุณูุนูุฏู ููุฎุฑูุทุฉ.", () => renderScene('map'));
                return;
            }

            gameState.currentScene = sceneId;
            if (Array.isArray(sceneData)) {
                gameState.currentSubQuestionIndex = questionIndex;
                sceneData = sceneData[questionIndex];
            } else {
                gameState.currentSubQuestionIndex = 0;
            }
            saveGameState();

            let progressInfoHTML = '';
            if (Array.isArray(gameData[sceneId])) {
                const totalQuestions = gameData[sceneId].length;
                const currentQuestionNumber = questionIndex + 1;
                const currentProgress = (currentQuestionNumber / totalQuestions) * 100;
                const progressBarHTML = `<div class="progress-bar-container"><div class="progress-bar" style="width: ${currentProgress}%"></div></div>`;
                const questionCounterHTML = `<div class="question-counter">ุงูุณุคุงู ${currentQuestionNumber} ูู ${totalQuestions}</div>`;
                const timerHTML = `<div id="timer-container" class="timer-container"><span id="timer-display">${TIME_LIMIT}</span></div>`;
                progressInfoHTML = `<div class="progress-info">${progressBarHTML}${timerHTML}${questionCounterHTML}</div>`;
            }
            
            let optionsHTML = '';
            let delay = 0;
            let optionKeys = Object.keys(sceneData.options);

            if (sceneData.correctAnswer !== null) optionKeys = shuffleArray(optionKeys);

            for (const key of optionKeys) {
                optionsHTML += `<button class="option-btn" data-answer="${key}" style="animation-delay: ${delay}s">${sceneData.options[key]}</button>`;
                delay += 0.1;
            }
            
            let powerUpsHTML = '';
            if (sceneData.correctAnswer !== null) {
                const stageId = sceneParentMap[sceneId] || sceneId;
                if (!gameState.powerUps[stageId]) {
                    gameState.powerUps[stageId] = { fiftyFifty: 3, extraTime: 3, skip: 3 };
                }
                const stagePowerUps = gameState.powerUps[stageId];
                const isMCQ4 = Object.keys(sceneData.options).length === 4;
                powerUpsHTML = `
                    <div class="power-ups-container">
                        <button id="guide-help-btn" class="guide-help-button">๐ก ูุณุงุนุฏุฉ ุงููุฑุดุฏ (-0.5 ููุทุฉ)</button>
                        <button id="fifty-fifty-btn" class="power-up-btn" ${stagePowerUps.fiftyFifty > 0 && isMCQ4 ? '' : 'disabled'}>50/50 <span class="power-up-counter">${stagePowerUps.fiftyFifty}</span></button>
                        <button id="extra-time-btn" class="power-up-btn" ${stagePowerUps.extraTime > 0 ? '' : 'disabled'}>โฑ๏ธ +15 <span class="power-up-counter">${stagePowerUps.extraTime}</span></button>
                        <button id="skip-q-btn" class="power-up-btn" ${stagePowerUps.skip > 0 ? '' : 'disabled'}>โญ๏ธ ุชุฎุทู <span class="power-up-counter">${stagePowerUps.skip}</span></button>
                    </div>`;
            }

            sceneElement.innerHTML = `
                <img src="${sceneData.image}" alt="ุตูุฑุฉ ูุดูุฏ ${sceneId}" class="scene-image" loading="lazy">
                <div class="scene-content">
                    ${progressInfoHTML}
                    <p class="scene-title">${sceneData.question}</p>
                    ${powerUpsHTML}
                    <div class="options-container">${optionsHTML}</div>
                </div>`;

            sceneElement.classList.remove('hidden');
            sceneElement.querySelector('.options-container').addEventListener('click', handleAnswer);
            
            const powerUpsContainer = sceneElement.querySelector('.power-ups-container');
            if (powerUpsContainer) {
                powerUpsContainer.addEventListener('click', (event) => {
                    const button = event.target.closest('.power-up-btn, .guide-help-button');
                    if (!button) return;
                    switch (button.id) {
                        case 'guide-help-btn': useGuideHelp(); break;
                        case 'fifty-fifty-btn': useFiftyFifty(); break;
                        case 'extra-time-btn': useExtraTime(); break;
                        case 'skip-q-btn': useSkipQuestion(); break;
                    }
                });
            }
            startTimer();
        }

        function renderStudentAffairsInfoScene() {
            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
            const sceneElement = document.getElementById('studentaffairs-info-scene');
            sceneElement.classList.remove('hidden');
            gameState.currentScene = 'studentaffairs-info';
            saveGameState();

            const container = document.getElementById('studentaffairs-info-container');
            container.innerHTML = `<nav class="tabs-nav"><button class="tab-btn active" data-tab="about">ุนู ุงูุนูุงุฏุฉ</button><button class="tab-btn" data-tab="services">ุงูุฃูุณุงู ูุงูุฎุฏูุงุช</button><button class="tab-btn" data-tab="gallery">ุฃูุจูู ุงูุตูุฑ</button></nav><div class="tabs-content"><div id="tab-about" class="tab-pane active"><div class="info-scene-container"><p>ุฃููุงู ูุณููุงู ุจูู ูู ุนูุงุฏุฉ ุดุฆูู ุงูุทูุจุฉ ุจุงูุฌุงูุนุฉ ุงูุฅุณูุงููุฉ. ุชุนุฏ ุนูุงุฏุฉ ุดุคูู ุงูุทูุจุฉ ูู ุฃูู ุงูุนูุงุฏุงุช ุจุงูุฌุงูุนุฉ ุงููุฎุชุตุฉ ุจุงูุทูุจุฉุ ููู  ุชุนูู ุจุชูุฏูู ุงูุฎุฏูุงุช ุงูุทูุงุจูุฉุ ูุงูุชู ุชุณูู ูู ุชูุธูู ุงูุฃูุดุทุฉ ุงููุงูููุฌูุฉ ูุงูุฃุนูุงู ุงูุชุทูุนูุฉุ ูุชุณุงุนุฏ ุงูุทุงูุจ ูู ุฅูุฌุงุฒ ุงููุนุงููุงุช ูุชุณููู ุนูููุฉ ุงูุชุณุฌูู ูุงูุชุณุฌูู ููููุญ ุงูุฏุงุฎููุฉ ูุงูุฎุงุฑุฌูุฉ ูุงููุฑูุถ ุงูุฌุงูุนูุฉ.</p><h3 class="info-section-title">ุชุงุฑูุฎ ูููุงู</h3><p>ุฃูุดุฆุช ุนูุงุฏุฉ ุดุคูู ุงูุทูุจุฉ ูู ุนุงู 1981ู. ููุฏ ุฃููุทุช ุจูุง ุงูููุงู ุงูุชุงููุฉ:</p><ul class="info-list"><li>ุฏุฑุงุณุฉ ูุดููุงุช ุงูุทูุจุฉ ุงูุงูุชุตุงุฏูุฉุ ููุถุน ุงูุญููู ููุง ูู ุฎูุงู ูุณู ุงูุจุญุซ ุงูุงุฌุชูุงุนู.</li><li>ุงูุฅุดุฑุงู ุนูู ุงููุดุงุท ุงูุซูุงูู ูุงูุงุฌุชูุงุนู ูุงูุฑูุงุถู ูุงูููู ุจุงูุชูุณูู ูุน ูุฌุงูุณ ุงูุทูุจุฉ.</li><li>ูุชุงุจุนุฉ ุงุฌุชูุงุนูุงุช ูุฌุงูุณ ุงูุทูุจุฉุ ูุฅุฑุดุงุฏูู ุฅูู ุทุฑูู ุงูุนูู ุงูุณููู.</li><li>ุงููุธุฑ ูู ูุดููุงุช ุงูุทูุจุฉ ุงูููููุฉ ุงูุนุงูุฉ ูุงูุฎุงุตุฉุ ูุชูุณูุจ ุงูุญููู ุงูููุงุฆูุฉ ููุง.</li><li>ุงูุฅุดุฑุงู ุนูู ุญุณู ุงุณุชุฎุฏุงู ูุฑุงูู ุงูุฌุงูุนุฉ ุงุณุชุฎุฏุงูุงู ุณูููุงู.</li><li>ูุฑุงูุจุฉ ุงูุชุธุงู ุงูุฏุฑุงุณุฉุ ูุจุญุซ ุธุงูุฑุฉ ุงูุชุบูุจุ ูุชูุณูุจ ุงูุญููู ุงูููุงุฆูุฉ ููุง.</li></ul></div></div><div id="tab-services" class="tab-pane"><div class="info-scene-container"><div class="accordion-item"><div class="accordion-header">ูุณู ุงูุจุญุซ ุงูุงุฌุชูุงุนู "ุฎุฏูุงุช ุงูุทูุจุฉ"</div><div class="accordion-content"><p>ูุนุฏ ูุณู ุงูุจุญุซ ุงูุงุฌุชูุงุนู ุงูุจูุงุจุฉ ุงูุฃุณุงุณูุฉ ููุณุงุนุฏุฉ ุงูุทูุจุฉ ูุงููุง ุจูุฏู ุฅููุงู ุงููุณูุฑุฉ ุงูุชุนููููุฉ. ูุจูุงุกู ุนููู ูุชู ุงูุงุณุชูุงุฏุฉ ูู ุฎุฏูุงุช ุงูุนูุงุฏุฉ ุงููุชุนููุฉ ุจุงูููุญ ุงูุฎุงุฑุฌูุฉ ูุงููุฑูุถ ุงูุฌุงูุนูุฉ.</p><strong>ุงูุฎุทูุงุช ุงููุชุจุนุฉ ููุงุณุชูุงุฏุฉ:</strong><ul class="info-list"><li>ูุชู ุชูุฌูู ุงูุทูุจุฉ ูุชุนุจุฆุฉ ุงุณุชูุงุฑุฉ ุงูุจุญุซ ุงูุงุฌุชูุงุนู ุงููุชุฑูููุง.</li><li>ูููู ุงูุทุงูุจ ุจุฅุฑูุงู ุงูุฃูุฑุงู ุงูุซุจูุชูุฉ ุงูุฃุตููุฉ ุงููุชุฑูููุง.</li><li>ูููู ุงูุทุงูุจ ุจุฅุญุถุงุฑ ุงูุฃูุฑุงู ุงูุซุจูุชูุฉ ูุชุณููููุง ูููุธูู ุงูุจุญุซ ุงูุงุฌุชูุงุนูุ ูุชุฏููููุง.</li><li>ูุชู ุชุตููู ุญุงูุงุช ุงูุทูุจุฉ ููู ูุนุงููุฑ ุฎุงุตุฉ ุชุญุฏุฏ ุงูุญุงูุฉ ุงูุงุฌุชูุงุนูุฉ ููุทุงูุจ.</li><li>ุจูุงุก ุนูู ูุชูุฌุฉ ุงูุจุญุซ ุงูุงุฌุชูุงุนู ููู ุทุงูุจ ูุชู ุชุฑุดูุญ ุงูุทูุจุฉ ููููุญ ุงูุฎุงุฑุฌูุฉ.</li></ul></div></div><div class="accordion-item"><div class="accordion-header">ุงูุฃูุดุทุฉ ุงููุงูููุฌูุฉ ูุงูุนูู ุงูุชุทูุนู</div><div class="accordion-content"><p>ูู ูุฌููุนุฉ ูู ุงููุนุงููุงุช ุงููุชููุนุฉ ุงูุซูุงููุฉ โ ุงููููุฉ โ ุงูุชุฏุฑูุจูุฉ โ ุงูุนูููุฉ ูุงูุชุฑููุญูุฉ ุงูุชู ุชูุฏู ุฅูู ุชูููุฉ ุดุฎุตูุฉ ุงูุทุงูุจ ุงูุฌุงูุนู ูุชุฒููุฏู ุจุงูููุงุฑุงุช ูุงูุฎุจุฑุงุช ูุงุณุชุซูุงุฑ ุงููุงุช ุงููุฑุงุบ. ุฃูุง ุงูุนูู ุงูุชุทูุนู ููู ุฃุญุฏ ุงููุณุงูุงุช ุงูุชู ุชุดุฑู ุนูููุง ุงูุนูุงุฏุฉ ูุชูููู ุงูุทูุจุฉ ุจุฃูุดุทุฉ ููุนุงููุงุช ุชุทูุนูุฉ ุชุตูู ููุงูุจูู.</p></div></div><div class="accordion-item"><div class="accordion-header">ูุณู ุงููุดุงุท ุงูุฑูุงุถู</div><div class="accordion-content"><p>ููุฏ ุฃููุช ุนูุงุฏุฉ ุดุฆูู ุงูุทูุจุฉ ุงูุฃูุดุทุฉ ุงูุฑูุงุถูุฉ ุงููุฑุฏูุฉ ูุงูุฌูุงุนูุฉ ุงูุชูุงูุง ูุจูุฑุง ููุง ููุง ูู ุฃุซุฑ ูู ุตูู ูุชูุฐูุจ ุดุฎุตูุฉ ุงูุทุงูุจ. ููู ุฃูุฏุงูู ุจุซ ุงูุฑูุญ ุงูุฑูุงุถูุฉุ ุชูููุฉ ููุงูุจ ุงูุทูุจุฉุ ุบุฑุณ ุงูููุงููู ุงูุตุญูุญุฉ ููุชุฑุจูุฉ ุงูุจุฏููุฉุ ูุดุฑ ุงููุนู ุงูุฑูุงุถูุ ูุฅุนุฏุงุฏ ุงูููุชุฎุจุงุช ูุชูุซูู ุงูุฌุงูุนุฉ.</p></div></div><div class="accordion-item"><div class="accordion-header">ูุญุฏุฉ ุงูุชูุฌูู ูุงูุงุฑุดุงุฏ</div><div class="accordion-content"><p>ุชูุฏู ุงููุญุฏุฉ ุงูุฎุฏูุงุช ุงูุชุงููุฉ ููุทูุจุฉ:</p><ul class="info-list"><li>ุฅุฑุดุงุฏ ูุชูุฌูู ูุชูุนูุฉ.</li><li>ุงุณุชุดุงุฑุงุช.</li><li>ูุฏูุงุช ููุญุงุถุฑุงุช.</li><li>ูุฑุด ุนูู.</li><li>ุฏูุฑุงุช ุฐุงุช ุนูุงูุฉ.</li></ul></div></div></div></div><div id="tab-gallery" class="tab-pane"><div class="info-scene-container"><div class="photo-gallery"><img src="https://i.imgur.com/uStyY1N.jpeg" alt="ุงุณุชูุจุงู ุงูุทูุจุฉ" loading="lazy"><img src="https://i.imgur.com/vHqB3Tj.jpeg" alt="ุฒูุงุฑุฉ ุทูุจุฉ ุงูุซุงูููุฉ" loading="lazy"><img src="https://i.imgur.com/1mYdPo3.jpeg" alt="ูุฑูู ุงูุฏุจูุฉ" loading="lazy"><img src="https://i.imgur.com/QhXpBmg.jpeg" alt="ุฒูุงุฑุฉ ุงูุตุงูุฉ ุงูุฑูุงุถูุฉ" loading="lazy"><img src="https://i.imgur.com/A6mJTOq.jpeg" alt="ุฒูุงุฑุฉ ูุฑุฆูุณ ุงูุฌุงูุนุฉ" loading="lazy"><img src="https://i.imgur.com/o1bFjHj.jpeg" alt="ุงุณุชูุจุงู ูู ุงูุฃูุงู ุงูุชุฑููููุฉ" loading="lazy"><img src="https://i.imgur.com/L8JgY1g.jpeg" alt="ูุฑูู ุดุฆูู ุงูุทูุจุฉ" loading="lazy"><img src="https://i.imgur.com/w2Y9w5E.jpeg" alt="ุถูุงูุฉ ุทูุจุฉ ุงูุซุงูููุฉ" loading="lazy"></div></div></div></div>`;
            
            const tabsContainer = sceneElement.querySelector('.tabs-nav');
            const accordions = sceneElement.querySelectorAll('.accordion-item');

            tabsContainer.addEventListener('click', e => {
                if (e.target.classList.contains('tab-btn')) {
                    tabsContainer.querySelector('.active').classList.remove('active');
                    e.target.classList.add('active');
                    sceneElement.querySelector('.tab-pane.active').classList.remove('active');
                    const targetTab = e.target.dataset.tab;
                    sceneElement.querySelector(`#tab-${targetTab}`).classList.add('active');
                }
            });

            accordions.forEach(item => {
                const header = item.querySelector('.accordion-header');
                header.addEventListener('click', () => {
                    const content = item.querySelector('.accordion-content');
                    if (item.classList.toggle('active')) {
                        content.style.maxHeight = content.scrollHeight + 'px';
                    } else {
                        content.style.maxHeight = '0px';
                    }
                });
            });

document.getElementById('start-studentaffairs-quiz-btn').onclick = () => {
    const stageId = 'studentaffairs';
    const subScenes = Object.values(gameData[stageId].nextScene);
    if (subScenes.every(id => gameState.stageScores[id] !== undefined)) {
        const totalScore = subScenes.reduce((acc, id) => acc + (gameState.stageScores[id] || 0), 0);
        const totalQuestions = subScenes.reduce((acc, id) => acc + gameData[id].length, 0);
        showModal("ุงููุฑุญูุฉ ููุชููุฉ", `ููุฏ ุฃูููุช ูุฐู ุงููุฑุญูุฉ ูุณุจูุงู. <br><strong>ูุชูุฌุชู ุงูุฅุฌูุงููุฉ: ${totalScore} / ${totalQuestions}</strong>`, null);
    } else {
        renderScene(stageId);
    }
};        }

        function renderAdmissionInfoScene() {
            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
            const sceneElement = document.getElementById('admission-info-scene');
            sceneElement.classList.remove('hidden');
            gameState.currentScene = 'admission-info';
            saveGameState();
            const container = document.getElementById('admission-info-container');
            container.innerHTML = ''; 
            admissionInfoData.forEach(facultyData => {
                const card = document.createElement('div');
                card.className = 'admission-card';
                let specializationsHTML = '<ul>';
                facultyData.specializations.forEach(spec => {
                    const isNew = spec.name.includes('(ุฌุฏูุฏ)');
                    specializationsHTML += `<li><span class="specialization">${spec.name.replace(' (ุฌุฏูุฏ)', '')} ${isNew ? '<span class="score new-major">ุฌุฏูุฏ</span>' : ''}</span><span class="score">${spec.score}</span></li>`;
                });
                specializationsHTML += '</ul>';
                card.innerHTML = `<h3>${facultyData.faculty}</h3>${specializationsHTML}`;
                container.appendChild(card);
            });
document.getElementById('start-admission-quiz-btn').onclick = () => {
    const stageId = 'admission';
    const subScenes = Object.values(gameData[stageId].nextScene);
    if (subScenes.every(id => gameState.stageScores[id] !== undefined)) {
        const totalScore = subScenes.reduce((acc, id) => acc + (gameState.stageScores[id] || 0), 0);
        const totalQuestions = subScenes.reduce((acc, id) => acc + gameData[id].length, 0);
        showModal("ุงููุฑุญูุฉ ููุชููุฉ", `ููุฏ ุฃูููุช ูุฐู ุงููุฑุญูุฉ ูุณุจูุงู. <br><strong>ูุชูุฌุชู ุงูุฅุฌูุงููุฉ: ${totalScore} / ${totalQuestions}</strong>`, null);
    } else {
        renderScene(stageId);
    }
};        }

        function renderGrantsInfoScene() {
            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
            document.getElementById('grants-info-scene').classList.remove('hidden');
            gameState.currentScene = 'grants-info';
            saveGameState();
document.getElementById('start-grants-quiz-btn').onclick = () => {
    const stageId = 'grants';
    if (gameState.stageScores[stageId] !== undefined) {
        const score = gameState.stageScores[stageId];
        const total = gameData[stageId].length;
        showModal("ุงููุฑุญูุฉ ููุชููุฉ", `ููุฏ ุฃูููุช ูุฐู ุงููุฑุญูุฉ ูุณุจูุงู. <br><strong>ูุชูุฌุชู ูู ูุฐู ุงููุฑุญูุฉ: ${score} / ${total}</strong>`, null);
    } else {
        renderScene(stageId);
    }
};        }
        
        function renderExchangeInfoScene() {
            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
            document.getElementById('exchange-info-scene').classList.remove('hidden');
            gameState.currentScene = 'exchange-info';
            saveGameState();
document.getElementById('start-exchange-quiz-btn').onclick = () => {
    const stageId = 'exchange';
    const subScenes = Object.values(gameData[stageId].nextScene);
    if (subScenes.every(id => gameState.stageScores[id] !== undefined)) {
        const totalScore = subScenes.reduce((acc, id) => acc + (gameState.stageScores[id] || 0), 0);
        const totalQuestions = subScenes.reduce((acc, id) => acc + gameData[id].length, 0);
        showModal("ุงููุฑุญูุฉ ููุชููุฉ", `ููุฏ ุฃูููุช ูุฐู ุงููุฑุญูุฉ ูุณุจูุงู. <br><strong>ูุชูุฌุชู ุงูุฅุฌูุงููุฉ: ${totalScore} / ${totalQuestions}</strong>`, null);
    } else {
        renderScene(stageId);
    }
};        }
        
        function handleAnswer(event) {
            const targetButton = event.target.closest('.option-btn');
            if (!targetButton || targetButton.disabled) return;

            const sceneId = gameState.currentScene;
            let sceneData = gameData[sceneId];
            let questionId;

            if (Array.isArray(sceneData)) {
                sceneData = sceneData[gameState.currentSubQuestionIndex];
                questionId = sceneData.id;
            } else {
                questionId = sceneData.id || sceneId;
            }

            const selectedAnswer = targetButton.dataset.answer;

            if (sceneData.nextScene && sceneData.nextScene[selectedAnswer]) {
                const nextSceneId = sceneData.nextScene[selectedAnswer];
                // ุงูุชุญูู ูุจู ุงูุฏุฎูู ููุชุญุฏู ุงููุฑุนู
                if (gameState.stageScores[nextSceneId] !== undefined) {
                    const score = gameState.stageScores[nextSceneId];
                    const total = gameData[nextSceneId].length;
                    showModal("ุงูุชุญุฏู ููุชูู", `ููุฏ ุฃูููุช ูุฐุง ุงูุชุญุฏู ูุณุจูุงู. <br><strong>ูุชูุฌุชู ูู ูุฐู ุงููุฑุญูุฉ: ${score} / ${total}</strong>`, null);
                } else {
                    renderScene(nextSceneId);
                }
                return;
            }

            clearTimer();
            gameState.currentQuestionAttempts++;
            saveGameState();

            const allOptionButtons = document.querySelectorAll(`#${sceneId}-scene .option-btn`);
            const helpBtn = document.getElementById('guide-help-btn');
            const isCorrect = selectedAnswer === sceneData.correctAnswer;
            
            const proceedToNextStep = () => {
                if ((sceneId.includes('questions')) && !adShownThisSession && gameState.currentSubQuestionIndex === adTriggerQuestionIndex) {
                    setTimeout(showAdModal, 500);
                }

                if (sceneId === 'gate') {
                    playWelcomeVideo();
                } else if (Array.isArray(gameData[sceneId])) {
                    const nextQuestionIndex = gameState.currentSubQuestionIndex + 1;
                    if (nextQuestionIndex >= gameData[sceneId].length) {
                        // ุญูุธ ุงููุชูุฌุฉ ุนูุฏ ุฅููุงู ุงููุฑุญูุฉ ูููุฑุฉ ุงูุฃููู
                        if (gameState.stageScores[sceneId] === undefined) {
                            gameState.stageScores[sceneId] = stagePoints;
                            saveGameState();
                        }
                        giveBadgesForStage(sceneId);
                    }
                    if (nextQuestionIndex < gameData[sceneId].length) {
                        renderScene(sceneId, nextQuestionIndex);
                    } else {
                        const parentScene = sceneParentMap[sceneId];
                        if (parentScene) {
                            const allSiblingsCompleted = Object.values(gameData[parentScene].nextScene).every(isStageCompleted);
                            if (allSiblingsCompleted) {
                                showModal("ุฅูุฌุงุฒ ูุฐูู!", `ููุฏ ุฃูููุช ูู ุชุญุฏูุงุช ูุฐุง ุงููุณู ุจูุฌุงุญ. ููุนุฏ ุฅูู ุงูุฎุฑูุทุฉ.`, () => renderScene('map'));
                            } else {
                                showModal("ุฑุงุฆุน!", `ููุฏ ุฃุชููุช ูุฐุง ุงูุชุญุฏู. ููููู ุงูุขู ุชุฌุฑุจุฉ ุงูููุน ุงูุขุฎุฑ ูู ุงูุฃุณุฆูุฉ ุฃู ุงูุนูุฏุฉ ููุฎุฑูุทุฉ.`, () => renderScene(parentScene));
                            }
                        } else {
                            showModal("ุฅูุฌุงุฒ ุฑุงุฆุน!", `ููุฏ ุฃูููุช ุฌููุน ุชุญุฏูุงุช ูุฐุง ุงููุณู ุจูุฌุงุญ. ููุนุฏ ุฅูู ุงูุฎุฑูุทุฉ.`, () => renderScene('map'));
                        }
                    }
                } else {
                    renderScene('map');
                }
            };

            if (isCorrect) {
                playSound(correctSound);
                targetButton.classList.add('correct');
                allOptionButtons.forEach(btn => btn.disabled = true);
                if (helpBtn) helpBtn.disabled = true;

                if (!gameState.answeredQuestions.has(questionId)) {
                    gameState.score += sceneData.points;
                    stagePoints += sceneData.points;
                    gameState.answeredQuestions.add(questionId);
                    updatePlayerStats();
                    updatePlayerScore(gameState.uniquePlayerId, gameState.score);
                    saveGameState();
                }

                let feedback = (sceneData.correctFeedback && (sceneData.correctFeedback[gameState.selectedGuide] || sceneData.correctFeedback.default)) || 'ุฅุฌุงุจุฉ ุตุญูุญุฉ!';
                showModal("ุฅุฌุงุจุฉ ุตุญูุญุฉ!", feedback, proceedToNextStep);

            } else {
                playSound(incorrectSound);
                targetButton.classList.add('incorrect');
                targetButton.disabled = true;

                if (gameState.currentQuestionAttempts < 2) {
                    showModal("ูุญุงููุฉ ุฎุงุทุฆุฉ", "ูุฏูู ูุฑุตุฉ ุฃุฎุฑู ููุฅุฌุงุจุฉ. ุฑููุฒ ุฌูุฏุงู!", null);
                } else {
                    allOptionButtons.forEach(btn => btn.disabled = true);
                    if (helpBtn) helpBtn.disabled = true;

                    const correctButton = document.querySelector(`#${sceneId}-scene .option-btn[data-answer="${sceneData.correctAnswer}"]`);
                    if (correctButton) {
                        correctButton.classList.add('correct');
                    }

                    let feedback = (sceneData.incorrectFeedback && (sceneData.incorrectFeedback[gameState.selectedGuide] || sceneData.incorrectFeedback.default)) || 'ุฅุฌุงุจุฉ ุบูุฑ ุตุญูุญุฉ.';
                    showModal("ุฅุฌุงุจุฉ ุฎุงุทุฆุฉ", feedback + "<br>ุงูุฅุฌุงุจุฉ ุงูุตุญูุญุฉ ุชู ุชุญุฏูุฏูุง ุจุงูุฃุฎุถุฑ.", proceedToNextStep);
                }
            }
        }
        
        function giveBadgesForStage(stageId) {
            const totalPoints = gameData[stageId].length;

            if (stagePoints === totalPoints) {
                addBadge('perfect-score');
            }
            
            const mainStageId = sceneParentMap[stageId] || stageId;
            switch (mainStageId) {
                case 'library': addBadge('library-expert'); break;
                case 'faculties': addBadge('faculties-expert'); break;
                case 'grants': addBadge('grants-master'); break;
                case 'exchange': addBadge('exchange-master'); break;
                case 'studentaffairs': addBadge('student-affairs-master'); break;
                case 'admission': addBadge('admission-master'); break;
            }
            
            const completionTime = (Date.now() - startTime) / 1000;
            if (completionTime < 120 && totalPoints > 3) {
                 addBadge('speed-runner');
            }
        }

        function useGuideHelp() {
            const currentSceneEl = document.getElementById(`${gameState.currentScene}-scene`);
            if (!currentSceneEl) return;
            const helpBtn = currentSceneEl.querySelector('#guide-help-btn');

            if (!helpBtn || helpBtn.disabled) return;

            if (gameState.score < 0.5) {
                showModal("ุฑุตูุฏ ุบูุฑ ูุงูู", "ุนุฐุฑุงูุ ูุง ุชููู ูุตู ููุทุฉ ูุงุณุชุฎุฏุงู ุงููุณุงุนุฏุฉ.", null);
                return;
            }

            helpBtn.disabled = true;
            gameState.score -= 0.5;
            updatePlayerStats();
            updatePlayerScore(gameState.uniquePlayerId, gameState.score);
            saveGameState();

            let sceneData = gameData[gameState.currentScene];
            if (Array.isArray(sceneData)) {
                sceneData = sceneData[gameState.currentSubQuestionIndex];
            }

            const hint = (sceneData.hint && (sceneData.hint[gameState.selectedGuide] || sceneData.hint.default)) || 'ููุฑ ุฌูุฏุงูุ ููููู ูุนููุง!';
            showGuideModal("ูุณุงุนุฏุฉ ูู ูุฑุดุฏู", hint, false);
        }

        function useFiftyFifty() {
            const currentSceneEl = document.getElementById(`${gameState.currentScene}-scene`);
            const btn = currentSceneEl.querySelector('#fifty-fifty-btn');
            if (!btn || btn.disabled) return;

            const stageId = sceneParentMap[gameState.currentScene] || gameState.currentScene;
            if (gameState.powerUps[stageId].fiftyFifty <= 0) return;

            gameState.powerUps[stageId].fiftyFifty--;
            saveGameState();
            btn.querySelector('.power-up-counter').textContent = gameState.powerUps[stageId].fiftyFifty;
            btn.disabled = true;

            let sceneData = gameData[gameState.currentScene];
            if (Array.isArray(sceneData)) {
                sceneData = sceneData[gameState.currentSubQuestionIndex];
            }
            
            const options = document.querySelectorAll(`#${gameState.currentScene}-scene .option-btn`);
            const wrongAnswers = [];
            options.forEach(opt => {
                if (opt.dataset.answer !== sceneData.correctAnswer) {
                    wrongAnswers.push(opt);
                }
            });

            shuffleArray(wrongAnswers).slice(0, 2).forEach(opt => {
                opt.disabled = true;
                opt.style.opacity = '0.5';
            });
        }

        function useExtraTime() {
            const currentSceneEl = document.getElementById(`${gameState.currentScene}-scene`);
            const btn = currentSceneEl.querySelector('#extra-time-btn');   
            if (!btn || btn.disabled) return;

            const stageId = sceneParentMap[gameState.currentScene] || gameState.currentScene;
            if (gameState.powerUps[stageId].extraTime <= 0) return;

            gameState.powerUps[stageId].extraTime--;
            saveGameState();
            btn.querySelector('.power-up-counter').textContent = gameState.powerUps[stageId].extraTime;
            btn.disabled = true;
            
            timeLeft += 15;
            const timerDisplay = document.getElementById('timer-display');
            if(timerDisplay) timerDisplay.textContent = timeLeft;
        }

        function useSkipQuestion() {
            const currentSceneEl = document.getElementById(`${gameState.currentScene}-scene`);
            const btn = currentSceneEl.querySelector('#skip-q-btn');
            if (!btn || btn.disabled) return;

            const stageId = sceneParentMap[gameState.currentScene] || gameState.currentScene;
            if (gameState.powerUps[stageId].skip <= 0) return;
            
            if (gameState.score < 0.5) {
                showModal("ุฑุตูุฏ ุบูุฑ ูุงูู", "ุนุฐุฑุงูุ ูุง ุชููู ูุตู ููุทุฉ ูุชุฎุทู ุงูุณุคุงู.", null);
                return;
            }

            gameState.powerUps[stageId].skip--;
            gameState.score -= 0.5;
            updatePlayerStats();
            updatePlayerScore(gameState.uniquePlayerId, gameState.score);
            saveGameState();
            clearTimer();
            
            const sceneId = gameState.currentScene;
            const nextQuestionIndex = gameState.currentSubQuestionIndex + 1;

            if (nextQuestionIndex < gameData[sceneId].length) {
                renderScene(sceneId, nextQuestionIndex);
            } else {
                showModal("ุงูุชูุช ุงูุฃุณุฆูุฉ", "ููุฏ ุฃูููุช ูุฐู ุงููุฑุญูุฉ.", () => renderScene('map'));
            }
        }

        function updatePlayerStats() {
            playerNameDisplay.textContent = gameState.playerName;
            playerScoreDisplay.innerHTML = `๐ฐ ${gameState.score} ููุทุฉ`;
        }

        function showModal(title, text, callback) {
            modalTitle.textContent = title;
            modalText.innerHTML = text;
            modal.classList.remove('hidden');
            modalCloseBtn.onclick = () => {
                modal.classList.add('hidden');
                if (callback) callback();
            };
        }

        function endVideoAndProceed() {
            welcomeVideo.pause();
            welcomeVideo.currentTime = 0;
            videoOverlay.classList.add('hidden');
            renderScene('map');
        }

        function playWelcomeVideo() {
            videoOverlay.classList.remove('hidden');
            welcomeVideo.play();
            welcomeVideo.onended = endVideoAndProceed;
            skipVideoBtn.onclick = endVideoAndProceed;
        }

        function showAdModal() {
            adModal.classList.remove('hidden');
            adShownThisSession = true;
        }
        
        function isStageCompleted(stageId) {
            let stageData = gameData[stageId];
            if (!stageData) return false;
            if (stageId === 'stadium') {
                return gameState.answeredQuestions.has('stadium-game-completed');
            }
            if (stageId === 'faculties' || stageId === 'exchange' || stageId === 'admission' || stageId === 'studentaffairs') {
                const subScenes = Object.values(stageData.nextScene);
                return subScenes.every(s => isStageCompleted(s));
            }
            if (Array.isArray(stageData)) {
                return stageData.every(q => gameState.answeredQuestions.has(q.id));
            }
             if (stageData.id) {
                return gameState.answeredQuestions.has(stageData.id);
            }
            return false;
        }
        
        playerForm.addEventListener('submit', startGame);
document.getElementById('map-scene').addEventListener('click', (e) => {
            const button = e.target.closest('.option-btn');
            if (!button) return;
            const destination = button.dataset.destination;
            
            const mainDestinationId = destination.replace('-info', '').replace('-list', '');

            if (destination === 'stadium') {
                renderStadiumSelection();
                return;
            }

            // --- ุจุฏุงูุฉ ุงูููุฏ ุงูุฌุฏูุฏ ููุชุญูู ---
            const stageData = gameData[mainDestinationId];
            if (stageData) {
                if (Array.isArray(stageData)) { // ููุฃุณุฆูุฉ ุงููุจุงุดุฑุฉ ูุซู ุงูููุชุจุฉ
                    if (gameState.stageScores[mainDestinationId] !== undefined) {
                        const score = gameState.stageScores[mainDestinationId];
                        const total = stageData.length;
                        showModal("ุงููุฑุญูุฉ ููุชููุฉ", `ููุฏ ุฃูููุช ูุฐู ุงููุฑุญูุฉ ูุณุจูุงู. <br><strong>ูุชูุฌุชู ูู ูุฐู ุงููุฑุญูุฉ: ${score} / ${total}</strong>`, null);
                        return;
                    }
                } else if (stageData.nextScene) { // ูููุฑุงุญู ุงูุชู ุชุญุชูู ุนูู ูุงุฆูุฉ ุชุญุฏูุงุช
                    const subScenes = Object.values(stageData.nextScene);
                    if (subScenes.every(id => gameState.stageScores[id] !== undefined)) {
                        const totalScore = subScenes.reduce((acc, id) => acc + (gameState.stageScores[id] || 0), 0);
                        const totalQuestions = subScenes.reduce((acc, id) => acc + gameData[id].length, 0);
                        showModal("ุงููุฑุญูุฉ ููุชููุฉ", `ููุฏ ุฃูููุช ูุฐู ุงููุฑุญูุฉ ูุณุจูุงู. <br><strong>ูุชูุฌุชู ุงูุฅุฌูุงููุฉ: ${totalScore} / ${totalQuestions}</strong>`, null);
                        return;
                    }
                }
            }
            // --- ููุงูุฉ ุงูููุฏ ุงูุฌุฏูุฏ ููุชุญูู ---

            const destinationData = gameData[destination];

            if (destinationData && destinationData.isInfoScreen) {
                const sceneMappings = {
                    'grants-info': renderGrantsInfoScene,
                    'admission-info': renderAdmissionInfoScene,
                    'faculties-list': renderFacultiesListScene,
                    'exchange-info': renderExchangeInfoScene,
                    'studentaffairs-info': renderStudentAffairsInfoScene,
                };
                if(sceneMappings[destination]) sceneMappings[destination]();
                return;
            }
            
            if (destination === 'certificate') {
                const libraryComplete = isStageCompleted('library');
                const facultiesComplete = isStageCompleted('faculties');
                const exchangeComplete = isStageCompleted('exchange');
                const admissionComplete = isStageCompleted('admission');
                const studentAffairsComplete = isStageCompleted('studentaffairs');
                const allKeyStagesComplete = libraryComplete && facultiesComplete && exchangeComplete && admissionComplete && studentAffairsComplete;
                const scoreSufficient = gameState.score >= 50;
                if (allKeyStagesComplete && scoreSufficient) {
                    showEndScene();
                } else {
                    let message = "ุงูุทุฑูู ุฅูู ุงูุดูุงุฏุฉ ูู ููุชูู ุจุนุฏ!<br><br>ููุญุตูู ุนูููุงุ ูุฌุจ ุนููู ุชุญููู ุดุฑุทูู:<br>";
                    message += `1. ุฅููุงู ุงูุชุญุฏูุงุช ุงูุฑุฆูุณูุฉ.<br>`;
                    message += `(${libraryComplete ? 'โ๏ธ' : 'โ'} ุงูููุชุจุฉ) | (${facultiesComplete ? 'โ๏ธ' : 'โ'} ุงููููุงุช) | (${exchangeComplete ? 'โ๏ธ' : 'โ'} ุงูุชุจุงุฏู) | (${admissionComplete ? 'โ๏ธ' : 'โ'} ุงููุจูู) | (${studentAffairsComplete ? 'โ๏ธ' : 'โ'} ุดุคูู ุงูุทูุจุฉ)<br>`;
                    message += `2. ุงูุญุตูู ุนูู 50 ููุทุฉ ุนูู ุงูุฃูู (ุฑุตูุฏู: ${gameState.score}). (${scoreSufficient ? 'โ๏ธ' : 'โ'})<br><br>ุงุณุชูุฑ ูู ุฑุญูุชู!`;
                    showModal("ุดุฑูุท ุงูุญุตูู ุนูู ุงูุดูุงุฏุฉ", message, null);
                }
                return;
            }
            
            if (destinationData && destinationData.isUnderConstruction) {
                showModal("ููุฏ ุงูุฅูุดุงุก!", "ูุฐุง ุงูุฌุฒุก ูู ุงูุฌุงูุนุฉ ุณูุชู ุงูุชุชุงุญู ูุฑูุจุงู ูู ุงูุชุญุฏูุซุงุช ุงููุงุฏูุฉ ููุนุจุฉ.", null);
                return;
            }

            if (destinationData) renderScene(mainDestinationId);
            else showModal("ุฎุทุฃ", "ูู ูุชู ุงูุนุซูุฑ ุนูู ุงููุฌูุฉ ุงููุทููุจุฉ.", null);
        });
        
        document.addEventListener('click', function(event) {
            if (event.target.closest('#show-register-btn')) {
                landingScreen.classList.add('hidden');
                startScreen.classList.remove('hidden');
            }
            if (event.target.closest('#logout-btn')) {
                event.preventDefault();
                showLogoutConfirmation();
            }
            if (event.target.closest('#reset-progress-btn')) {
                event.preventDefault();
                showLogoutConfirmation();
            }
            if (event.target.closest('#back-to-map-btn')) {
                event.preventDefault();
                renderScene('map');
            }
            if (event.target.closest('#profile-btn')) {
                event.preventDefault();
                renderPlayerProfile();
            }
        });

      adModal.addEventListener('click', (event) => {
            // ูุบูู ุงููุงูุฐุฉ ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ ุงูุฅุบูุงูุ ุฃู ุฒุฑ ุงูุชุฎุทูุ ุฃู ุงูุฎูููุฉ
            if (event.target.closest('.close-ad-btn, #ad-skip-btn') || event.target.id === 'ad-modal') {
                adModal.classList.add('hidden');
            }
        });

        // ุฅุถุงูุฉ ูุธููุฉ ูุฒุฑ "ุงูุชูุงุตูู"
        document.getElementById('ad-details-btn').addEventListener('click', () => {
            adModal.classList.add('hidden'); // ุฃููุงูุ ุฃุบูู ูุงูุฐุฉ ุงูุฅุนูุงู
            // ุซุงููุงูุ ุงุนุฑุถ ุตูุญุฉ ุงูููุจ ุจุงุณุชุฎุฏุงู ุงูุฏุงูุฉ ุงูุฌุฏูุฏุฉ
            showWebsiteInIframe('https://www.iugaza.edu.ps/p29815/', 'ุฅุนูุงู ูููุฉ ุงูููุฏุณุฉ');
        });
        
        document.getElementById('new-player-btn').addEventListener('click', performLogout);

        const logoutModal = document.getElementById('logout-confirm-modal');
        document.getElementById('confirm-logout-btn').addEventListener('click', performLogout);
        document.getElementById('cancel-logout-btn').addEventListener('click', () => {
            logoutModal.classList.add('hidden');
        });
        
        document.getElementById('profile-back-btn').addEventListener('click', () => {
            document.getElementById('player-profile-scene').classList.add('hidden');
            renderScene('map');
        });
        
        window.addEventListener('popstate', (event) => {
            if (event.state && event.state.scene) {
                const sceneMappings = {
                    'admission-info': renderAdmissionInfoScene,
                    'exchange-info': renderExchangeInfoScene,
                    'grants-info': renderGrantsInfoScene,
                    'faculties-list': renderFacultiesListScene,
                    'studentaffairs-info': renderStudentAffairsInfoScene,
                    'player-profile': renderPlayerProfile
                };
                if (sceneMappings[event.state.scene]) {
                    sceneMappings[event.state.scene]();
                } else {
                    renderScene(event.state.scene, event.state.index, false);
                }
            } else {
                if (gameState.uniquePlayerId) renderScene('map', 0, false);
                else location.reload();
            }
        });
        
        function populateFacultiesList() {
            const container = document.getElementById('faculties-grid-container');
            let content = '';
            collegesData.forEach(college => {
                content += `<div class="college-info-card" data-url="${college.url}" data-name="${college.name}"><h3>${college.emoji} ${college.name}</h3><p>${college.description}</p></div>`;
            });
            container.innerHTML = content;
        }

        function renderFacultiesListScene() {
            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
            document.getElementById('faculties-list-scene').classList.remove('hidden');
            gameState.currentScene = 'faculties-list';
            saveGameState();
        }
        function showWebsiteInIframe(url, title) {
            const websiteScene = document.getElementById('college-website-scene');
            websiteScene.innerHTML = `<div class="scene-content"><div class="website-view-header"><button id="back-to-last-scene-btn" class="action-button" style="width: auto; padding: 10px 20px;"><span class="btn-icon">โก๏ธ</span> ุฑุฌูุน</button></div><div class="loader-container" id="loader-container"><div class="loader"></div><p>ุฌุงุฑู ุชุญููู ุงูุตูุญุฉ...</p></div></div>`;
            
            document.getElementById('back-to-last-scene-btn').addEventListener('click', () => {
                websiteScene.classList.add('hidden');
                websiteScene.innerHTML = '';
                // ูุนูุฏ ุงููุงุนุจ ุฅูู ุขุฎุฑ ูุดูุฏ ูุงู ููู ูุจู ูุชุญ ุงููููุน
                const lastSceneId = gameState.currentScene;
                const sceneElement = document.getElementById(`${lastSceneId}-scene`);
                if(sceneElement) {
                    sceneElement.classList.remove('hidden');
                } else {
                    renderScene('map'); // ูุฎูุงุฑ ุงุญุชูุงุทู
                }
            });

            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
            websiteScene.classList.remove('hidden');

            const iframe = document.createElement('iframe');
            iframe.id = 'college-website-iframe';
            iframe.src = url;
            iframe.title = title;
            iframe.onload = () => {
                const loaderContainer = document.getElementById('loader-container');
                if (loaderContainer) loaderContainer.remove();
                iframe.classList.add('loaded');
            };
            websiteScene.querySelector('.scene-content').appendChild(iframe);
        }
document.getElementById('faculties-grid-container').addEventListener('click', (e) => {
    const card = e.target.closest('.college-info-card');
    if (!card) return;
    
    const url = card.dataset.url;
    const name = card.dataset.name;

    if (name === 'ูููุฉ ุงูุงูุชุตุงุฏ ูุงูุนููู ุงูุฅุฏุงุฑูุฉ') {
        window.location.href = 'economics.html';
    } else if (name === 'ูููุฉ ุงูุทุจ') { 
        window.location.href = 'medicine.html'; 
    } else if (name === 'ูููุฉ ุงูููุฏุณุฉ') {
        window.location.href = 'engineering.html';
    } else if (name === 'ูููุฉ ุชูููููุฌูุง ุงููุนูููุงุช') {
        window.location.href = 'it.html';
    } else if (name === 'ูููุฉ ุงูุชูุฑูุถ') {
        window.location.href = 'nursing.html';
    } else if (name === 'ูููุฉ ุงูุนููู ุงูุตุญูุฉ') {
        window.location.href = 'health-sciences.html';
    } else if (name === 'ูููุฉ ุงูุนููู') {
        window.location.href = 'science.html';
    } else if (name === 'ูููุฉ ุงูุขุฏุงุจ') {
        window.location.href = 'arts.html';
    } else if (name === 'ูููุฉ ุงูุดุฑูุนุฉ ูุงููุงููู') {
        window.location.href = 'sharia.html';
    } else if (name === 'ูููุฉ ุฃุตูู ุงูุฏูู') {
        window.location.href = 'osool.html';
    } else if (name === 'ูููุฉ ุงูุชุฑุจูุฉ') { // <<<--- ุงูุณุทุฑ ุงูุฌุฏูุฏ
        window.location.href = 'education.html'; // <<<--- ุงูุณุทุฑ ุงูุฌุฏูุฏ
    } else {
        showWebsiteInIframe(url, name);
    }
});

        document.getElementById('proceed-to-faculties-quiz-btn').addEventListener('click', () => {
    const stageId = 'faculties';
    const subScenes = Object.values(gameData[stageId].nextScene);
    if (subScenes.every(id => gameState.stageScores[id] !== undefined)) {
        const totalScore = subScenes.reduce((acc, id) => acc + (gameState.stageScores[id] || 0), 0);
        const totalQuestions = subScenes.reduce((acc, id) => acc + gameData[id].length, 0);
        showModal("ุงููุฑุญูุฉ ููุชููุฉ", `ููุฏ ุฃูููุช ูุฐู ุงููุฑุญูุฉ ูุณุจูุงู. <br><strong>ูุชูุฌุชู ุงูุฅุฌูุงููุฉ: ${totalScore} / ${totalQuestions}</strong>`, null);
    } else {
        renderScene(stageId);
    }
});
        function populateGuideSelection() {
            const container = document.querySelector('#guide-selection-screen .guides-container');
            container.innerHTML = ''; 
            allGuides.forEach(guide => {
                const cardHTML = `
                    <div class="guide-card" data-guide="${guide.id}">
                        <div class="guide-icon">${guide.emoji}</div>
                        <h3>${guide.name}</h3>
                        <span>${guide.college}</span>
                        <p>${guide.description}</p>
                    </div>
                `;
                container.innerHTML += cardHTML;
            });
        }

        const guideSelectionScreen = document.getElementById('guide-selection-screen');
        const guidesContainer = guideSelectionScreen.querySelector('.guides-container');
        const confirmGuideBtn = document.getElementById('confirm-guide-btn');
        
        guidesContainer.addEventListener('click', (e) => {
            const selectedCard = e.target.closest('.guide-card');
            if (!selectedCard) return;
            guidesContainer.querySelectorAll('.guide-card').forEach(card => card.classList.remove('selected'));
            selectedCard.classList.add('selected');
            gameState.selectedGuide = selectedCard.dataset.guide;
            confirmGuideBtn.disabled = false;
        });

        confirmGuideBtn.addEventListener('click', () => {
            if (gameState.selectedGuide) {
                saveGameState();
                guideSelectionScreen.classList.add('hidden');
                gameSceneContainer.classList.remove('hidden');
                statusBar.classList.remove('hidden');
                showModal(`ุงุฎุชูุงุฑ ูููู!`, `ูุฑุดุฏู ุงูุฃูุงุฏููู ุณูููู ุจุฌุงูุจู. ููุจุฏุฃ ุงูุฑุญูุฉ ุงูุขู!`, () => {
                    renderScene('gate');
                });
            }
        });
        
        function renderPlayerProfile() {
            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
            const profileScene = document.getElementById('player-profile-scene');
            profileScene.classList.remove('hidden');

            const profileName = document.getElementById('profile-name');
            const profileEmoji = document.getElementById('profile-emoji');
            const profileScore = document.getElementById('profile-score');
            const profileTawjihiYear = document.getElementById('profile-tawjihi-year');

            const selectedGuideInfo = allGuides.find(g => g.id === gameState.selectedGuide);
            profileName.textContent = gameState.playerName;
            profileEmoji.textContent = selectedGuideInfo ? selectedGuideInfo.emoji : '๐ค';
            profileScore.textContent = `${gameState.score} ููุทุฉ`;
            profileTawjihiYear.textContent = gameState.tawjihiYear;

            const badgesContainer = document.getElementById('badges-container');
            const noBadgesMsg = document.getElementById('no-badges-msg');
            badgesContainer.innerHTML = ''; 
            
            if (gameState.badges.length > 0) {
                noBadgesMsg.classList.add('hidden');
                gameState.badges.forEach(badgeId => {
                    const badgeInfo = badgesData.find(b => b.id === badgeId);
                    if (badgeInfo) {
                        const badgeCard = document.createElement('div');
                        badgeCard.className = 'badge-card';
                        badgeCard.innerHTML = `<span class="badge-icon">${badgeInfo.emoji}</span><p>${badgeInfo.name}</p>`;
                        badgesContainer.appendChild(badgeCard);
                    }
                });
            } else {
                noBadgesMsg.classList.remove('hidden');
            }
            gameState.currentScene = 'player-profile';
            saveGameState();
        }
    // ========== ุจุฏุงูุฉ ููุฏ ูุนุจุฉ ุงูููุนุจ ==========
            // ========== ุจุฏุงูุฉ ููุฏ ูุนุจุฉ ุงูููุนุจ ==========

        // --- ุงูุฏุงูุฉ ุงูุฌุฏูุฏุฉ ุงูุชู ุณุชุถูููุง ---
        function renderStadiumSelection() {
            const sceneElement = document.getElementById('stadium-selection-scene');
            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
            sceneElement.classList.remove('hidden');
            gameState.currentScene = 'stadium-selection';
            saveGameState();

            sceneElement.innerHTML = `
                <div class="scene-content">
                    <h2 class="scene-title">๐๏ธ ููุทูุฉ ุงูุฃูุนุงุจ</h2>
                    <p>ุฃููุงู ุจู ูู ููุทูุฉ ุงูุฃูุนุงุจ ุงูุชุฑููููุฉ ุจุงูุฌุงูุนุฉ. ุงุฎุชุฑ ุงูุชุญุฏู ุงูุฐู ุชูุฏ ุฎูุถู!</p>
                    <div class="game-choices-container">
                        <div class="game-choice-card" data-game="penalties">
                            <span class="icon">โฝ</span>
                            <h3>ุชุญุฏู ุฑููุงุช ุงูุชุฑุฌูุญ</h3>
                            <p>ุงุฎุชุจุฑ ุฏูุชู ูู ุชุณุฏูุฏ ุงููุฑุงุช ูุญุงูู ูุฒููุฉ ุงูุญุงุฑุณ.</p>
                        </div>
                        <div class="game-choice-card" data-game="memory">
                            <span class="icon">๐ง</span>
                            <h3>ุชุญุฏู ุงูุฐุงูุฑุฉ</h3>
                            <p>ูููู ุฐุงูุฑุชู ูุงุจุญุซ ุนู ุฃุฒูุงุฌ ุฑููุฒ ุงููููุงุช ุงููุชุดุงุจูุฉ.</p>
                        </div>
                    </div>
                    <button id="back-to-map-from-stadium" class="action-button secondary" style="max-width: 250px;">
                        <span class="btn-icon">๐บ๏ธ</span> ุงูุนูุฏุฉ ุฅูู ุงูุฎุฑูุทุฉ
                    </button>
                </div>`;

            sceneElement.querySelector('.game-choices-container').addEventListener('click', (e) => {
                const selectedCard = e.target.closest('.game-choice-card');
                if (!selectedCard) return;

                const game = selectedCard.dataset.game;
                if (game === 'penalties') {
                    renderStadiumGame();
                } else if (game === 'memory') {
                    renderMemoryGame();
                }
            });
            
            sceneElement.querySelector('#back-to-map-from-stadium').addEventListener('click', () => renderScene('map'));
        }
        function renderStadiumGame() {
            const sceneElement = document.getElementById('stadium-scene');
            if (!sceneElement) {
                console.error("ERROR: Stadium scene element not found!");
                showModal("ุฎุทุฃ ููู", "ูู ูุชู ุงูุนุซูุฑ ุนูู ุนูุตุฑ ุงููุนุจุฉ. ุงูุฑุฌุงุก ุงูุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก ูู ููู HTML.", () => renderScene('map'));
                return;
            }
            
            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
            sceneElement.classList.remove('hidden');
            gameState.currentScene = 'stadium';
            saveGameState();

            let playerScore = 0;
            let keeperScore = 0;
            let shotsTaken = 0;
            const totalShots = 5;

            sceneElement.innerHTML = `
                <div class="scene-content">
                    <div class="stadium-score-board">
                        <div id="stadium-player-score">ุฃูุช: 0</div>
                        <div id="stadium-keeper-score">ุงูุญุงุฑุณ: 0</div>
                    </div>
                    <div class="stadium-game-board" id="stadium-game-board">
                        <div class="stadium-goal" id="stadium-goal">
                            <div class="stadium-keeper" id="stadium-keeper">๐งโโ๏ธโ</div>
                        </div>
                        <div class="stadium-ball" id="stadium-ball">๐โโ๏ธโฝ</div>
                    </div>
                    <div class="stadium-controls">
                        <p class="stadium-instructions" id="stadium-instructions">ุงููุฑ ุนูู ุงููุฑูู ููุชุณุฏูุฏ!</p>
                        <div class="stadium-shots-indicator" id="stadium-shots-indicator"></div>
                    </div>
                </div>`;

            const gameBoard = document.getElementById('stadium-game-board');
            const goal = document.getElementById('stadium-goal');
            const ball = document.getElementById('stadium-ball');
            const keeper = document.getElementById('stadium-keeper');
            const instructions = document.getElementById('stadium-instructions');
            const playerScoreDisplay = document.getElementById('stadium-player-score');
            const keeperScoreDisplay = document.getElementById('stadium-keeper-score');
            const shotsIndicator = document.getElementById('stadium-shots-indicator');
            
            for (let i = 0; i < totalShots; i++) {
                shotsIndicator.innerHTML += `<div class="shot-dot" id="shot-dot-${i}"></div>`;
            }

            const handleShot = (e) => {
                if (!ball || !keeper) return; // Safety check

                ball.textContent = 'โฝ'; 
                ball.style.fontSize = '25px'; 

                if (shotsTaken >= totalShots) return;
                goal.removeEventListener('click', handleShot);
                instructions.textContent = '...';

                const rect = goal.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;

                const keeperPositions = [-80, 0, 80];
                const randomPos = keeperPositions[Math.floor(Math.random() * keeperPositions.length)];
                keeper.style.left = `calc(50% + ${randomPos}px)`;

                ball.style.bottom = `${(rect.height - y) + (gameBoard.clientHeight - rect.height)}px`;
                ball.style.left = `${(x / rect.width) * 100}%`;
                ball.style.transform = `translateX(-50%) scale(0.5)`;

                setTimeout(() => {
                    const goalThird = rect.width / 3;
                    const shotPosition = x < goalThird ? -80 : (x > goalThird * 2 ? 80 : 0);
                    
                    const dot = document.getElementById(`shot-dot-${shotsTaken}`);
                    if (shotPosition !== randomPos) {
                        playSound(correctSound);
                        playerScore++;
                        instructions.textContent = 'โฝ ูููููุฏู!';
                        dot.classList.add('goal');
                    } else {
                        playSound(incorrectSound);
                        keeperScore++;
                        instructions.textContent = '๐งค ุชุตุฏู ููุง ุงูุญุงุฑุณ!';
                        dot.classList.add('saved');
                        keeper.textContent = '๐งโโ๏ธโโฝ';
                    }

                    shotsTaken++;
                    playerScoreDisplay.textContent = `ุฃูุช: ${playerScore}`;
                    keeperScoreDisplay.textContent = `ุงูุญุงุฑุณ: ${keeperScore}`;

                    if (shotsTaken >= totalShots) {
                        endStadiumGame();
                    } else {
                        resetShot();
                    }
                }, 600);
            };
            
            const resetShot = () => {
                setTimeout(() => {
                    if (!ball || !keeper) return; // Safety check
                    keeper.textContent = '๐งโโ๏ธโ';
                    ball.textContent = '๐โโ๏ธโฝ';
                    ball.style.fontSize = '35px';
                    ball.style.transition = 'none';
                    ball.style.bottom = '15px';
                    ball.style.left = '50%';
                    ball.style.transform = 'translateX(-50%) scale(1)';
                    keeper.style.left = '50%';

                    setTimeout(() => {
                        ball.style.transition = 'all 0.5s cubic-bezier(0.25, 1, 0.5, 1)';
                        instructions.textContent = `ุงูุชุณุฏูุฏุฉ ${shotsTaken + 1}/${totalShots}. ุงููุฑ ุนูู ุงููุฑูู!`;
                        goal.addEventListener('click', handleShot);
                    }, 50);
                }, 1000);
            };

           const endStadiumGame = () => {
                const wasAlreadyCompleted = gameState.answeredQuestions.has('stadium-game-completed');
                
                // ูุณุฌู ุฃู ุงููุนุจุฉ ุงูุชููุช ุจุบุถ ุงููุธุฑ ุนู ุงููุชูุฌุฉ
                gameState.answeredQuestions.add('stadium-game-completed');

                let title, message;
                if (playerScore > keeperScore) {
                    title = '๐ ููุฒ ุฑุงุฆุน!';
                    
                    // ูุชุญูู ุฅุฐุง ูุงูุช ูุฐู ูู ุงููุฑุฉ ุงูุฃููู ููููุฒ
                    if (!wasAlreadyCompleted) {
                        message = `ููุฏ ูุฒุช ุจูุชูุฌุฉ ${playerScore} - ${keeperScore}. ุชู ุฅุถุงูุฉ 5 ููุงุท ุฅูู ุฑุตูุฏู!`;
                        gameState.score += 5;
                        updatePlayerStats();
                        updatePlayerScore(gameState.uniquePlayerId, gameState.score);
                    } else {
                        message = `ููุฏ ูุฒุช ูุฌุฏุฏุงู ุจูุชูุฌุฉ ${playerScore} - ${keeperScore}. ูุนุจ ุฑุงุฆุน! (ูุง ูุชู ุฅุถุงูุฉ ููุงุท ุฌุฏูุฏุฉ ููุนุจ ุงููุชูุฑุฑ).`;
                    }

                } else {
                    title = '๐ฅ ูุญุงููุฉ ุฌูุฏุฉ!';
                    message = `ุงูุชูุช ุงููุจุงุฑุงุฉ ุจุงูุชุนุงุฏู ุฃู ุงูุฎุณุงุฑุฉ. ุญุธุงู ุฃููุฑ ูู ุงููุฑุฉ ุงููุงุฏูุฉ!`;
                }
                
                saveGameState();
                
                setTimeout(() => {
showModal(title, message + "<br><br>ููููู ุงูุขู ุชุฌุฑุจุฉ ูุนุจุฉ ุฃุฎุฑู ุฃู ุงูุนูุฏุฉ ููุฎุฑูุทุฉ.", () => renderStadiumSelection());                }, 1500);
            };
            goal.addEventListener('click', handleShot);
        }
        // ========== ููุงูุฉ ููุฏ ูุนุจุฉ ุงูููุนุจ ==========

        // ========== ุจุฏุงูุฉ ููุฏ ูุนุจุฉ ุงูุฐุงูุฑุฉ ==========
        // ========== ุจุฏุงูุฉ ููุฏ ูุนุจุฉ ุงูุฐุงูุฑุฉ ==========
        function renderMemoryGame() {
            const sceneElement = document.getElementById('memory-game-scene');
            document.querySelectorAll('.game-stage').forEach(stage => stage.classList.add('hidden'));
            sceneElement.classList.remove('hidden');
            gameState.currentScene = 'memory-game';
            saveGameState();

            const cardEmojis = shuffleArray(collegesData).slice(0, 8).map(c => c.emoji);
            const gameCards = shuffleArray([...cardEmojis, ...cardEmojis]);

            let gridHTML = '';
            gameCards.forEach(emoji => {
                gridHTML += `
                    <div class="memory-card" data-emoji="${emoji}">
                        <div class="card-face card-front"></div>
                        <div class="card-face card-back">${emoji}</div>
                    </div>`;
            });

            sceneElement.innerHTML = `
                <div class="scene-content">
                    <h2 class="memory-game-title">ุชุญุฏู ุงูุฐุงูุฑุฉ!</h2>
                    <p style="text-align:center; margin-bottom: 20px;">ุงุณุชุนุฏ! ุณูุชู ุนุฑุถ ุงูุจุทุงูุงุช ููุฏุฉ 4 ุซูุงูู...</p>
                    <div class="memory-grid">${gridHTML}</div>
                </div>`;
                
            const grid = sceneElement.querySelector('.memory-grid');
            const allCards = sceneElement.querySelectorAll('.memory-card');
            let flippedCards = [];
            let matchedPairs = 0;
            let lockBoard = true; // --- ูุจุฏุฃ ูุงูููุญุฉ ููููุฉ

            // --- ุงูููุฏ ุงูุฌุฏูุฏ ูุจุฏุฃ ููุง ---

            // 1. ุนุฑุถ ูู ุงูุจุทุงูุงุช ููุฑุงู ุนูุฏ ุจุฏุก ุงููุนุจุฉ
            allCards.forEach(card => card.classList.add('flipped'));

            // 2. ุจุนุฏ 4 ุซูุงููุ ูุชู ุฅุฎูุงุก ุฌููุน ุงูุจุทุงูุงุช
            setTimeout(() => {
                allCards.forEach(card => card.classList.remove('flipped'));
                
                // ุชุญุฏูุซ ุงูุฑุณุงูุฉ
                sceneElement.querySelector('p').textContent = 'ุงุจุญุซ ุนู ุฃุฒูุงุฌ ุงูุฑููุฒ ุงููุชุดุงุจูุฉ ููููุงุช ุงูุฌุงูุนุฉ.';

                // 3. ููุชุธุฑ ุงูุชูุงุก ุญุฑูุฉ ุงูุฅุฎูุงุก (600ms) ุซู ูุณูุญ ุจุงููุนุจ
                setTimeout(() => {
                    lockBoard = false;
                }, 600); // ูุฐู ุงููุฏุฉ ูุฌุจ ุฃู ุชุทุงุจู ูุฏุฉ ุงูุงูุชูุงู ูู CSS
                
            }, 4000); // 4 ุซูุงูู

            // --- ุงูููุฏ ุงูุฌุฏูุฏ ููุชูู ููุง ---

            const handleCardClick = (e) => {
                const clickedCard = e.target.closest('.memory-card');
                // ุงูุขู ูุฐุง ุงูุณุทุฑ ุณูููุน ุงููุนุจ ุฎูุงู ูุชุฑุฉ ุงูุนุฑุถ ุงูุฃูููุฉ
                if (lockBoard || !clickedCard || clickedCard.classList.contains('flipped')) return;

                clickedCard.classList.add('flipped');
                flippedCards.push(clickedCard);

                if (flippedCards.length === 2) {
                    lockBoard = true;
                    checkForMatch();
                }
            };

            const checkForMatch = () => {
                const [cardOne, cardTwo] = flippedCards;
                const isMatch = cardOne.dataset.emoji === cardTwo.dataset.emoji;

                if (isMatch) {
                    disableCards();
                } else {
                    unflipCards();
                }
            };
            
            const disableCards = () => {
                playSound(correctSound);
                flippedCards.forEach(card => {
                    card.classList.add('matched');
                });
                matchedPairs++;
                resetTurn();
                if (matchedPairs === cardEmojis.length) {
                    endMemoryGame();
                }
            };

            const unflipCards = () => {
                setTimeout(() => {
                    playSound(incorrectSound);
                    flippedCards.forEach(card => card.classList.remove('flipped'));
                    resetTurn();
                }, 1000);
            };

            const resetTurn = () => {
                flippedCards = [];
                lockBoard = false;
            };

            const endMemoryGame = () => {
                setTimeout(() => {
showModal('๐ง ุฐุงูุฑุฉ ูููุฉ!', 'ููุฏ ุฃุชููุช ุชุญุฏู ุงูุฐุงูุฑุฉ ุจูุฌุงุญ. ุฃูุช ุงูุขู ุนุงุฆุฏ ุฅูู ููุทูุฉ ุงูุฃูุนุงุจ.', () => renderStadiumSelection());                }, 500);
            };
            
            grid.addEventListener('click', handleCardClick);
        }
        // ========== ููุงูุฉ ููุฏ ูุนุจุฉ ุงูุฐุงูุฑุฉ ==========
        // ========== ููุงูุฉ ููุฏ ูุนุจุฉ ุงูุฐุงูุฑุฉ ==========

        document.body.addEventListener('click', unlockAudio, { once: true });
        
        function getUrlsForNextScenes(sceneId, questionIndex = 0) {
            const urls = [];
            const sceneData = gameData[sceneId];
            if (Array.isArray(sceneData)) {
                for (let i = questionIndex + 1; i < Math.min(questionIndex + 3, sceneData.length); i++) {
                    if (sceneData[i] && sceneData[i].image) urls.push(sceneData[i].image);
                }
            } else if (sceneData && sceneData.nextScene) {
                const nextSceneIds = Object.values(sceneData.nextScene);
                nextSceneIds.forEach(id => {
                    const nextSceneData = gameData[id];
                    if (Array.isArray(nextSceneData) && nextSceneData[0] && nextSceneData[0].image) {
                        urls.push(nextSceneData[0].image);
                    }
                });
            }
            return urls;
        }

        preloadImage('assets/images/all_q.webp');
        preloadImage('assets/images/hares 1.webp');
        preloadImage('assets/images/library_question.webp');

        populateFacultiesList();
        populateGuideSelection();
        restoreGameSession();
    });