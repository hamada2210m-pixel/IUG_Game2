<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ø¯ÙŠ Ø§Ù„Ø±ÙƒÙ„Ø§Øª Ø§Ù„Ø­Ø±Ø© - Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            background-color: #5c93c7;
            background-image: linear-gradient(to bottom, #5c93c7 0%, #a4c4e2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Cairo', sans-serif;
            overflow: hidden;
            padding: 10px;
            margin: 0;
            height: 100vh;
        }
        #game-container {
            width: 100%;
            max-width: 500px;
            height: 95vh;
            max-height: 900px;
            background: #4caf50;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            border: 5px solid white;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            perspective: 800px;
        }
        #field {
            width: 100%;
            height: 100%;
            position: absolute;
            bottom: 0;
            transform-style: preserve-3d;
            transform: rotateX(60deg) translateY(150px);
            background-image:
                repeating-linear-gradient(rgba(255,255,255,0.1) 0 2px, transparent 2px 100%);
            background-size: 100% 50px;
        }
        #goal {
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%) translateZ(-300px);
            width: 350px; /* --- ØªÙ… Ø§Ù„ØªÙƒØ¨ÙŠØ± --- */
            height: 180px; /* --- ØªÙ… Ø§Ù„ØªÙƒØ¨ÙŠØ± --- */
            font-size: 150px; /* --- ØªÙ… Ø§Ù„ØªÙƒØ¨ÙŠØ± --- */
            line-height: 180px;
            text-align: center;
            color: #eee;
            z-index: 5;
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            text-shadow: 0 0 10px rgba(0,0,0,0.5);
        }
        #keeper {
            position: absolute;
            top: 90px; /* ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¶Ø¹ */
            left: 50%;
            transform: translateX(-50%) translateZ(-250px);
            width: 90px; /* --- ØªÙ… Ø§Ù„ØªÙƒØ¨ÙŠØ± --- */
            height: 90px; /* --- ØªÙ… Ø§Ù„ØªÙƒØ¨ÙŠØ± --- */
            font-size: 90px; /* --- ØªÙ… Ø§Ù„ØªÙƒØ¨ÙŠØ± --- */
            line-height: 90px;
            text-align: center;
            z-index: 10;
            transition: transform 0.4s ease-out;
            pointer-events: none;
        }
        #ball {
            position: absolute;
            bottom: 80px;
            left: 50%;
            width: 50px; /* --- ØªÙ… Ø§Ù„ØªØµØºÙŠØ± --- */
            height: 50px; /* --- ØªÙ… Ø§Ù„ØªØµØºÙŠØ± --- */
            font-size: 50px; /* --- ØªÙ… Ø§Ù„ØªØµØºÙŠØ± --- */
            line-height: 50px;
            text-align: center;
            border-radius: 50%;
            transform: translateX(-50%) translateZ(0);
            cursor: grab;
            z-index: 20;
            transition: transform 0.05s linear;
            user-select: none;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: transparent;
        }
        #ball.shooting {
            cursor: grabbing;
        }
        #ui-layer {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 30;
            color: white;
            text-shadow: 0 2px 5px rgba(0,0,0,0.5);
            pointer-events: none;
        }
        .ui-element {
            pointer-events: auto;
        }
        #scoreboard {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 24px;
            font-weight: 700;
        }
        #game-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 70px;
            font-weight: 900;
            opacity: 0;
            transition: all 0.5s;
        }
        #start-overlay {
            position: absolute;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            text-align: center;
            padding: 20px;
        }
        #start-overlay h2 {
            font-size: 48px;
            color: white;
            margin-bottom: 10px;
        }
        #start-overlay p {
            font-size: 20px;
            color: #ddd;
            margin-bottom: 30px;
        }
        #aim-indicator {
            position: absolute;
            width: 4px;
            height: 0;
            background-color: rgba(255,255,255,0.7);
            transform-origin: bottom center;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%) rotateX(0deg);
            z-index: 15;
            transition: height 0.05s linear;
            display: none;
        }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="field"></div>
        <div id="goal">ğŸ¥…</div>
        <div id="keeper">ğŸ§â€â™‚ï¸</div>
        <div id="ball">âš½</div>
        <div id="aim-indicator"></div>

        <div id="ui-layer">
            <a class="action-button ui-element" href="index.html" style="position: absolute; top: 20px; left: 20px;">â¬… Ø§Ù„Ø®Ø±ÙŠØ·Ø©</a>
            <div id="scoreboard" class="ui-element">
                <div id="score">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: 0</div>
                <div id="shots-left">Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: 5</div>
            </div>
            <div id="game-message"></div>
            <div id="start-overlay" class="ui-element">
                <h2>ØªØ­Ø¯ÙŠ Ø§Ù„Ø±ÙƒÙ„Ø§Øª Ø§Ù„Ø­Ø±Ø©</h2>
                <p>Ø§Ø³Ø­Ø¨ âš½ Ù„Ù„Ø®Ù„Ù Ù„ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù‚ÙˆØ© ÙˆØ§Ù„Ø§ØªØ¬Ø§Ù‡ØŒ Ø«Ù… Ø­Ø±Ø± Ù„Ù„ØªØ³Ø¯ÙŠØ¯!</p>
                <button class="action-button" id="start-button" style="margin-top: 20px;">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨</button>
            </div>
        </div>
    </div>

    <audio id="goalSound" src="assets/sounds/goal.mp3" preload="auto"></audio>
    <audio id="saveSound" src="assets/sounds/save.mp3" preload="auto"></audio>
    <audio id="kickSound" src="assets/sounds/kick.mp3" preload="auto"></audio>

    <script>
        const ball = document.getElementById('ball');
        const keeper = document.getElementById('keeper');
        const scoreDisplay = document.getElementById('score');
        const shotsLeftDisplay = document.getElementById('shots-left');
        const gameMessage = document.getElementById('game-message');
        const startOverlay = document.getElementById('start-overlay');
        const startButton = document.getElementById('start-button');
        const aimIndicator = document.getElementById('aim-indicator');
        
        const goalSound = document.getElementById('goalSound');
        const saveSound = document.getElementById('saveSound');
        const kickSound = document.getElementById('kickSound');

        let score = 0;
        let shotsLeft = 5;
        let isShooting = false;
        let isDragging = false;
        let startPos = { x: 0, y: 0 };

        const KEEPER_MAX_MOVE = 140; /* --- ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ --- */
        const clamp = (num, min, max) => Math.min(Math.max(num, min), max);

        function updateUI() {
            scoreDisplay.textContent = `Ø§Ù„Ø£Ù‡Ø¯Ø§Ù: ${score}`;
            shotsLeftDisplay.textContent = `Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª: ${shotsLeft}`;
        }

        function showMessage(text, isGoal) {
            gameMessage.textContent = text;
            gameMessage.style.color = isGoal ? '#8bc34a' : '#ffeb3b';
            gameMessage.style.opacity = 1;
            setTimeout(() => { gameMessage.style.opacity = 0; }, 1500);
        }

        function resetShot() {
            isShooting = false;
            ball.style.transition = 'transform 0.3s ease-out';
            ball.style.transform = 'translateX(-50%) translateZ(0) scale(1)';
            keeper.style.transition = 'transform 0.4s ease-out';
            keeper.style.transform = `translateX(-50%) translateZ(-250px)`;
            
            if (shotsLeft === 0) {
                startOverlay.style.display = 'flex';
                startButton.textContent = 'Ø§Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹';
                startOverlay.querySelector('h2').textContent = `Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: ${score} / 5`;
            }
        }

        function shoot(dragX, dragY) {
            if (isShooting || shotsLeft === 0) return;
            isShooting = true;
            shotsLeft--;
            updateUI();
            kickSound.play().catch(e => {});
            aimIndicator.style.display = 'none';

            let power = Math.min(Math.abs(dragY) / 150, 1);
            let horizontalAngle = clamp(dragX / 200, -1, 1);
            
            let targetXOffset = horizontalAngle * 130; /* --- ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ --- */
            let targetYOffset = -150;
            let targetZDistance = 500;

            ball.style.transition = 'transform 0.6s cubic-bezier(0.1, 0.7, 0.3, 1)';
            ball.style.transform = `translateX(-50%) translate3d(${targetXOffset}px, ${targetYOffset * power}px, ${-targetZDistance * power}px) scale(${1 - 0.5 * power})`;
            
            const diveOptions = [-1, 0, 1]; // -1 for left, 0 for center, 1 for right
            const keeperChoice = diveOptions[Math.floor(Math.random() * 3)];
            const keeperMoveAmount = keeperChoice * KEEPER_MAX_MOVE;
            
            keeper.style.transition = 'transform 0.3s ease-out';
            setTimeout(() => {
                keeper.style.transform = `translateX(-50%) translateZ(-250px) translateX(${keeperMoveAmount}px)`;
            }, 50);

            setTimeout(() => {
                const ballHitX = targetXOffset;
                const isGoalAreaHorizontal = Math.abs(ballHitX) < 130; /* --- ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ --- */
                const isGoalAreaVertical = (targetYOffset * power) < -50;
                const keeperCollisionThreshold = 70; /* --- ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ --- */

                let isGoal = false;
                if (isGoalAreaHorizontal && isGoalAreaVertical && power > 0.5) {
                    if (Math.abs(ballHitX - keeperMoveAmount) > keeperCollisionThreshold) {
                        isGoal = true;
                    }
                }
                
                if (isGoal) {
                    showMessage('Ù‡Ø¯Ù!', true);
                    goalSound.play().catch(e => {});
                    score++;
                } else {
                    showMessage(isGoalAreaHorizontal && power > 0.5 ? 'ØªØµØ¯ÙŠ!' : 'Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…Ø±Ù…Ù‰!', false);
                    saveSound.play().catch(e => {});
                }
                updateUI();
                setTimeout(resetShot, 1500);
            }, 600);
        }

        function startGame() {
            startOverlay.style.display = 'none';
            score = 0;
            shotsLeft = 5;
            updateUI();
            resetShot();
        }

        function handleDragStart(e) {
            if (isShooting || shotsLeft === 0) return;
            isDragging = true;
            aimIndicator.style.display = 'block';
            startPos = { x: (e.touches ? e.touches[0].clientX : e.clientX), y: (e.touches ? e.touches[0].clientY : e.clientY) };
        }

        function handleDragMove(e) {
            if (!isDragging) return;
            const currentX = (e.touches ? e.touches[0].clientX : e.clientX);
            const currentY = (e.touches ? e.touches[0].clientY : e.clientY);
            const dragY = currentY - startPos.y;
            const dragX = currentX - startPos.x;
            const power = clamp(Math.abs(dragY) / 150, 0, 1);
            const angle = Math.atan2(dragX, -dragY) * (180 / Math.PI);
            
            aimIndicator.style.height = `${power * 100}px`;
            aimIndicator.style.transform = `translateX(-50%) rotateZ(${angle}deg)`;
        }

        function handleDragEnd(e) {
            if (!isDragging) return;
            isDragging = false;
            aimIndicator.style.display = 'none';
            const endX = (e.changedTouches ? e.changedTouches[0].clientX : e.clientX);
            const endY = (e.changedTouches ? e.changedTouches[0].clientY : e.clientY);
            const dragX = endX - startPos.x;
            const dragY = endY - startPos.y;
            if (Math.abs(dragY) > 20) {
                shoot(dragX, dragY);
            }
        }

        ball.addEventListener('mousedown', handleDragStart);
        window.addEventListener('mousemove', handleDragMove);
        window.addEventListener('mouseup', handleDragEnd);
        ball.addEventListener('touchstart', (e) => { e.preventDefault(); handleDragStart(e); }, { passive: false });
        window.addEventListener('touchmove', (e) => { e.preventDefault(); handleDragMove(e); }, { passive: false });
        window.addEventListener('touchend', handleDragEnd);
        startButton.addEventListener('click', startGame);
        updateUI();
        resetShot();
    </script>
</body>
</html>
